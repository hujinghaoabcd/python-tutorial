# 第25章：综合实战项目

综合运用所学知识,完成实战项目,将理论转化为实践能力。

## 什么是实战项目?

想象你学会了做菜的所有技巧:切菜、炒菜、调味...但如果从来没有做过一道完整的菜,那还不算真正学会!编程也是一样。

**实战项目就是将所学知识综合运用,开发一个完整的、可运行的程序。**

### 为什么需要做实战项目?

```python
# 学了很多知识点
知道变量、函数、类、模块...
但能用它们做什么?

# 通过实战项目
将零散的知识点 → 组合成完整的应用
理论知识 → 实际能力
看懂代码 → 能写代码
```

**实战项目的价值**:
- **巩固知识** - 综合运用所学内容
- **解决问题** - 遇到问题并解决它
- **积累经验** - 了解开发流程
- **作品展示** - 可以放在简历上
- **建立信心** - 证明自己能做出东西

### 本章项目特点

我们将完成5个实战项目:
1. **学生管理系统** - 数据管理、文件操作
2. **待办事项应用** - 时间管理、任务追踪
3. **记账本程序** - 财务管理、数据分析
4. **简易博客系统** - 内容管理、搜索功能
5. **文件整理工具** - 自动化、批量处理

每个项目都包含:
- 需求分析
- 功能设计
- 完整实现
- 使用示例
- 可能的扩展

## 项目开发流程

在开始项目前,了解标准的开发流程很重要。

### 第1步:需求分析

```python
# 明确要做什么
问题: 我想要一个什么样的程序?
目标: 它要实现哪些功能?
用户: 谁会使用这个程序?
场景: 在什么情况下使用?

# 例子:学生管理系统
需求:
- 添加学生信息(姓名、学号、年龄)
- 记录学生成绩(多科目)
- 查询学生信息
- 统计成绩(平均分、排名)
- 数据持久化保存
```

### 第2步:功能设计

```python
# 将需求拆分为具体功能
1. 数据模型设计
   - 学生类: Student
   - 属性: name, id, age, scores
   - 方法: add_score(), get_average()

2. 功能模块设计
   - 添加学生
   - 删除学生
   - 修改信息
   - 查询学生
   - 成绩管理
   - 数据保存/加载

3. 界面设计
   - 菜单系统
   - 用户交互
   - 错误提示
```

### 第3步:编码实现

```python
# 从简单到复杂,逐步实现

# 第一版:最基本功能
class Student:
    def __init__(self, name):
        self.name = name

# 第二版:添加更多属性
class Student:
    def __init__(self, name, student_id, age):
        self.name = name
        self.student_id = student_id
        self.age = age

# 第三版:添加方法
class Student:
    def __init__(self, name, student_id, age):
        self.name = name
        self.student_id = student_id
        self.age = age
        self.scores = {}

    def add_score(self, subject, score):
        self.scores[subject] = score
```

### 第4步:测试和优化

```python
# 测试各种情况
正常情况: 添加学生、查询学生
边界情况: 空数据、重复ID
异常情况: 无效输入、文件不存在

# 优化代码
- 添加错误处理
- 改进用户体验
- 提高代码质量
- 优化性能
```

## 项目1：学生管理系统

一个完整的学生信息管理系统,包含增删改查、成绩管理、数据持久化等功能。

### 需求分析

**核心功能**:
- 学生信息管理(添加、删除、修改、查询)
- 成绩管理(录入、修改、查询)
- 数据统计(平均分、排名、成绩分布)
- 数据持久化(JSON文件存储)
- 数据导出(导出为CSV格式)

**用户场景**:
- 老师录入学生信息和成绩
- 查询某个学生的详细信息
- 统计班级成绩情况
- 导出数据用于其他用途

### 完整实现

```python
import json
import csv
import os
from datetime import datetime

class Student:
    """学生类"""

    def __init__(self, name, student_id, age, gender):
        """初始化学生"""
        self.name = name
        self.student_id = student_id
        self.age = age
        self.gender = gender
        self.scores = {}  # {科目: 分数}
        self.created_at = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

    def add_score(self, subject, score):
        """添加成绩"""
        if not 0 <= score <= 100:
            raise ValueError("分数必须在0-100之间")
        self.scores[subject] = score

    def get_average(self):
        """计算平均分"""
        if not self.scores:
            return 0
        return sum(self.scores.values()) / len(self.scores)

    def get_total(self):
        """计算总分"""
        return sum(self.scores.values())

    def to_dict(self):
        """转换为字典"""
        return {
            "name": self.name,
            "student_id": self.student_id,
            "age": self.age,
            "gender": self.gender,
            "scores": self.scores,
            "created_at": self.created_at
        }

    @classmethod
    def from_dict(cls, data):
        """从字典创建学生对象"""
        student = cls(
            data["name"],
            data["student_id"],
            data["age"],
            data["gender"]
        )
        student.scores = data.get("scores", {})
        student.created_at = data.get("created_at", "")
        return student

    def __str__(self):
        return f"{self.student_id} - {self.name} ({self.age}岁, {self.gender})"

class StudentManager:
    """学生管理系统"""

    def __init__(self, filename="students.json"):
        """初始化管理系统"""
        self.filename = filename
        self.students = []
        self.load_data()

    def load_data(self):
        """加载数据"""
        if os.path.exists(self.filename):
            try:
                with open(self.filename, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self.students = [Student.from_dict(s) for s in data]
                print(f"成功加载 {len(self.students)} 个学生记录")
            except Exception as e:
                print(f"加载数据失败: {e}")
                self.students = []
        else:
            print("数据文件不存在,创建新系统")
            self.students = []

    def save_data(self):
        """保存数据"""
        try:
            data = [s.to_dict() for s in self.students]
            with open(self.filename, "w", encoding="utf-8") as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
            return True
        except Exception as e:
            print(f"保存数据失败: {e}")
            return False

    def add_student(self, name, student_id, age, gender):
        """添加学生"""
        # 检查学号是否重复
        if self.find_student(student_id):
            print(f"学号 {student_id} 已存在")
            return False

        student = Student(name, student_id, age, gender)
        self.students.append(student)

        if self.save_data():
            print(f"学生 {name} 添加成功")
            return True
        return False

    def remove_student(self, student_id):
        """删除学生"""
        student = self.find_student(student_id)
        if not student:
            print(f"学号 {student_id} 不存在")
            return False

        self.students.remove(student)

        if self.save_data():
            print(f"学生 {student.name} 已删除")
            return True
        return False

    def update_student(self, student_id, **kwargs):
        """更新学生信息"""
        student = self.find_student(student_id)
        if not student:
            print(f"学号 {student_id} 不存在")
            return False

        if "name" in kwargs:
            student.name = kwargs["name"]
        if "age" in kwargs:
            student.age = kwargs["age"]
        if "gender" in kwargs:
            student.gender = kwargs["gender"]

        if self.save_data():
            print(f"学生 {student.name} 信息已更新")
            return True
        return False

    def find_student(self, student_id):
        """查找学生"""
        for student in self.students:
            if student.student_id == student_id:
                return student
        return None

    def search_students(self, keyword):
        """搜索学生"""
        results = []
        keyword = keyword.lower()
        for student in self.students:
            if (keyword in student.name.lower() or
                keyword in student.student_id.lower()):
                results.append(student)
        return results

    def add_score(self, student_id, subject, score):
        """添加成绩"""
        student = self.find_student(student_id)
        if not student:
            print(f"学号 {student_id} 不存在")
            return False

        try:
            student.add_score(subject, score)
            if self.save_data():
                print(f"成绩添加成功: {student.name} - {subject}: {score}分")
                return True
        except ValueError as e:
            print(f"添加失败: {e}")
        return False

    def get_statistics(self):
        """获取统计信息"""
        if not self.students:
            print("暂无学生数据")
            return

        print("\n" + "="*60)
        print("学生统计信息".center(56))
        print("="*60)

        # 基本统计
        total_students = len(self.students)
        male_count = sum(1 for s in self.students if s.gender == "男")
        female_count = total_students - male_count

        print(f"总人数: {total_students}")
        print(f"男生: {male_count} ({male_count/total_students*100:.1f}%)")
        print(f"女生: {female_count} ({female_count/total_students*100:.1f}%)")

        # 成绩统计
        students_with_scores = [s for s in self.students if s.scores]
        if students_with_scores:
            averages = [s.get_average() for s in students_with_scores]
            avg_of_avg = sum(averages) / len(averages)

            print(f"\n有成绩学生: {len(students_with_scores)}")
            print(f"班级平均分: {avg_of_avg:.2f}")
            print(f"最高平均分: {max(averages):.2f}")
            print(f"最低平均分: {min(averages):.2f}")

        print("="*60)

    def get_ranking(self):
        """获取排名"""
        students_with_scores = [s for s in self.students if s.scores]

        if not students_with_scores:
            print("暂无成绩数据")
            return

        # 按平均分排序
        ranked = sorted(students_with_scores,
                       key=lambda s: s.get_average(),
                       reverse=True)

        print("\n" + "="*70)
        print("成绩排名".center(66))
        print("="*70)
        print(f"{'排名':<6} {'学号':<12} {'姓名':<10} {'平均分':<10} {'总分':<10}")
        print("-"*70)

        for i, student in enumerate(ranked, 1):
            avg = student.get_average()
            total = student.get_total()
            print(f"{i:<6} {student.student_id:<12} {student.name:<10} "
                  f"{avg:<10.2f} {total:<10.1f}")

        print("="*70)

    def show_student_detail(self, student_id):
        """显示学生详细信息"""
        student = self.find_student(student_id)
        if not student:
            print(f"学号 {student_id} 不存在")
            return

        print("\n" + "="*60)
        print("学生详细信息".center(56))
        print("="*60)
        print(f"姓名: {student.name}")
        print(f"学号: {student.student_id}")
        print(f"年龄: {student.age}")
        print(f"性别: {student.gender}")
        print(f"录入时间: {student.created_at}")

        if student.scores:
            print("\n成绩信息:")
            print("-"*60)
            for subject, score in student.scores.items():
                print(f"  {subject}: {score}分")
            print("-"*60)
            print(f"  总分: {student.get_total()}")
            print(f"  平均分: {student.get_average():.2f}")
        else:
            print("\n暂无成绩记录")

        print("="*60)

    def show_all_students(self):
        """显示所有学生"""
        if not self.students:
            print("暂无学生记录")
            return

        print("\n" + "="*80)
        print("学生列表".center(76))
        print("="*80)
        print(f"{'学号':<12} {'姓名':<10} {'年龄':<6} {'性别':<6} {'平均分':<10} {'科目数':<8}")
        print("-"*80)

        for student in self.students:
            avg = student.get_average() if student.scores else 0
            subject_count = len(student.scores)
            print(f"{student.student_id:<12} {student.name:<10} "
                  f"{student.age:<6} {student.gender:<6} "
                  f"{avg:<10.2f} {subject_count:<8}")

        print("="*80)
        print(f"总计: {len(self.students)} 名学生")

    def export_to_csv(self, filename="students_export.csv"):
        """导出为CSV"""
        if not self.students:
            print("没有数据可导出")
            return False

        try:
            # 收集所有科目
            all_subjects = set()
            for student in self.students:
                all_subjects.update(student.scores.keys())

            all_subjects = sorted(all_subjects)

            # 写入CSV
            with open(filename, "w", newline="", encoding="utf-8-sig") as f:
                fieldnames = ["学号", "姓名", "年龄", "性别"] + all_subjects + ["平均分", "总分"]
                writer = csv.DictWriter(f, fieldnames=fieldnames)

                writer.writeheader()

                for student in self.students:
                    row = {
                        "学号": student.student_id,
                        "姓名": student.name,
                        "年龄": student.age,
                        "性别": student.gender,
                        "平均分": f"{student.get_average():.2f}",
                        "总分": f"{student.get_total():.1f}"
                    }

                    for subject in all_subjects:
                        row[subject] = student.scores.get(subject, "")

                    writer.writerow(row)

            print(f"数据已导出到 {filename}")
            return True
        except Exception as e:
            print(f"导出失败: {e}")
            return False

    def run(self):
        """运行主程序"""
        while True:
            print("\n" + "="*50)
            print("学生管理系统".center(46))
            print("="*50)
            print("1. 添加学生")
            print("2. 删除学生")
            print("3. 修改学生信息")
            print("4. 查询学生")
            print("5. 搜索学生")
            print("6. 添加成绩")
            print("7. 显示所有学生")
            print("8. 查看详细信息")
            print("9. 成绩排名")
            print("10. 统计信息")
            print("11. 导出数据")
            print("0. 退出系统")
            print("="*50)

            choice = input("请选择操作: ").strip()

            try:
                if choice == "1":
                    print("\n--- 添加学生 ---")
                    name = input("姓名: ").strip()
                    student_id = input("学号: ").strip()
                    age = int(input("年龄: "))
                    gender = input("性别(男/女): ").strip()
                    self.add_student(name, student_id, age, gender)

                elif choice == "2":
                    print("\n--- 删除学生 ---")
                    student_id = input("学号: ").strip()
                    self.remove_student(student_id)

                elif choice == "3":
                    print("\n--- 修改学生信息 ---")
                    student_id = input("学号: ").strip()
                    student = self.find_student(student_id)
                    if student:
                        print(f"当前信息: {student}")
                        name = input("新姓名(留空不修改): ").strip()
                        age_str = input("新年龄(留空不修改): ").strip()
                        gender = input("新性别(留空不修改): ").strip()

                        kwargs = {}
                        if name:
                            kwargs["name"] = name
                        if age_str:
                            kwargs["age"] = int(age_str)
                        if gender:
                            kwargs["gender"] = gender

                        if kwargs:
                            self.update_student(student_id, **kwargs)
                        else:
                            print("未做任何修改")
                    else:
                        print(f"学号 {student_id} 不存在")

                elif choice == "4":
                    print("\n--- 查询学生 ---")
                    student_id = input("学号: ").strip()
                    self.show_student_detail(student_id)

                elif choice == "5":
                    print("\n--- 搜索学生 ---")
                    keyword = input("关键词(姓名或学号): ").strip()
                    results = self.search_students(keyword)
                    if results:
                        print(f"\n找到 {len(results)} 个结果:")
                        for student in results:
                            print(f"  {student}")
                    else:
                        print("未找到匹配的学生")

                elif choice == "6":
                    print("\n--- 添加成绩 ---")
                    student_id = input("学号: ").strip()
                    subject = input("科目: ").strip()
                    score = float(input("分数: "))
                    self.add_score(student_id, subject, score)

                elif choice == "7":
                    self.show_all_students()

                elif choice == "8":
                    print("\n--- 查看详细信息 ---")
                    student_id = input("学号: ").strip()
                    self.show_student_detail(student_id)

                elif choice == "9":
                    self.get_ranking()

                elif choice == "10":
                    self.get_statistics()

                elif choice == "11":
                    print("\n--- 导出数据 ---")
                    filename = input("文件名(默认students_export.csv): ").strip()
                    if not filename:
                        filename = "students_export.csv"
                    self.export_to_csv(filename)

                elif choice == "0":
                    print("\n感谢使用学生管理系统,再见!")
                    break

                else:
                    print("无效选择,请重试")

            except ValueError as e:
                print(f"输入错误: {e}")
            except KeyboardInterrupt:
                print("\n\n操作已取消")
            except Exception as e:
                print(f"发生错误: {e}")

# 使用示例
if __name__ == "__main__":
    manager = StudentManager()

    # 添加示例数据
    manager.add_student("张三", "2024001", 18, "男")
    manager.add_student("李四", "2024002", 19, "女")
    manager.add_student("王五", "2024003", 18, "男")

    # 添加成绩
    manager.add_score("2024001", "语文", 85)
    manager.add_score("2024001", "数学", 92)
    manager.add_score("2024001", "英语", 88)

    manager.add_score("2024002", "语文", 90)
    manager.add_score("2024002", "数学", 95)
    manager.add_score("2024002", "英语", 93)

    # 显示统计
    manager.get_statistics()
    manager.get_ranking()

    # 启动交互界面(取消注释运行)
    # manager.run()
```

### 功能演示

```python
# 创建系统
manager = StudentManager()

# 添加学生
manager.add_student("张三", "2024001", 18, "男")
# 输出: 学生 张三 添加成功

# 添加成绩
manager.add_score("2024001", "语文", 85)
manager.add_score("2024001", "数学", 92)
# 输出: 成绩添加成功: 张三 - 语文: 85分

# 查看详情
manager.show_student_detail("2024001")
# 输出完整的学生信息和成绩

# 查看排名
manager.get_ranking()
# 输出成绩排名表

# 导出数据
manager.export_to_csv()
# 输出: 数据已导出到 students_export.csv
```

### 可能的扩展

1. **图形界面** - 使用Tkinter或PyQt
2. **数据库存储** - 使用SQLite代替JSON
3. **成绩分析** - 添加图表、趋势分析
4. **多用户支持** - 添加登录、权限管理
5. **导入功能** - 从Excel导入数据
6. **备份功能** - 自动备份数据
7. **打印功能** - 生成PDF报告

## 项目2：待办事项应用

一个功能完整的任务管理应用,支持任务分类、优先级、提醒等功能。

### 需求分析

**核心功能**:
- 任务管理(添加、删除、修改、完成)
- 优先级设置(高、中、低)
- 任务分类(工作、学习、生活等)
- 截止日期和提醒
- 任务搜索和筛选
- 数据持久化

### 完整实现

```python
from datetime import datetime, timedelta
import json
import os

class Task:
    """任务类"""

    def __init__(self, title, description="", priority="medium",
                 category="general", due_date=None):
        """初始化任务"""
        self.id = None  # 由TodoApp分配
        self.title = title
        self.description = description
        self.priority = priority  # high, medium, low
        self.category = category
        self.completed = False
        self.created_at = datetime.now()
        self.due_date = due_date  # datetime对象或None
        self.completed_at = None

    def complete(self):
        """完成任务"""
        self.completed = True
        self.completed_at = datetime.now()

    def is_overdue(self):
        """是否过期"""
        if not self.due_date or self.completed:
            return False
        return datetime.now() > self.due_date

    def days_until_due(self):
        """距离截止日期的天数"""
        if not self.due_date:
            return None
        delta = self.due_date - datetime.now()
        return delta.days

    def to_dict(self):
        """转换为字典"""
        return {
            "id": self.id,
            "title": self.title,
            "description": self.description,
            "priority": self.priority,
            "category": self.category,
            "completed": self.completed,
            "created_at": self.created_at.isoformat(),
            "due_date": self.due_date.isoformat() if self.due_date else None,
            "completed_at": self.completed_at.isoformat() if self.completed_at else None
        }

    @classmethod
    def from_dict(cls, data):
        """从字典创建任务"""
        task = cls(
            data["title"],
            data.get("description", ""),
            data.get("priority", "medium"),
            data.get("category", "general"),
            datetime.fromisoformat(data["due_date"]) if data.get("due_date") else None
        )
        task.id = data.get("id")
        task.completed = data.get("completed", False)
        task.created_at = datetime.fromisoformat(data["created_at"])
        if data.get("completed_at"):
            task.completed_at = datetime.fromisoformat(data["completed_at"])
        return task

    def __str__(self):
        status = "✓" if self.completed else "○"
        priority_icon = {"high": "!", "medium": "-", "low": "·"}[self.priority]
        due_str = ""
        if self.due_date and not self.completed:
            days = self.days_until_due()
            if days is not None:
                if days < 0:
                    due_str = f" [逾期{-days}天]"
                elif days == 0:
                    due_str = " [今天到期]"
                elif days == 1:
                    due_str = " [明天到期]"
                else:
                    due_str = f" [{days}天后到期]"

        return f"{status} [{self.id}] {priority_icon} {self.title}{due_str}"

class TodoApp:
    """待办事项应用"""

    def __init__(self, filename="todos.json"):
        """初始化应用"""
        self.filename = filename
        self.tasks = []
        self.next_id = 1
        self.load()

    def load(self):
        """加载任务"""
        if os.path.exists(self.filename):
            try:
                with open(self.filename, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self.tasks = [Task.from_dict(t) for t in data["tasks"]]
                    self.next_id = data.get("next_id", 1)
                print(f"成功加载 {len(self.tasks)} 个任务")
            except Exception as e:
                print(f"加载失败: {e}")
                self.tasks = []
        else:
            print("创建新的待办事项列表")

    def save(self):
        """保存任务"""
        try:
            data = {
                "tasks": [t.to_dict() for t in self.tasks],
                "next_id": self.next_id
            }
            with open(self.filename, "w", encoding="utf-8") as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
            return True
        except Exception as e:
            print(f"保存失败: {e}")
            return False

    def add_task(self, title, description="", priority="medium",
                 category="general", due_days=None):
        """添加任务"""
        due_date = None
        if due_days is not None:
            due_date = datetime.now() + timedelta(days=due_days)

        task = Task(title, description, priority, category, due_date)
        task.id = self.next_id
        self.next_id += 1

        self.tasks.append(task)

        if self.save():
            print(f"任务已添加: {task.title}")
            return task
        return None

    def remove_task(self, task_id):
        """删除任务"""
        task = self.find_task(task_id)
        if not task:
            print(f"任务 {task_id} 不存在")
            return False

        self.tasks.remove(task)

        if self.save():
            print(f"任务已删除: {task.title}")
            return True
        return False

    def complete_task(self, task_id):
        """完成任务"""
        task = self.find_task(task_id)
        if not task:
            print(f"任务 {task_id} 不存在")
            return False

        if task.completed:
            print("任务已经完成")
            return False

        task.complete()

        if self.save():
            print(f"任务已完成: {task.title}")
            return True
        return False

    def find_task(self, task_id):
        """查找任务"""
        for task in self.tasks:
            if task.id == task_id:
                return task
        return None

    def show_tasks(self, show_completed=False, category=None, priority=None):
        """显示任务列表"""
        filtered_tasks = self.tasks

        # 过滤
        if not show_completed:
            filtered_tasks = [t for t in filtered_tasks if not t.completed]

        if category:
            filtered_tasks = [t for t in filtered_tasks if t.category == category]

        if priority:
            filtered_tasks = [t for t in filtered_tasks if t.priority == priority]

        if not filtered_tasks:
            print("没有任务")
            return

        # 按优先级和截止日期排序
        priority_order = {"high": 0, "medium": 1, "low": 2}
        filtered_tasks.sort(key=lambda t: (
            t.completed,
            priority_order[t.priority],
            t.due_date if t.due_date else datetime.max
        ))

        print("\n" + "="*70)
        print("待办任务".center(66))
        print("="*70)

        for task in filtered_tasks:
            print(task)

        # 统计信息
        total = len(filtered_tasks)
        completed = sum(1 for t in filtered_tasks if t.completed)
        overdue = sum(1 for t in filtered_tasks if t.is_overdue())

        print("-"*70)
        print(f"总计: {total} | 已完成: {completed} | 逾期: {overdue}")
        print("="*70)

    def show_task_detail(self, task_id):
        """显示任务详情"""
        task = self.find_task(task_id)
        if not task:
            print(f"任务 {task_id} 不存在")
            return

        print("\n" + "="*60)
        print("任务详情".center(56))
        print("="*60)
        print(f"ID: {task.id}")
        print(f"标题: {task.title}")
        print(f"描述: {task.description or '无'}")
        print(f"分类: {task.category}")
        print(f"优先级: {task.priority}")
        print(f"状态: {'已完成' if task.completed else '进行中'}")
        print(f"创建时间: {task.created_at.strftime('%Y-%m-%d %H:%M')}")

        if task.due_date:
            print(f"截止日期: {task.due_date.strftime('%Y-%m-%d %H:%M')}")
            if not task.completed:
                days = task.days_until_due()
                if days < 0:
                    print(f"⚠️  已逾期 {-days} 天")
                elif days == 0:
                    print("⚠️  今天到期")
                elif days <= 3:
                    print(f"⚠️  {days} 天后到期")

        if task.completed_at:
            print(f"完成时间: {task.completed_at.strftime('%Y-%m-%d %H:%M')}")

        print("="*60)

    def get_statistics(self):
        """获取统计信息"""
        total = len(self.tasks)
        if total == 0:
            print("暂无任务")
            return

        completed = sum(1 for t in self.tasks if t.completed)
        pending = total - completed
        overdue = sum(1 for t in self.tasks if t.is_overdue())

        # 按分类统计
        by_category = {}
        for task in self.tasks:
            by_category[task.category] = by_category.get(task.category, 0) + 1

        # 按优先级统计
        by_priority = {}
        for task in self.tasks:
            if not task.completed:
                by_priority[task.priority] = by_priority.get(task.priority, 0) + 1

        print("\n" + "="*60)
        print("任务统计".center(56))
        print("="*60)
        print(f"总任务数: {total}")
        print(f"已完成: {completed} ({completed/total*100:.1f}%)")
        print(f"进行中: {pending} ({pending/total*100:.1f}%)")
        print(f"逾期: {overdue}")

        if by_category:
            print("\n按分类:")
            for cat, count in sorted(by_category.items()):
                print(f"  {cat}: {count}")

        if by_priority:
            print("\n待办任务优先级:")
            for pri in ["high", "medium", "low"]:
                count = by_priority.get(pri, 0)
                if count > 0:
                    print(f"  {pri}: {count}")

        print("="*60)

    def search_tasks(self, keyword):
        """搜索任务"""
        keyword = keyword.lower()
        results = []

        for task in self.tasks:
            if (keyword in task.title.lower() or
                keyword in task.description.lower()):
                results.append(task)

        return results

    def run(self):
        """运行主程序"""
        while True:
            print("\n" + "="*50)
            print("待办事项应用".center(46))
            print("="*50)
            print("1. 添加任务")
            print("2. 完成任务")
            print("3. 删除任务")
            print("4. 查看所有任务")
            print("5. 查看任务详情")
            print("6. 搜索任务")
            print("7. 按分类查看")
            print("8. 按优先级查看")
            print("9. 统计信息")
            print("0. 退出")
            print("="*50)

            choice = input("请选择操作: ").strip()

            try:
                if choice == "1":
                    print("\n--- 添加任务 ---")
                    title = input("任务标题: ").strip()
                    description = input("任务描述(可选): ").strip()
                    priority = input("优先级(high/medium/low,默认medium): ").strip() or "medium"
                    category = input("分类(默认general): ").strip() or "general"
                    due_days_str = input("几天后到期(可选): ").strip()

                    due_days = None
                    if due_days_str:
                        due_days = int(due_days_str)

                    self.add_task(title, description, priority, category, due_days)

                elif choice == "2":
                    print("\n--- 完成任务 ---")
                    task_id = int(input("任务ID: "))
                    self.complete_task(task_id)

                elif choice == "3":
                    print("\n--- 删除任务 ---")
                    task_id = int(input("任务ID: "))
                    self.remove_task(task_id)

                elif choice == "4":
                    show_completed = input("显示已完成任务?(y/n): ").lower() == "y"
                    self.show_tasks(show_completed=show_completed)

                elif choice == "5":
                    print("\n--- 查看任务详情 ---")
                    task_id = int(input("任务ID: "))
                    self.show_task_detail(task_id)

                elif choice == "6":
                    print("\n--- 搜索任务 ---")
                    keyword = input("关键词: ").strip()
                    results = self.search_tasks(keyword)
                    if results:
                        print(f"\n找到 {len(results)} 个结果:")
                        for task in results:
                            print(task)
                    else:
                        print("未找到匹配的任务")

                elif choice == "7":
                    print("\n--- 按分类查看 ---")
                    category = input("分类: ").strip()
                    self.show_tasks(category=category)

                elif choice == "8":
                    print("\n--- 按优先级查看 ---")
                    priority = input("优先级(high/medium/low): ").strip()
                    self.show_tasks(priority=priority)

                elif choice == "9":
                    self.get_statistics()

                elif choice == "0":
                    print("\n再见!")
                    break

                else:
                    print("无效选择")

            except ValueError as e:
                print(f"输入错误: {e}")
            except KeyboardInterrupt:
                print("\n\n操作已取消")
            except Exception as e:
                print(f"发生错误: {e}")

# 使用示例
if __name__ == "__main__":
    app = TodoApp()

    # 添加示例任务
    app.add_task("完成Python教程", "学完第25章", "high", "学习", 7)
    app.add_task("买菜", "番茄、土豆、鸡蛋", "medium", "生活", 1)
    app.add_task("写项目报告", "", "high", "工作", 3)

    # 显示任务
    app.show_tasks()
    app.get_statistics()

    # 启动交互界面(取消注释运行)
    # app.run()
```

## 项目3：记账本程序

一个功能完整的个人财务管理工具,支持收支记录、分类统计、预算管理等。

### 完整实现

```python
from datetime import datetime, timedelta
import csv
import json
from collections import defaultdict

class ExpenseTracker:
    """记账本程序"""

    def __init__(self, csv_file="expenses.csv", budget_file="budget.json"):
        """初始化记账本"""
        self.csv_file = csv_file
        self.budget_file = budget_file
        self.expenses = []
        self.budgets = {}
        self.load_expenses()
        self.load_budgets()

    def load_expenses(self):
        """加载记录"""
        try:
            with open(self.csv_file, "r", encoding="utf-8") as f:
                reader = csv.DictReader(f)
                self.expenses = list(reader)
            print(f"成功加载 {len(self.expenses)} 条记录")
        except FileNotFoundError:
            print("创建新的记账本")
            self.expenses = []

    def save_expenses(self):
        """保存记录"""
        if not self.expenses:
            return

        with open(self.csv_file, "w", newline="", encoding="utf-8-sig") as f:
            fieldnames = ["日期", "类型", "分类", "金额", "描述"]
            writer = csv.DictWriter(f, fieldnames=fieldnames)
            writer.writeheader()
            writer.writerows(self.expenses)

    def load_budgets(self):
        """加载预算"""
        try:
            with open(self.budget_file, "r", encoding="utf-8") as f:
                self.budgets = json.load(f)
        except FileNotFoundError:
            self.budgets = {}

    def save_budgets(self):
        """保存预算"""
        with open(self.budget_file, "w", encoding="utf-8") as f:
            json.dump(self.budgets, f, ensure_ascii=False, indent=2)

    def add_expense(self, amount, category, description, expense_type="支出"):
        """添加记录"""
        record = {
            "日期": datetime.now().strftime("%Y-%m-%d"),
            "类型": expense_type,
            "分类": category,
            "金额": str(amount),
            "描述": description
        }
        self.expenses.append(record)
        self.save_expenses()

        type_text = "收入" if expense_type == "收入" else "支出"
        print(f"{type_text}记录已添加: {category} ¥{amount} - {description}")

    def get_summary(self, start_date=None, end_date=None):
        """获取汇总"""
        filtered = self._filter_by_date(start_date, end_date)

        if not filtered:
            print("没有记录")
            return

        # 分类统计
        income_total = 0
        expense_total = 0
        by_category = defaultdict(float)

        for record in filtered:
            amount = float(record["金额"])
            category = record["分类"]

            if record["类型"] == "收入":
                income_total += amount
            else:
                expense_total += amount
                by_category[category] += amount

        # 显示汇总
        print("\n" + "="*60)
        print("财务汇总".center(56))
        print("="*60)
        print(f"总收入: ¥{income_total:.2f}")
        print(f"总支出: ¥{expense_total:.2f}")
        print(f"结余: ¥{income_total - expense_total:.2f}")

        if by_category:
            print("\n支出分类:")
            print("-"*60)

            sorted_categories = sorted(by_category.items(),
                                      key=lambda x: x[1],
                                      reverse=True)

            for category, amount in sorted_categories:
                percentage = (amount / expense_total * 100) if expense_total > 0 else 0
                bar_length = int(percentage / 2)
                bar = "█" * bar_length

                print(f"{category:10s} ¥{amount:8.2f} ({percentage:5.1f}%) {bar}")

        print("="*60)

    def set_budget(self, category, amount):
        """设置预算"""
        self.budgets[category] = amount
        self.save_budgets()
        print(f"已设置 {category} 预算: ¥{amount}")

    def check_budget(self):
        """检查预算"""
        if not self.budgets:
            print("未设置预算")
            return

        # 获取本月数据
        now = datetime.now()
        start_of_month = now.replace(day=1, hour=0, minute=0, second=0)

        filtered = self._filter_by_date(
            start_of_month.strftime("%Y-%m-%d"),
            now.strftime("%Y-%m-%d")
        )

        # 统计本月支出
        by_category = defaultdict(float)
        for record in filtered:
            if record["类型"] == "支出":
                category = record["分类"]
                amount = float(record["金额"])
                by_category[category] += amount

        # 检查预算
        print("\n" + "="*70)
        print("预算检查".center(66))
        print("="*70)
        print(f"{'分类':<10} {'预算':<12} {'已用':<12} {'剩余':<12} {'状态':<10}")
        print("-"*70)

        for category, budget in self.budgets.items():
            used = by_category.get(category, 0)
            remaining = budget - used
            percentage = (used / budget * 100) if budget > 0 else 0

            if percentage >= 100:
                status = "⚠️  超支"
            elif percentage >= 80:
                status = "⚠️  接近"
            else:
                status = "✓ 正常"

            print(f"{category:<10} ¥{budget:<10.2f} ¥{used:<10.2f} "
                  f"¥{remaining:<10.2f} {status:<10}")

        print("="*70)

    def show_recent(self, days=7):
        """显示最近记录"""
        cutoff_date = (datetime.now() - timedelta(days=days)).strftime("%Y-%m-%d")
        recent = [r for r in self.expenses if r["日期"] >= cutoff_date]

        if not recent:
            print(f"最近{days}天没有记录")
            return

        print(f"\n最近{days}天的记录:")
        print("-"*70)
        print(f"{'日期':<12} {'类型':<6} {'分类':<10} {'金额':<10} {'描述':<20}")
        print("-"*70)

        for record in sorted(recent, key=lambda x: x["日期"], reverse=True):
            print(f"{record['日期']:<12} {record['类型']:<6} {record['分类']:<10} "
                  f"¥{record['金额']:<9} {record['描述']:<20}")

    def _filter_by_date(self, start_date=None, end_date=None):
        """按日期过滤"""
        filtered = self.expenses

        if start_date:
            filtered = [r for r in filtered if r["日期"] >= start_date]

        if end_date:
            filtered = [r for r in filtered if r["日期"] <= end_date]

        return filtered

    def run(self):
        """运行主程序"""
        while True:
            print("\n" + "="*50)
            print("个人记账本".center(46))
            print("="*50)
            print("1. 添加支出")
            print("2. 添加收入")
            print("3. 查看汇总")
            print("4. 最近记录")
            print("5. 设置预算")
            print("6. 检查预算")
            print("0. 退出")
            print("="*50)

            choice = input("请选择操作: ").strip()

            try:
                if choice == "1":
                    print("\n--- 添加支出 ---")
                    amount = float(input("金额: "))
                    category = input("分类(如:餐饮、交通、购物): ").strip()
                    description = input("描述: ").strip()
                    self.add_expense(amount, category, description, "支出")

                elif choice == "2":
                    print("\n--- 添加收入 ---")
                    amount = float(input("金额: "))
                    category = input("分类(如:工资、奖金、其他): ").strip()
                    description = input("描述: ").strip()
                    self.add_expense(amount, category, description, "收入")

                elif choice == "3":
                    print("\n--- 查看汇总 ---")
                    print("1. 全部")
                    print("2. 本月")
                    print("3. 自定义日期范围")
                    sub_choice = input("选择: ").strip()

                    start_date = None
                    end_date = None

                    if sub_choice == "2":
                        now = datetime.now()
                        start_date = now.replace(day=1).strftime("%Y-%m-%d")
                        end_date = now.strftime("%Y-%m-%d")
                    elif sub_choice == "3":
                        start_date = input("开始日期(YYYY-MM-DD): ").strip()
                        end_date = input("结束日期(YYYY-MM-DD): ").strip()

                    self.get_summary(start_date, end_date)

                elif choice == "4":
                    days_str = input("显示最近几天(默认7天): ").strip()
                    days = int(days_str) if days_str else 7
                    self.show_recent(days)

                elif choice == "5":
                    print("\n--- 设置预算 ---")
                    category = input("分类: ").strip()
                    amount = float(input("预算金额: "))
                    self.set_budget(category, amount)

                elif choice == "6":
                    self.check_budget()

                elif choice == "0":
                    print("\n再见!")
                    break

                else:
                    print("无效选择")

            except ValueError as e:
                print(f"输入错误: {e}")
            except KeyboardInterrupt:
                print("\n\n操作已取消")
            except Exception as e:
                print(f"发生错误: {e}")

# 使用示例
if __name__ == "__main__":
    tracker = ExpenseTracker()

    # 添加示例数据
    tracker.add_expense(50, "餐饮", "午餐")
    tracker.add_expense(30, "交通", "打车")
    tracker.add_expense(200, "购物", "衣服")
    tracker.add_expense(5000, "工资", "本月工资", "收入")

    # 设置预算
    tracker.set_budget("餐饮", 1000)
    tracker.set_budget("交通", 500)
    tracker.set_budget("购物", 1500)

    # 显示汇总
    tracker.get_summary()
    tracker.check_budget()

    # 启动交互界面(取消注释运行)
    # tracker.run()
```

## 项目4：简易博客系统

支持文章发布、标签管理、搜索等功能的博客系统。

### 完整实现

```python
import json
from datetime import datetime
import os

class Post:
    """文章类"""

    def __init__(self, title, content, tags=None):
        """初始化文章"""
        self.id = None
        self.title = title
        self.content = content
        self.tags = tags or []
        self.views = 0
        self.created_at = datetime.now()
        self.updated_at = datetime.now()

    def add_view(self):
        """增加浏览量"""
        self.views += 1

    def update(self, title=None, content=None, tags=None):
        """更新文章"""
        if title:
            self.title = title
        if content:
            self.content = content
        if tags is not None:
            self.tags = tags
        self.updated_at = datetime.now()

    def to_dict(self):
        """转换为字典"""
        return {
            "id": self.id,
            "title": self.title,
            "content": self.content,
            "tags": self.tags,
            "views": self.views,
            "created_at": self.created_at.isoformat(),
            "updated_at": self.updated_at.isoformat()
        }

    @classmethod
    def from_dict(cls, data):
        """从字典创建文章"""
        post = cls(data["title"], data["content"], data.get("tags", []))
        post.id = data.get("id")
        post.views = data.get("views", 0)
        post.created_at = datetime.fromisoformat(data["created_at"])
        post.updated_at = datetime.fromisoformat(data["updated_at"])
        return post

class Blog:
    """博客系统"""

    def __init__(self, filename="blog.json"):
        """初始化博客"""
        self.filename = filename
        self.posts = []
        self.next_id = 1
        self.load()

    def load(self):
        """加载文章"""
        if os.path.exists(self.filename):
            try:
                with open(self.filename, "r", encoding="utf-8") as f:
                    data = json.load(f)
                    self.posts = [Post.from_dict(p) for p in data["posts"]]
                    self.next_id = data.get("next_id", 1)
                print(f"成功加载 {len(self.posts)} 篇文章")
            except Exception as e:
                print(f"加载失败: {e}")
                self.posts = []
        else:
            print("创建新博客")

    def save(self):
        """保存文章"""
        try:
            data = {
                "posts": [p.to_dict() for p in self.posts],
                "next_id": self.next_id
            }
            with open(self.filename, "w", encoding="utf-8") as f:
                json.dump(data, f, ensure_ascii=False, indent=2)
            return True
        except Exception as e:
            print(f"保存失败: {e}")
            return False

    def create_post(self, title, content, tags=None):
        """创建文章"""
        post = Post(title, content, tags)
        post.id = self.next_id
        self.next_id += 1

        self.posts.append(post)

        if self.save():
            print(f"文章已发布: {title}")
            return post.id
        return None

    def get_post(self, post_id):
        """获取文章"""
        for post in self.posts:
            if post.id == post_id:
                post.add_view()
                self.save()
                return post
        return None

    def update_post(self, post_id, title=None, content=None, tags=None):
        """更新文章"""
        post = self.get_post(post_id)
        if not post:
            print(f"文章 {post_id} 不存在")
            return False

        post.update(title, content, tags)

        if self.save():
            print(f"文章已更新: {post.title}")
            return True
        return False

    def delete_post(self, post_id):
        """删除文章"""
        for post in self.posts:
            if post.id == post_id:
                self.posts.remove(post)
                if self.save():
                    print(f"文章已删除: {post.title}")
                    return True
                return False

        print(f"文章 {post_id} 不存在")
        return False

    def search_posts(self, keyword):
        """搜索文章"""
        keyword = keyword.lower()
        results = []

        for post in self.posts:
            if (keyword in post.title.lower() or
                keyword in post.content.lower() or
                any(keyword in tag.lower() for tag in post.tags)):
                results.append(post)

        return results

    def get_posts_by_tag(self, tag):
        """按标签获取文章"""
        return [p for p in self.posts if tag in p.tags]

    def get_all_tags(self):
        """获取所有标签"""
        all_tags = set()
        for post in self.posts:
            all_tags.update(post.tags)
        return sorted(all_tags)

    def show_post_list(self, posts=None):
        """显示文章列表"""
        if posts is None:
            posts = self.posts

        if not posts:
            print("没有文章")
            return

        # 按创建时间倒序
        sorted_posts = sorted(posts, key=lambda p: p.created_at, reverse=True)

        print("\n" + "="*80)
        print("文章列表".center(76))
        print("="*80)
        print(f"{'ID':<6} {'标题':<30} {'标签':<20} {'浏览':<8} {'日期':<14}")
        print("-"*80)

        for post in sorted_posts:
            tags_str = ", ".join(post.tags[:3])
            if len(post.tags) > 3:
                tags_str += "..."

            date_str = post.created_at.strftime("%Y-%m-%d %H:%M")

            title = post.title[:28] + ".." if len(post.title) > 30 else post.title

            print(f"{post.id:<6} {title:<30} {tags_str:<20} {post.views:<8} {date_str:<14}")

        print("="*80)
        print(f"总计: {len(posts)} 篇文章")

    def show_post_detail(self, post_id):
        """显示文章详情"""
        post = self.get_post(post_id)
        if not post:
            print(f"文章 {post_id} 不存在")
            return

        print("\n" + "="*80)
        print(f"ID: {post.id}")
        print(f"标题: {post.title}")
        print("-"*80)
        print(post.content)
        print("-"*80)

        if post.tags:
            print(f"标签: {', '.join(post.tags)}")

        print(f"浏览量: {post.views}")
        print(f"发布时间: {post.created_at.strftime('%Y-%m-%d %H:%M:%S')}")

        if post.updated_at != post.created_at:
            print(f"更新时间: {post.updated_at.strftime('%Y-%m-%d %H:%M:%S')}")

        print("="*80)

    def get_statistics(self):
        """获取统计信息"""
        if not self.posts:
            print("暂无文章")
            return

        total_posts = len(self.posts)
        total_views = sum(p.views for p in self.posts)
        all_tags = self.get_all_tags()

        # 最热文章
        top_posts = sorted(self.posts, key=lambda p: p.views, reverse=True)[:5]

        print("\n" + "="*60)
        print("博客统计".center(56))
        print("="*60)
        print(f"文章总数: {total_posts}")
        print(f"总浏览量: {total_views}")
        print(f"平均浏览: {total_views/total_posts:.1f}")
        print(f"标签数量: {len(all_tags)}")

        print("\n最热文章:")
        for i, post in enumerate(top_posts, 1):
            print(f"  {i}. {post.title} ({post.views} 次浏览)")

        print("="*60)

    def run(self):
        """运行主程序"""
        while True:
            print("\n" + "="*50)
            print("简易博客系统".center(46))
            print("="*50)
            print("1. 发布文章")
            print("2. 查看所有文章")
            print("3. 查看文章详情")
            print("4. 编辑文章")
            print("5. 删除文章")
            print("6. 搜索文章")
            print("7. 按标签查看")
            print("8. 查看所有标签")
            print("9. 统计信息")
            print("0. 退出")
            print("="*50)

            choice = input("请选择操作: ").strip()

            try:
                if choice == "1":
                    print("\n--- 发布文章 ---")
                    title = input("标题: ").strip()
                    print("内容(输入END结束):")
                    lines = []
                    while True:
                        line = input()
                        if line == "END":
                            break
                        lines.append(line)
                    content = "\n".join(lines)

                    tags_str = input("标签(逗号分隔): ").strip()
                    tags = [t.strip() for t in tags_str.split(",") if t.strip()]

                    self.create_post(title, content, tags)

                elif choice == "2":
                    self.show_post_list()

                elif choice == "3":
                    post_id = int(input("文章ID: "))
                    self.show_post_detail(post_id)

                elif choice == "4":
                    print("\n--- 编辑文章 ---")
                    post_id = int(input("文章ID: "))
                    post = self.get_post(post_id)

                    if post:
                        print(f"当前标题: {post.title}")
                        title = input("新标题(留空不修改): ").strip()

                        print("新内容(输入END结束,留空不修改):")
                        lines = []
                        while True:
                            line = input()
                            if line == "END":
                                break
                            lines.append(line)
                        content = "\n".join(lines) if lines else None

                        tags_str = input("新标签(逗号分隔,留空不修改): ").strip()
                        tags = [t.strip() for t in tags_str.split(",") if t.strip()] if tags_str else None

                        self.update_post(post_id, title or None, content, tags)

                elif choice == "5":
                    post_id = int(input("文章ID: "))
                    confirm = input("确认删除?(y/n): ").lower()
                    if confirm == "y":
                        self.delete_post(post_id)

                elif choice == "6":
                    keyword = input("关键词: ").strip()
                    results = self.search_posts(keyword)
                    if results:
                        print(f"\n找到 {len(results)} 篇文章:")
                        self.show_post_list(results)
                    else:
                        print("未找到匹配的文章")

                elif choice == "7":
                    tag = input("标签: ").strip()
                    results = self.get_posts_by_tag(tag)
                    if results:
                        print(f"\n标签 '{tag}' 下的文章:")
                        self.show_post_list(results)
                    else:
                        print(f"标签 '{tag}' 下没有文章")

                elif choice == "8":
                    tags = self.get_all_tags()
                    if tags:
                        print("\n所有标签:")
                        for tag in tags:
                            count = len(self.get_posts_by_tag(tag))
                            print(f"  {tag} ({count})")
                    else:
                        print("暂无标签")

                elif choice == "9":
                    self.get_statistics()

                elif choice == "0":
                    print("\n再见!")
                    break

                else:
                    print("无效选择")

            except ValueError as e:
                print(f"输入错误: {e}")
            except KeyboardInterrupt:
                print("\n\n操作已取消")
            except Exception as e:
                print(f"发生错误: {e}")

# 使用示例
if __name__ == "__main__":
    blog = Blog()

    # 发布示例文章
    blog.create_post(
        "Python入门指南",
        "Python是一门易学易用的编程语言...",
        ["Python", "编程", "教程"]
    )

    blog.create_post(
        "数据结构与算法",
        "学习数据结构和算法对编程很重要...",
        ["算法", "数据结构", "编程"]
    )

    # 显示文章列表
    blog.show_post_list()
    blog.get_statistics()

    # 启动交互界面(取消注释运行)
    # blog.run()
```

## 项目5：文件整理工具

自动整理文件的实用工具,按类型、日期等规则归类文件。

### 完整实现

```python
from pathlib import Path
import shutil
from datetime import datetime
import os

class FileOrganizer:
    """文件整理工具"""

    def __init__(self, source_dir):
        """初始化工具"""
        self.source_dir = Path(source_dir)

        # 文件类型映射
        self.file_types = {
            "图片": [".jpg", ".jpeg", ".png", ".gif", ".bmp", ".svg", ".ico"],
            "文档": [".txt", ".doc", ".docx", ".pdf", ".xlsx", ".xls", ".ppt", ".pptx"],
            "视频": [".mp4", ".avi", ".mkv", ".mov", ".flv", ".wmv"],
            "音频": [".mp3", ".wav", ".flac", ".aac", ".m4a"],
            "压缩包": [".zip", ".rar", ".7z", ".tar", ".gz"],
            "代码": [".py", ".java", ".cpp", ".c", ".js", ".html", ".css", ".go"],
            "可执行文件": [".exe", ".msi", ".dmg", ".app"]
        }

    def organize_by_type(self, dry_run=False):
        """按类型整理文件"""
        if not self.source_dir.exists():
            print(f"目录不存在: {self.source_dir}")
            return

        print(f"\n开始整理: {self.source_dir}")
        print(f"模式: {'预览' if dry_run else '执行'}")
        print("="*60)

        # 创建分类文件夹
        if not dry_run:
            for category in self.file_types.keys():
                category_dir = self.source_dir / category
                category_dir.mkdir(exist_ok=True)

        # 整理文件
        moved_count = 0
        file_count = {}

        for file in self.source_dir.iterdir():
            # 跳过目录
            if file.is_dir():
                continue

            # 查找文件类型
            category = self._get_category(file.suffix.lower())

            if category:
                dest_dir = self.source_dir / category
                dest = dest_dir / file.name

                # 处理重名
                if dest.exists():
                    base = file.stem
                    ext = file.suffix
                    counter = 1
                    while dest.exists():
                        new_name = f"{base}_{counter}{ext}"
                        dest = dest_dir / new_name
                        counter += 1

                # 移动文件
                action = "将移动" if dry_run else "移动"
                print(f"{action}: {file.name} -> {category}/")

                if not dry_run:
                    shutil.move(str(file), str(dest))

                moved_count += 1
                file_count[category] = file_count.get(category, 0) + 1

        # 显示统计
        print("="*60)
        print(f"\n整理{'预览' if dry_run else '完成'}:")
        for category, count in sorted(file_count.items()):
            print(f"  {category}: {count} 个文件")
        print(f"总计: {moved_count} 个文件")

    def organize_by_date(self, date_format="%Y-%m", dry_run=False):
        """按日期整理文件"""
        if not self.source_dir.exists():
            print(f"目录不存在: {self.source_dir}")
            return

        print(f"\n开始按日期整理: {self.source_dir}")
        print(f"日期格式: {date_format}")
        print("="*60)

        moved_count = 0
        date_folders = {}

        for file in self.source_dir.iterdir():
            if file.is_dir():
                continue

            # 获取文件修改时间
            mtime = datetime.fromtimestamp(file.stat().st_mtime)
            date_folder = mtime.strftime(date_format)

            # 创建日期文件夹
            date_dir = self.source_dir / date_folder
            if not dry_run:
                date_dir.mkdir(exist_ok=True)

            dest = date_dir / file.name

            # 处理重名
            if dest.exists():
                base = file.stem
                ext = file.suffix
                counter = 1
                while dest.exists():
                    new_name = f"{base}_{counter}{ext}"
                    dest = date_dir / new_name
                    counter += 1

            action = "将移动" if dry_run else "移动"
            print(f"{action}: {file.name} -> {date_folder}/")

            if not dry_run:
                shutil.move(str(file), str(dest))

            moved_count += 1
            date_folders[date_folder] = date_folders.get(date_folder, 0) + 1

        # 显示统计
        print("="*60)
        print(f"\n整理{'预览' if dry_run else '完成'}:")
        for folder, count in sorted(date_folders.items()):
            print(f"  {folder}: {count} 个文件")
        print(f"总计: {moved_count} 个文件")

    def clean_empty_folders(self):
        """清理空文件夹"""
        print(f"\n清理空文件夹: {self.source_dir}")
        print("="*60)

        removed_count = 0

        for item in self.source_dir.iterdir():
            if item.is_dir():
                try:
                    # 尝试删除空文件夹
                    item.rmdir()
                    print(f"删除空文件夹: {item.name}")
                    removed_count += 1
                except OSError:
                    # 文件夹不为空,跳过
                    pass

        print("="*60)
        print(f"删除了 {removed_count} 个空文件夹")

    def find_duplicates(self):
        """查找重复文件"""
        print(f"\n查找重复文件: {self.source_dir}")
        print("="*60)

        from collections import defaultdict

        # 按大小分组
        size_groups = defaultdict(list)

        for file in self.source_dir.rglob("*"):
            if file.is_file():
                size = file.stat().st_size
                size_groups[size].append(file)

        # 找出可能重复的文件
        duplicates = []
        for size, files in size_groups.items():
            if len(files) > 1:
                duplicates.extend(files)

        if duplicates:
            print(f"找到 {len(duplicates)} 个可能重复的文件:")

            # 按大小分组显示
            for size, files in size_groups.items():
                if len(files) > 1:
                    size_mb = size / (1024 * 1024)
                    print(f"\n大小: {size_mb:.2f} MB ({len(files)} 个文件)")
                    for file in files:
                        print(f"  {file.relative_to(self.source_dir)}")
        else:
            print("未找到重复文件")

    def get_statistics(self):
        """获取统计信息"""
        print(f"\n文件统计: {self.source_dir}")
        print("="*60)

        total_files = 0
        total_size = 0
        by_type = {}

        for file in self.source_dir.rglob("*"):
            if file.is_file():
                total_files += 1
                size = file.stat().st_size
                total_size += size

                category = self._get_category(file.suffix.lower())
                if category:
                    if category not in by_type:
                        by_type[category] = {"count": 0, "size": 0}
                    by_type[category]["count"] += 1
                    by_type[category]["size"] += size

        print(f"总文件数: {total_files}")
        print(f"总大小: {total_size / (1024**3):.2f} GB")

        if by_type:
            print("\n按类型统计:")
            print(f"{'类型':<10} {'数量':<10} {'大小':<15}")
            print("-"*40)

            for category, data in sorted(by_type.items()):
                size_mb = data["size"] / (1024**2)
                print(f"{category:<10} {data['count']:<10} {size_mb:>10.2f} MB")

        print("="*60)

    def _get_category(self, suffix):
        """根据后缀获取分类"""
        for category, extensions in self.file_types.items():
            if suffix in extensions:
                return category
        return None

    def run(self):
        """运行主程序"""
        while True:
            print("\n" + "="*50)
            print("文件整理工具".center(46))
            print("="*50)
            print(f"当前目录: {self.source_dir}")
            print("-"*50)
            print("1. 按类型整理")
            print("2. 按日期整理")
            print("3. 清理空文件夹")
            print("4. 查找重复文件")
            print("5. 文件统计")
            print("6. 更改目录")
            print("0. 退出")
            print("="*50)

            choice = input("请选择操作: ").strip()

            try:
                if choice == "1":
                    print("\n--- 按类型整理 ---")
                    dry_run = input("预览模式?(y/n): ").lower() == "y"
                    self.organize_by_type(dry_run)

                elif choice == "2":
                    print("\n--- 按日期整理 ---")
                    print("1. 按年月(%Y-%m)")
                    print("2. 按年(%Y)")
                    print("3. 按年月日(%Y-%m-%d)")
                    sub_choice = input("选择格式: ").strip()

                    formats = {
                        "1": "%Y-%m",
                        "2": "%Y",
                        "3": "%Y-%m-%d"
                    }
                    date_format = formats.get(sub_choice, "%Y-%m")

                    dry_run = input("预览模式?(y/n): ").lower() == "y"
                    self.organize_by_date(date_format, dry_run)

                elif choice == "3":
                    confirm = input("确认清理空文件夹?(y/n): ").lower()
                    if confirm == "y":
                        self.clean_empty_folders()

                elif choice == "4":
                    self.find_duplicates()

                elif choice == "5":
                    self.get_statistics()

                elif choice == "6":
                    new_dir = input("新目录路径: ").strip()
                    self.source_dir = Path(new_dir)
                    if not self.source_dir.exists():
                        print(f"警告: 目录不存在: {self.source_dir}")

                elif choice == "0":
                    print("\n再见!")
                    break

                else:
                    print("无效选择")

            except Exception as e:
                print(f"发生错误: {e}")

# 使用示例
if __name__ == "__main__":
    # 创建整理工具
    organizer = FileOrganizer(".")

    # 显示统计
    organizer.get_statistics()

    # 预览按类型整理
    organizer.organize_by_type(dry_run=True)

    # 启动交互界面(取消注释运行)
    # organizer.run()
```

## 开发最佳实践

### 1. 代码组织

```python
# ✅ 好的组织
project/
├── main.py           # 主程序
├── models.py         # 数据模型
├── utils.py          # 工具函数
├── config.py         # 配置文件
└── data/             # 数据目录
    └── students.json
```

### 2. 错误处理

```python
# ✅ 完善的错误处理
try:
    # 可能出错的代码
    with open("file.txt") as f:
        data = json.load(f)
except FileNotFoundError:
    print("文件不存在")
except json.JSONDecodeError:
    print("JSON格式错误")
except Exception as e:
    print(f"未知错误: {e}")
```

### 3. 用户体验

```python
# ✅ 友好的用户交互
while True:
    try:
        choice = input("请选择(1-5): ").strip()
        # 处理输入
        break
    except KeyboardInterrupt:
        print("\n\n操作已取消")
        continue
    except Exception as e:
        print(f"输入错误: {e}")
        continue
```

### 4. 数据验证

```python
# ✅ 验证输入
def validate_age(age):
    """验证年龄"""
    if not isinstance(age, int):
        raise TypeError("年龄必须是整数")
    if not 0 <= age <= 150:
        raise ValueError("年龄必须在0-150之间")
    return True
```

## 常见陷阱

### 陷阱1：忘记保存数据

```python
# ❌ 错误 - 修改后忘记保存
def add_student(self, student):
    self.students.append(student)
    # 忘记调用save()

# ✅ 正确 - 修改后立即保存
def add_student(self, student):
    self.students.append(student)
    self.save_data()  # 保存到文件
```

### 陷阱2：文件编码问题

```python
# ❌ 错误 - 未指定编码
with open("data.json", "w") as f:
    json.dump(data, f)  # 可能乱码

# ✅ 正确 - 指定UTF-8编码
with open("data.json", "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False)
```

### 陷阱3：没有错误处理

```python
# ❌ 危险 - 程序可能崩溃
age = int(input("年龄: "))  # 用户输入非数字会崩溃

# ✅ 安全 - 捕获异常
try:
    age = int(input("年龄: "))
except ValueError:
    print("请输入有效的数字")
    age = 0
```

## 练习题

### 练习1：图书管理系统

完善本章的图书管理系统:
- 添加借阅期限
- 实现逾期提醒
- 添加图书评分功能
- 导出借阅报告

### 练习2：个人日记本

创建一个日记本程序:
- 记录每天的日记
- 支持心情标签
- 搜索和筛选功能
- 导出为PDF

### 练习3：词汇学习工具

创建单词记忆工具:
- 添加单词和释义
- 随机测试
- 统计学习进度
- 生词本功能

### 练习4：健康打卡应用

创建习惯打卡应用:
- 记录运动、喝水、睡眠
- 统计坚持天数
- 生成打卡日历
- 目标管理

### 练习5：项目综合

选择一个你感兴趣的领域,设计并实现一个完整的项目:
- 明确需求
- 设计功能
- 编写代码
- 测试调试
- 写使用文档

## 下一步学习方向

恭喜你完成了Python入门教程!现在你可以继续学习:

### 1. Web开发
- **Flask** - 轻量级Web框架
- **Django** - 全栈Web框架
- **FastAPI** - 现代API框架

### 2. 数据分析
- **Pandas** - 数据处理
- **NumPy** - 科学计算
- **Matplotlib** - 数据可视化

### 3. 机器学习
- **Scikit-learn** - 机器学习库
- **TensorFlow** - 深度学习
- **PyTorch** - 深度学习

### 4. 自动化
- **Selenium** - 浏览器自动化
- **PyAutoGUI** - 桌面自动化
- **Schedule** - 任务调度

### 5. 爬虫
- **Requests** - HTTP请求
- **BeautifulSoup** - HTML解析
- **Scrapy** - 爬虫框架

## 🎉 结语

你已经掌握了Python的核心知识,现在可以:
- ✅ 独立开发实际应用
- ✅ 自动化日常任务
- ✅ 处理和分析数据
- ✅ 创建命令行工具
- ✅ 继续学习高级主题

**记住**:
- 编程是实践的艺术,多动手写代码
- 遇到问题先思考,再搜索,最后求助
- 保持好奇心,持续学习新技术
- 参与开源项目,阅读优秀代码
- 写好文档和注释,方便自己和他人

**继续前进,编程之路无限精彩!** 🚀

[上一章:第24章 - JSON和CSV处理 ←](../24-JSON和CSV处理/24-JSON和CSV处理.md)

[返回目录](../README.md)

---

**本章重点**
- ✅ 理解项目开发流程
- ✅ 掌握需求分析和功能设计
- ✅ 完成5个实战项目
- ✅ 学会代码组织和错误处理
- ✅ 了解开发最佳实践
- ✅ 明确后续学习方向

**记住**
- 从简单到复杂,逐步实现
- 代码要有良好的组织结构
- 错误处理必不可少
- 用户体验很重要
- 数据要及时保存
- 持续学习和实践