# 第14章：函数基础

函数是一段可重复使用的代码块，让程序更有组织性。

## 为什么要用函数？

```python
# 不用函数：重复代码
print("欢迎，张三！")
print("你好，张三！")
print("祝你愉快，张三！")

print("欢迎，李四！")
print("你好，李四！")
print("祝你愉快，李四！")

# 用函数：简洁明了
def greet(name):
    print(f"欢迎，{name}！")
    print(f"你好，{name}！")
    print(f"祝你愉快，{name}！")

greet("张三")
greet("李四")
```

**函数的好处**：
1. **代码重用** - 写一次，用多次
2. **易于维护** - 只需修改一处
3. **提高可读性** - 代码更有组织
4. **降低复杂度** - 分解大问题

## 定义函数

### 基本语法

```python
def function_name(parameters):
    """文档字符串（可选）"""
    # 函数体
    return result

# 简单例子
def say_hello():
    print("Hello!")

say_hello()  # 调用函数
```

### 命名规范

```python
# 好的函数名（动词开头，描述功能）
def calculate_area():
    pass

def get_user_input():
    pass

def print_result():
    pass

# 不好的函数名
def func():  # 太模糊
    pass

def data():  # 应该是动词
    pass
```

## 参数

### 无参数

```python
def say_hello():
    print("Hello, World!")

say_hello()
```

### 一个参数

```python
def greet(name):
    print(f"Hello, {name}!")

greet("小明")  # Hello, 小明!
```

### 多个参数

```python
def add(a, b):
    return a + b

result = add(3, 5)
print(result)  # 8
```

### 默认参数

```python
def greet(name, greeting="你好"):
    print(f"{greeting}, {name}!")

greet("小明")  # 你好, 小明!
greet("小红", "Hello")  # Hello, 小红!
```

**注意**：默认参数必须在后面

```python
# 错误
def func(a=1, b):  # SyntaxError
    pass

# 正确
def func(b, a=1):
    pass
```

### 关键字参数

```python
def describe_person(name, age, city):
    print(f"{name}, {age}岁, 来自{city}")

# 位置参数
describe_person("张三", 25, "北京")

# 关键字参数（可以改变顺序）
describe_person(city="上海", name="李四", age=30)

# 混合使用（位置参数必须在前）
describe_person("王五", city="广州", age=28)
```

## 返回值

### 返回单个值

```python
def square(x):
    return x ** 2

result = square(5)
print(result)  # 25
```

### 返回多个值

```python
def get_info():
    name = "张三"
    age = 25
    return name, age  # 实际返回元组

name, age = get_info()
print(name, age)  # 张三 25
```

### 没有返回值

```python
def print_message(msg):
    print(msg)
    # 没有return语句，默认返回None

result = print_message("Hello")
print(result)  # None
```

### 提前返回

```python
def is_even(num):
    if num % 2 == 0:
        return True
    return False

# 更简洁的写法
def is_even(num):
    return num % 2 == 0
```

## 文档字符串

描述函数功能的字符串。

```python
def calculate_area(width, height):
    """
    计算矩形面积

    参数:
        width: 宽度
        height: 高度

    返回:
        矩形面积
    """
    return width * height

# 查看文档
print(calculate_area.__doc__)
help(calculate_area)
```

## 实战例子

### 例子1：数学函数

```python
def factorial(n):
    """计算n的阶乘"""
    if n == 0 or n == 1:
        return 1
    result = 1
    for i in range(2, n + 1):
        result *= i
    return result

print(factorial(5))  # 120
```

### 例子2：判断质数

```python
def is_prime(n):
    """判断是否是质数"""
    if n < 2:
        return False
    for i in range(2, int(n ** 0.5) + 1):
        if n % i == 0:
            return False
    return True

# 测试
for num in range(20):
    if is_prime(num):
        print(num, end=" ")  # 2 3 5 7 11 13 17 19
```

### 例子3：温度转换

```python
def celsius_to_fahrenheit(celsius):
    """摄氏度转华氏度"""
    return celsius * 9/5 + 32

def fahrenheit_to_celsius(fahrenheit):
    """华氏度转摄氏度"""
    return (fahrenheit - 32) * 5/9

print(f"25°C = {celsius_to_fahrenheit(25):.1f}°F")
print(f"77°F = {fahrenheit_to_celsius(77):.1f}°C")
```

### 例子4：字符串处理

```python
def count_vowels(text):
    """统计元音字母数量"""
    vowels = "aeiouAEIOU"
    count = 0
    for char in text:
        if char in vowels:
            count += 1
    return count

text = "Hello World"
print(f"'{text}'中有{count_vowels(text)}个元音")
```

### 例子5：列表操作

```python
def find_max(numbers):
    """找出最大值"""
    if not numbers:
        return None
    max_num = numbers[0]
    for num in numbers:
        if num > max_num:
            max_num = num
    return max_num

numbers = [3, 7, 2, 9, 1, 5]
print(f"最大值：{find_max(numbers)}")
```

### 例子6：BMI计算器

```python
def calculate_bmi(weight, height):
    """
    计算BMI指数

    参数:
        weight: 体重（kg）
        height: 身高（m）

    返回:
        BMI值和评价
    """
    bmi = weight / (height ** 2)

    if bmi < 18.5:
        category = "偏瘦"
    elif bmi < 24:
        category = "正常"
    elif bmi < 28:
        category = "偏胖"
    else:
        category = "肥胖"

    return bmi, category

bmi, category = calculate_bmi(70, 1.75)
print(f"BMI: {bmi:.1f}, 分类: {category}")
```

### 例子7：密码验证

```python
def validate_password(password):
    """
    验证密码强度

    规则:
    - 长度>=8
    - 包含大写字母
    - 包含小写字母
    - 包含数字
    """
    if len(password) < 8:
        return False, "密码太短"

    has_upper = any(c.isupper() for c in password)
    has_lower = any(c.islower() for c in password)
    has_digit = any(c.isdigit() for c in password)

    if not has_upper:
        return False, "缺少大写字母"
    if not has_lower:
        return False, "缺少小写字母"
    if not has_digit:
        return False, "缺少数字"

    return True, "密码强度良好"

# 测试
passwords = ["abc", "Abc12345", "password", "Pass1234"]
for pwd in passwords:
    valid, message = validate_password(pwd)
    print(f"{pwd}: {message}")
```

### 例子8：成绩等级

```python
def get_grade(score):
    """根据分数返回等级"""
    if score < 0 or score > 100:
        return "无效分数"
    elif score >= 90:
        return "A"
    elif score >= 80:
        return "B"
    elif score >= 70:
        return "C"
    elif score >= 60:
        return "D"
    else:
        return "F"

scores = [95, 85, 75, 65, 55]
for score in scores:
    print(f"{score}分 = {get_grade(score)}等")
```

### 例子9：列表统计

```python
def list_stats(numbers):
    """返回列表的统计信息"""
    if not numbers:
        return None

    return {
        "count": len(numbers),
        "sum": sum(numbers),
        "average": sum(numbers) / len(numbers),
        "max": max(numbers),
        "min": min(numbers)
    }

numbers = [1, 5, 3, 9, 2, 7]
stats = list_stats(numbers)
for key, value in stats.items():
    print(f"{key}: {value}")
```

### 例子10：格式化输出

```python
def print_table(data, headers):
    """打印表格"""
    # 计算每列宽度
    widths = [len(h) for h in headers]
    for row in data:
        for i, item in enumerate(row):
            widths[i] = max(widths[i], len(str(item)))

    # 打印表头
    header_line = " | ".join(h.ljust(widths[i])
                             for i, h in enumerate(headers))
    print(header_line)
    print("-" * len(header_line))

    # 打印数据
    for row in data:
        row_line = " | ".join(str(item).ljust(widths[i])
                             for i, item in enumerate(row))
        print(row_line)

# 使用
headers = ["姓名", "年龄", "城市"]
data = [
    ["张三", 25, "北京"],
    ["李四", 30, "上海"],
    ["王五", 28, "广州"]
]
print_table(data, headers)
```

## 函数调用函数

函数可以调用其他函数。

```python
def is_even(n):
    """判断是否是偶数"""
    return n % 2 == 0

def count_even(numbers):
    """统计偶数个数"""
    count = 0
    for num in numbers:
        if is_even(num):  # 调用is_even函数
            count += 1
    return count

numbers = [1, 2, 3, 4, 5, 6]
print(f"偶数个数：{count_even(numbers)}")
```

## 递归函数

函数调用自己。

```python
# 计算阶乘
def factorial(n):
    if n == 0 or n == 1:
        return 1
    return n * factorial(n - 1)

print(factorial(5))  # 120

# 斐波那契数列
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print([fibonacci(i) for i in range(10)])
# [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
```

## 变量作用域

### 局部变量

```python
def my_function():
    x = 10  # 局部变量
    print(x)

my_function()
# print(x)  # NameError: x不存在
```

### 全局变量

```python
x = 10  # 全局变量

def my_function():
    print(x)  # 可以访问全局变量

my_function()  # 10
```

### global关键字

```python
count = 0  # 全局变量

def increment():
    global count  # 声明使用全局变量
    count += 1

increment()
increment()
print(count)  # 2
```

## 常见错误

### 错误1：忘记return

```python
def add(a, b):
    result = a + b
    # 忘记return

result = add(3, 5)
print(result)  # None
```

### 错误2：缩进错误

```python
def my_function():
print("Hello")  # IndentationError
```

### 错误3：参数顺序错误

```python
def divide(a, b):
    return a / b

# 注意参数顺序
print(divide(10, 2))  # 5.0
print(divide(2, 10))  # 0.2
```

## 练习题

### 练习1：计算最大公约数

```python
# 提示：使用辗转相除法
def gcd(a, b):
    pass
```

### 练习2：判断回文

```python
def is_palindrome(text):
    """判断是否是回文字符串"""
    pass
```

### 练习3：列表去重

```python
def remove_duplicates(lst):
    """去除列表中的重复元素，保持顺序"""
    pass
```

### 练习4：计算平均分

```python
def calculate_average(scores):
    """
    计算平均分，去掉最高和最低分
    """
    pass
```

### 练习5：生成随机密码

```python
def generate_password(length=8):
    """生成指定长度的随机密码"""
    pass
```

## 下一步

学会了函数基础，下一章我们学习函数进阶，包括各种参数类型！

[上一章：第13章 - 推导式 ←](../13-推导式/13-推导式.md)

[下一章：第15章 - 函数进阶 →](../15-函数进阶/15-函数进阶.md)

---

**本章重点**
- ✅ 用def定义函数
- ✅ 参数和返回值
- ✅ 默认参数和关键字参数
- ✅ 文档字符串
- ✅ 变量作用域
- ✅ 函数可以调用函数

**记住**
- 函数名用小写+下划线
- 参数名要有意义
- 一个函数只做一件事
- 给函数写文档字符串
- 默认参数必须在后面
- 局部变量在函数外不可见
