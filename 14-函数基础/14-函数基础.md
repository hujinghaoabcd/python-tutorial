# 第14章：函数基础

函数是一段可重复使用的代码块，让程序更有组织性。

## 什么是函数？

### 从生活中理解函数

想象一下你在使用微波炉：

**没有"加热"按钮的微波炉**：
- 每次热饭，你都要：
  1. 设置功率：800瓦
  2. 设置时间：2分钟
  3. 按启动
  4. 等待
  5. 听到"叮"的一声
  6. 取出食物
- 每次都要重复这6步！累不累？

**有"加热"按钮的微波炉**：
- 你只需：按一下"加热"按钮
- 微波炉自动完成那6步！

**编程中的函数就是这个"按钮"**：
- 把一系列操作打包成一个"按钮"（函数）
- 需要时只需按一下（调用函数）
- 避免重复写相同的代码

### 为什么需要函数？

**场景：计算圆的面积**

不用函数的写法：
```python
# 计算第一个圆的面积
radius1 = 5
area1 = 3.14159 * radius1 * radius1
print(f"半径{radius1}的圆，面积是{area1}")

# 计算第二个圆的面积（又写一遍！）
radius2 = 10
area2 = 3.14159 * radius2 * radius2
print(f"半径{radius2}的圆，面积是{area2}")

# 计算第三个圆的面积（又又写一遍！！）
radius3 = 7
area3 = 3.14159 * radius3 * radius3
print(f"半径{radius3}的圆，面积是{area3}")

# 如果要计算100个圆？要写100遍！
# 如果π的值要改成更精确的？要改100个地方！
```

用函数的写法：
```python
# 定义函数：把计算过程打包
def calculate_circle_area(radius):
    """计算圆的面积"""
    pi = 3.14159
    area = pi * radius * radius
    return area

# 使用函数：简单、清晰、不重复！
area1 = calculate_circle_area(5)
area2 = calculate_circle_area(10)
area3 = calculate_circle_area(7)

print(f"半径5的圆，面积是{area1}")
print(f"半径10的圆，面积是{area2}")
print(f"半径7的圆，面积是{area3}")

# 要计算100个圆？写100行调用就行！
# 要改π的值？只改函数里一个地方！
```

**对比结果**：
| 方面 | 不用函数 | 用函数 |
|-----|---------|--------|
| 代码量 | 计算3个圆=15行代码 | 定义1次+调用3次=7行代码 |
| 维护性 | 改π要改3个地方 | 改π只改1个地方 |
| 可读性 | 看不出在做什么 | 函数名一看就懂 |
| 扩展性 | 加圆要复制代码 | 加圆只需一行调用 |

### 函数的生活类比

**1. 函数 = 食谱**
```python
# 定义"做炒鸡蛋"这道菜的食谱（函数）
def make_scrambled_eggs(egg_count):
    """炒鸡蛋的做法"""
    print(f"1. 打{egg_count}个鸡蛋")
    print("2. 加盐、搅拌")
    print("3. 热油")
    print("4. 倒入蛋液，翻炒")
    print("5. 出锅")
    return f"{egg_count}人份炒鸡蛋"

# 使用食谱（调用函数）
dish1 = make_scrambled_eggs(2)  # 做2个鸡蛋的
dish2 = make_scrambled_eggs(4)  # 做4个鸡蛋的

# 你不用每次都记住具体步骤，只需要知道：
# "调用make_scrambled_eggs函数"就能做出炒鸡蛋！
```

**2. 函数 = 遥控器按钮**
```python
# 定义电视遥控器的功能（函数）
def turn_on_tv():
    """开机"""
    print("电视开机中...")
    print("显示画面")

def change_channel(channel_number):
    """换台"""
    print(f"切换到第{channel_number}频道")

def adjust_volume(volume):
    """调音量"""
    print(f"音量调到{volume}")

# 使用遥控器（调用函数）
turn_on_tv()                # 按开机键
change_channel(5)           # 按数字5
adjust_volume(20)           # 调音量到20

# 你不需要知道电视内部怎么工作
# 只需要按相应的按钮（调用函数）！
```

**3. 函数 = 自动售货机**
```python
# 定义售货机功能（函数）
def buy_drink(drink_name, money):
    """购买饮料"""
    prices = {
        "可乐": 3.0,
        "雪碧": 3.0,
        "水": 2.0
    }

    if drink_name not in prices:
        return "没有这种饮料"

    price = prices[drink_name]

    if money < price:
        return f"钱不够，还差{price - money}元"

    change = money - price
    return f"购买成功！找零{change}元"

# 使用售货机（调用函数）
result1 = buy_drink("可乐", 5)     # 买可乐，给5块
result2 = buy_drink("水", 2)       # 买水，给2块
result3 = buy_drink("奶茶", 10)    # 买奶茶（没有）

print(result1)  # 购买成功！找零2.0元
print(result2)  # 购买成功！找零0元
print(result3)  # 没有这种饮料

# 你输入（参数）：饮料名、钱
# 你得到（返回值）：结果信息
```

### 函数的核心概念

**1. 定义函数 = 教计算机做事**
```python
# 你教计算机："这样打招呼"
def greet(name):
    print(f"你好，{name}！")
    print(f"欢迎光临！")

# 定义后，计算机就"学会"了这个技能
```

**2. 调用函数 = 让计算机做事**
```python
# 你说："用这个方法打招呼，名字是'张三'"
greet("张三")

# 计算机执行：
# 你好，张三！
# 欢迎光临！
```

**3. 参数 = 输入**
```python
# 就像点餐：你说要什么（参数）
def make_coffee(size, sugar):
    """做咖啡"""
    print(f"制作{size}杯咖啡，{sugar}块糖")

# 你说："大杯，2块糖"（传入参数）
make_coffee("大", 2)
```

**4. 返回值 = 输出**
```python
# 就像ATM取钱：你取钱（调用），机器给你钱（返回）
def withdraw_money(amount):
    """取钱"""
    print(f"正在取{amount}元...")
    return amount  # 返回钱

money = withdraw_money(100)  # 接收返回的钱
print(f"收到{money}元")
```

### 函数的好处

**1. 代码重用（Don't Repeat Yourself）**
```python
# ❌ 没有函数：重复写5次
print("*" * 20)
print("欢迎使用本系统")
print("*" * 20)

print("*" * 20)
print("再见")
print("*" * 20)

print("*" * 20)
print("操作成功")
print("*" * 20)

# ✅ 用函数：写1次，用多次
def show_message(text):
    """显示带边框的消息"""
    print("*" * 20)
    print(text)
    print("*" * 20)

show_message("欢迎使用本系统")
show_message("再见")
show_message("操作成功")
```

**2. 易于维护**
```python
# 如果要改样式，比如改成用"="而不是"*"
# 不用函数：要改3个地方（容易漏改）
# 用函数：只改1个地方！

def show_message(text):
    """显示带边框的消息"""
    print("=" * 20)  # 只改这一行
    print(text)
    print("=" * 20)  # 和这一行
```

**3. 提高可读性**
```python
# ❌ 没有函数：不知道在做什么
result = (x ** 2 + y ** 2) ** 0.5

# ✅ 用函数：一看就懂
def calculate_distance(x, y):
    """计算两点距离"""
    return (x ** 2 + y ** 2) ** 0.5

result = calculate_distance(3, 4)  # 啊！在算距离
```

**4. 分解复杂问题**
```python
# 复杂任务：做一顿饭
# 不用函数：一个超长函数，几百行代码

# 用函数：分解成小步骤
def wash_vegetables():
    """洗菜"""
    pass

def cut_vegetables():
    """切菜"""
    pass

def cook():
    """炒菜"""
    pass

def serve():
    """装盘"""
    pass

# 主流程：清晰明了！
def make_dinner():
    """做晚饭"""
    wash_vegetables()
    cut_vegetables()
    cook()
    serve()
```

### 函数的本质

**函数是一个"黑盒子"**：
- 你不需要知道内部怎么实现的
- 你只需要知道：
  - **输入什么**（参数）
  - **得到什么**（返回值）
  - **做什么事**（功能）

```python
# 你用手机计算器算 2 + 3
# 你不需要知道CPU怎么做加法
# 你只需要：
# - 输入：2 和 3
# - 按：加号
# - 得到：5

# 函数也是这样
def add(a, b):
    """加法函数（黑盒子）"""
    # 内部实现（你可以不关心）
    return a + b

result = add(2, 3)  # 输入2和3，得到5
```

**为什么要用函数？**简单说就是：
1. **偷懒** - 不想重复写代码
2. **清晰** - 代码更好理解
3. **安全** - 改一处就全改了
4. **专业** - 这是所有程序员都用的方法

接下来，让我们详细学习如何定义和使用函数！

## 定义函数

### 基本语法

```python
def function_name(parameters):
    """文档字符串（可选）"""
    # 函数体
    return result

# 简单例子
def say_hello():
    print("Hello!")

say_hello()  # 调用函数
```

### 命名规范

```python
# 好的函数名（动词开头，描述功能）
def calculate_area():
    pass

def get_user_input():
    pass

def print_result():
    pass

# 不好的函数名
def func():  # 太模糊
    pass

def data():  # 应该是动词
    pass
```

## 参数

### 无参数

```python
def say_hello():
    print("Hello, World!")

say_hello()
```

### 一个参数

```python
def greet(name):
    print(f"Hello, {name}!")

greet("小明")  # Hello, 小明!
```

### 多个参数

```python
def add(a, b):
    return a + b

result = add(3, 5)
print(result)  # 8
```

### 默认参数

```python
def greet(name, greeting="你好"):
    print(f"{greeting}, {name}!")

greet("小明")  # 你好, 小明!
greet("小红", "Hello")  # Hello, 小红!
```

**注意**：默认参数必须在后面

```python
# 错误
def func(a=1, b):  # SyntaxError
    pass

# 正确
def func(b, a=1):
    pass
```

### 关键字参数

```python
def describe_person(name, age, city):
    print(f"{name}, {age}岁, 来自{city}")

# 位置参数
describe_person("张三", 25, "北京")

# 关键字参数（可以改变顺序）
describe_person(city="上海", name="李四", age=30)

# 混合使用（位置参数必须在前）
describe_person("王五", city="广州", age=28)
```

## 返回值

### 返回单个值

```python
def square(x):
    return x ** 2

result = square(5)
print(result)  # 25
```

### 返回多个值

```python
def get_info():
    name = "张三"
    age = 25
    return name, age  # 实际返回元组

name, age = get_info()
print(name, age)  # 张三 25
```

### 没有返回值

```python
def print_message(msg):
    print(msg)
    # 没有return语句，默认返回None

result = print_message("Hello")
print(result)  # None
```

### 提前返回

```python
def is_even(num):
    if num % 2 == 0:
        return True
    return False

# 更简洁的写法
def is_even(num):
    return num % 2 == 0
```

## 文档字符串

描述函数功能的字符串。

```python
def calculate_area(width, height):
    """
    计算矩形面积

    参数:
        width: 宽度
        height: 高度

    返回:
        矩形面积
    """
    return width * height

# 查看文档
print(calculate_area.__doc__)
help(calculate_area)
```

## 实战例子

### 例子1：数学函数

```python
def factorial(n):
    """计算n的阶乘"""
    if n == 0 or n == 1:
        return 1
    result = 1
    for i in range(2, n + 1):
        result *= i
    return result

print(factorial(5))  # 120
```

### 例子2：判断质数

```python
def is_prime(n):
    """判断是否是质数"""
    if n < 2:
        return False
    for i in range(2, int(n ** 0.5) + 1):
        if n % i == 0:
            return False
    return True

# 测试
for num in range(20):
    if is_prime(num):
        print(num, end=" ")  # 2 3 5 7 11 13 17 19
```

### 例子3：温度转换

```python
def celsius_to_fahrenheit(celsius):
    """摄氏度转华氏度"""
    return celsius * 9/5 + 32

def fahrenheit_to_celsius(fahrenheit):
    """华氏度转摄氏度"""
    return (fahrenheit - 32) * 5/9

print(f"25°C = {celsius_to_fahrenheit(25):.1f}°F")
print(f"77°F = {fahrenheit_to_celsius(77):.1f}°C")
```

### 例子4：字符串处理

```python
def count_vowels(text):
    """统计元音字母数量"""
    vowels = "aeiouAEIOU"
    count = 0
    for char in text:
        if char in vowels:
            count += 1
    return count

text = "Hello World"
print(f"'{text}'中有{count_vowels(text)}个元音")
```

### 例子5：列表操作

```python
def find_max(numbers):
    """找出最大值"""
    if not numbers:
        return None
    max_num = numbers[0]
    for num in numbers:
        if num > max_num:
            max_num = num
    return max_num

numbers = [3, 7, 2, 9, 1, 5]
print(f"最大值：{find_max(numbers)}")
```

### 例子6：BMI计算器

```python
def calculate_bmi(weight, height):
    """
    计算BMI指数

    参数:
        weight: 体重（kg）
        height: 身高（m）

    返回:
        BMI值和评价
    """
    bmi = weight / (height ** 2)

    if bmi < 18.5:
        category = "偏瘦"
    elif bmi < 24:
        category = "正常"
    elif bmi < 28:
        category = "偏胖"
    else:
        category = "肥胖"

    return bmi, category

bmi, category = calculate_bmi(70, 1.75)
print(f"BMI: {bmi:.1f}, 分类: {category}")
```

### 例子7：密码验证

```python
def validate_password(password):
    """
    验证密码强度

    规则:
    - 长度>=8
    - 包含大写字母
    - 包含小写字母
    - 包含数字
    """
    if len(password) < 8:
        return False, "密码太短"

    has_upper = any(c.isupper() for c in password)
    has_lower = any(c.islower() for c in password)
    has_digit = any(c.isdigit() for c in password)

    if not has_upper:
        return False, "缺少大写字母"
    if not has_lower:
        return False, "缺少小写字母"
    if not has_digit:
        return False, "缺少数字"

    return True, "密码强度良好"

# 测试
passwords = ["abc", "Abc12345", "password", "Pass1234"]
for pwd in passwords:
    valid, message = validate_password(pwd)
    print(f"{pwd}: {message}")
```

### 例子8：成绩等级

```python
def get_grade(score):
    """根据分数返回等级"""
    if score < 0 or score > 100:
        return "无效分数"
    elif score >= 90:
        return "A"
    elif score >= 80:
        return "B"
    elif score >= 70:
        return "C"
    elif score >= 60:
        return "D"
    else:
        return "F"

scores = [95, 85, 75, 65, 55]
for score in scores:
    print(f"{score}分 = {get_grade(score)}等")
```

### 例子9：列表统计

```python
def list_stats(numbers):
    """返回列表的统计信息"""
    if not numbers:
        return None

    return {
        "count": len(numbers),
        "sum": sum(numbers),
        "average": sum(numbers) / len(numbers),
        "max": max(numbers),
        "min": min(numbers)
    }

numbers = [1, 5, 3, 9, 2, 7]
stats = list_stats(numbers)
for key, value in stats.items():
    print(f"{key}: {value}")
```

### 例子10：格式化输出

```python
def print_table(data, headers):
    """打印表格"""
    # 计算每列宽度
    widths = [len(h) for h in headers]
    for row in data:
        for i, item in enumerate(row):
            widths[i] = max(widths[i], len(str(item)))

    # 打印表头
    header_line = " | ".join(h.ljust(widths[i])
                             for i, h in enumerate(headers))
    print(header_line)
    print("-" * len(header_line))

    # 打印数据
    for row in data:
        row_line = " | ".join(str(item).ljust(widths[i])
                             for i, item in enumerate(row))
        print(row_line)

# 使用
headers = ["姓名", "年龄", "城市"]
data = [
    ["张三", 25, "北京"],
    ["李四", 30, "上海"],
    ["王五", 28, "广州"]
]
print_table(data, headers)
```

## 函数调用函数

函数可以调用其他函数。

```python
def is_even(n):
    """判断是否是偶数"""
    return n % 2 == 0

def count_even(numbers):
    """统计偶数个数"""
    count = 0
    for num in numbers:
        if is_even(num):  # 调用is_even函数
            count += 1
    return count

numbers = [1, 2, 3, 4, 5, 6]
print(f"偶数个数：{count_even(numbers)}")
```

## 递归函数

函数调用自己。

```python
# 计算阶乘
def factorial(n):
    if n == 0 or n == 1:
        return 1
    return n * factorial(n - 1)

print(factorial(5))  # 120

# 斐波那契数列
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

print([fibonacci(i) for i in range(10)])
# [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
```

## 变量作用域

### 局部变量

```python
def my_function():
    x = 10  # 局部变量
    print(x)

my_function()
# print(x)  # NameError: x不存在
```

### 全局变量

```python
x = 10  # 全局变量

def my_function():
    print(x)  # 可以访问全局变量

my_function()  # 10
```

### global关键字

```python
count = 0  # 全局变量

def increment():
    global count  # 声明使用全局变量
    count += 1

increment()
increment()
print(count)  # 2
```

## 常见错误

### 错误1：忘记return

```python
def add(a, b):
    result = a + b
    # 忘记return

result = add(3, 5)
print(result)  # None
```

### 错误2：缩进错误

```python
def my_function():
print("Hello")  # IndentationError
```

### 错误3：参数顺序错误

```python
def divide(a, b):
    return a / b

# 注意参数顺序
print(divide(10, 2))  # 5.0
print(divide(2, 10))  # 0.2
```

## 练习题

### 练习1：计算最大公约数

```python
# 提示：使用辗转相除法
def gcd(a, b):
    pass
```

### 练习2：判断回文

```python
def is_palindrome(text):
    """判断是否是回文字符串"""
    pass
```

### 练习3：列表去重

```python
def remove_duplicates(lst):
    """去除列表中的重复元素，保持顺序"""
    pass
```

### 练习4：计算平均分

```python
def calculate_average(scores):
    """
    计算平均分，去掉最高和最低分
    """
    pass
```

### 练习5：生成随机密码

```python
def generate_password(length=8):
    """生成指定长度的随机密码"""
    pass
```

## 下一步

学会了函数基础，下一章我们学习函数进阶，包括各种参数类型！

[上一章：第13章 - 推导式 ←](../13-推导式/13-推导式.md)

[下一章：第15章 - 函数进阶 →](../15-函数进阶/15-函数进阶.md)

---

**本章重点**
- ✅ 用def定义函数
- ✅ 参数和返回值
- ✅ 默认参数和关键字参数
- ✅ 文档字符串
- ✅ 变量作用域
- ✅ 函数可以调用函数

**记住**
- 函数名用小写+下划线
- 参数名要有意义
- 一个函数只做一件事
- 给函数写文档字符串
- 默认参数必须在后面
- 局部变量在函数外不可见
