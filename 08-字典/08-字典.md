# 第08章：字典（Dictionary）

字典是Python中最强大的数据结构之一，用键值对（key-value）存储数据。

## 什么是字典？

### 从生活中理解字典

想象一下你在图书馆查资料：

**方式1：没有目录（像列表）**
- 你要找"Python编程"这本书
- 只能从第一本开始翻，一本本找
- 图书馆有10000本书，可能要找好久！

**方式2：用目录（像字典）**
- 你查目录："`Python编程`" → "3楼201架5层"
- 直接去那里，几分钟就找到了！

**Python的字典就是这样**：通过"关键词"(key)快速找到"对应信息"(value)。

### 字典 vs 列表

让我们对比一下：

```python
# 用列表存储学生信息 - 不直观
student_list = ["张三", 18, "男", 95]
# 问题：哪个是名字？哪个是年龄？记不住位置！
print(student_list[0])  # 张三（但你要记住0是名字）
print(student_list[1])  # 18（要记住1是年龄）

# 用字典存储 - 清晰明了！
student_dict = {
    "name": "张三",
    "age": 18,
    "gender": "男",
    "score": 95
}
# 通过有意义的key访问，一目了然！
print(student_dict["name"])   # 张三（直接用"name"这个key）
print(student_dict["age"])    # 18（直接用"age"这个key）
```

**字典的优势**：
1. **直观** - key是有意义的名字，不用记位置
2. **灵活** - 可以随时添加新的key-value
3. **快速** - 查找速度超快（用哈希表实现）
4. **适合复杂数据** - 可以嵌套、可以存各种类型

### 字典的生活应用场景

**场景1：通讯录**
```python
# 像手机通讯录：名字 → 电话号码
contacts = {
    "张三": "138-1234-5678",
    "李四": "139-8765-4321",
    "王五": "136-5555-6666"
}

# 要给张三打电话？直接查！
print(f"张三的电话：{contacts['张三']}")
```

**场景2：商品价格表**
```python
# 超市价格表：商品 → 价格
prices = {
    "苹果": 5.0,
    "香蕉": 3.0,
    "橙子": 4.0,
    "西瓜": 2.5
}

# 苹果多少钱？
print(f"苹果：¥{prices['苹果']}/斤")
```

**场景3：配置文件**
```python
# 程序配置：设置项 → 设置值
config = {
    "language": "中文",
    "theme": "dark",
    "font_size": 14,
    "auto_save": True
}

# 读取配置
if config["auto_save"]:
    print("自动保存已开启")
```

**场景4：用户信息**
```python
# 用户账户：各种信息都有
user = {
    "username": "zhangsan",
    "email": "zhangsan@example.com",
    "age": 25,
    "vip": True,
    "balance": 1888.88,
    "orders": [101, 102, 103]  # value可以是列表
}

print(f"用户名：{user['username']}")
print(f"余额：¥{user['balance']}")
print(f"VIP用户：{'是' if user['vip'] else '否'}")
```

### 字典的特点

1. **键值对存储**
   ```python
   # key : value
   {"name": "张三"}  # "name"是key，"张三"是value
   ```

2. **key必须唯一**
   ```python
   # ❌ 错误：重复的key，后面的会覆盖前面的
   d = {"name": "张三", "name": "李四"}
   print(d)  # {'name': '李四'}（张三被覆盖了）

   # ✅ 正确：每个key只出现一次
   d = {"name": "张三", "age": 18}
   ```

3. **key必须是不可变类型**
   ```python
   # ✅ 可以作为key的类型
   d = {
       "string": "字符串可以",
       123: "数字可以",
       (1, 2): "元组可以",
       True: "布尔值可以"
   }

   # ❌ 不能作为key的类型
   # d = {[1, 2]: "列表不行"}  # TypeError!
   # d = {{}: "字典不行"}      # TypeError!
   ```

4. **value可以是任何类型**
   ```python
   data = {
       "name": "张三",           # 字符串
       "age": 18,                # 数字
       "scores": [85, 90, 92],   # 列表
       "address": {              # 嵌套字典
           "city": "北京",
           "street": "长安街"
       },
       "active": True            # 布尔值
   }
   ```

5. **有序（Python 3.7+）**
   ```python
   # Python 3.7+保持插入顺序
   d = {"c": 3, "a": 1, "b": 2}
   print(d)  # {'c': 3, 'a': 1, 'b': 2}（保持插入顺序）

   # Python 3.6-：顺序不保证
   ```

### 字典的本质：哈希表

字典的底层使用**哈希表**（Hash Table）实现，这使得查找速度非常快：

```python
# 对比：查找速度
# 列表：O(n) - 需要逐个比较
students_list = [("张三", 18), ("李四", 19), ...]  # 10000个学生
# 要找"李四"？需要遍历，最坏情况查10000次

# 字典：O(1) - 直接定位
students_dict = {"张三": 18, "李四": 19, ...}  # 10000个学生
age = students_dict["李四"]  # 一次就找到！不管有多少学生
```

**为什么这么快？**
- Python用哈希函数把key转换成一个数字（哈希值）
- 用这个数字直接定位到value的位置
- 就像超市的商品条码，扫一下就知道价格

字典就像现实中的字典，通过"词"查"意思"，通过key查value。它是处理关联数据的最佳选择！

## 创建字典

### 直接创建

```python
# 空字典
empty = {}
empty = dict()

# 基本字典
person = {
    "name": "李四",
    "age": 25,
    "city": "北京"
}

# 各种类型的key和value
data = {
    "string": "文本",
    123: "数字key",
    (1, 2): "元组key",
    "list": [1, 2, 3],
    "dict": {"nested": "嵌套字典"}
}
```

### 用dict()创建

```python
# 从键值对列表
pairs = [("name", "王五"), ("age", 30)]
d = dict(pairs)

# 用关键字参数
person = dict(name="赵六", age=22, city="上海")

# 用zip组合两个列表
keys = ["name", "age", "city"]
values = ["孙七", 28, "广州"]
person = dict(zip(keys, values))
```

## 访问字典元素

### 用[]访问

```python
student = {"name": "小明", "age": 18, "score": 95}

# 通过key访问value
print(student["name"])   # 小明
print(student["score"])  # 95

# key不存在会报错
# print(student["gender"])  # KeyError!
```

### 用get()访问（推荐）

```python
student = {"name": "小明", "age": 18}

# get()方法，key不存在返回None
print(student.get("name"))    # 小明
print(student.get("gender"))  # None（不报错）

# 指定默认值
print(student.get("gender", "未知"))  # 未知
```

## 修改字典

### 修改value

```python
student = {"name": "小明", "age": 18}

# 修改已有的key
student["age"] = 19
print(student)  # {'name': '小明', 'age': 19}

# 添加新的key
student["score"] = 95
print(student)  # {'name': '小明', 'age': 19, 'score': 95}
```

### 删除元素

```python
student = {"name": "小明", "age": 18, "score": 95}

# del删除
del student["score"]
print(student)  # {'name': '小明', 'age': 18}

# pop()删除并返回value
age = student.pop("age")
print(age)      # 18
print(student)  # {'name': '小明'}

# popitem()删除并返回最后一个键值对（Python 3.7+保证顺序）
student = {"name": "小明", "age": 18}
item = student.popitem()
print(item)     # ('age', 18)

# clear()清空
student.clear()
print(student)  # {}
```

## 字典操作

### 检查key是否存在

```python
student = {"name": "小明", "age": 18}

# in 运算符
print("name" in student)     # True
print("gender" in student)   # False
print("gender" not in student)  # True
```

### 获取所有keys、values、items

```python
student = {"name": "小明", "age": 18, "score": 95}

# keys()
keys = student.keys()
print(keys)  # dict_keys(['name', 'age', 'score'])
print(list(keys))  # ['name', 'age', 'score']

# values()
values = student.values()
print(list(values))  # ['小明', 18, 95]

# items()（键值对）
items = student.items()
print(list(items))  # [('name', '小明'), ('age', 18), ('score', 95)]
```

### 合并字典

```python
dict1 = {"a": 1, "b": 2}
dict2 = {"c": 3, "d": 4}

# update()方法
dict1.update(dict2)
print(dict1)  # {'a': 1, 'b': 2, 'c': 3, 'd': 4}

# **解包（Python 3.5+）
dict1 = {"a": 1, "b": 2}
dict2 = {"c": 3, "d": 4}
merged = {**dict1, **dict2}
print(merged)  # {'a': 1, 'b': 2, 'c': 3, 'd': 4}

# | 运算符（Python 3.9+）
merged = dict1 | dict2
```

### 复制字典

```python
original = {"a": 1, "b": 2}

# 浅拷贝
copy1 = original.copy()
copy2 = dict(original)

# 深拷贝（嵌套字典）
import copy
nested = {"a": {"b": 1}}
deep = copy.deepcopy(nested)
```

## 遍历字典

### 遍历keys

```python
student = {"name": "小明", "age": 18, "score": 95}

# 默认遍历keys
for key in student:
    print(key, student[key])

# 明确遍历keys
for key in student.keys():
    print(key)
```

### 遍历values

```python
for value in student.values():
    print(value)
```

### 遍历items（最常用）

```python
for key, value in student.items():
    print(f"{key}: {value}")
```

## 字典推导式

快速创建字典。

```python
# 基本形式
squares = {x: x**2 for x in range(1, 6)}
print(squares)  # {1: 1, 2: 4, 3: 9, 4: 16, 5: 25}

# 带条件
even_squares = {x: x**2 for x in range(1, 11) if x % 2 == 0}
print(even_squares)  # {2: 4, 4: 16, 6: 36, 8: 64, 10: 100}

# 反转字典（key和value互换）
original = {"a": 1, "b": 2, "c": 3}
reversed_dict = {v: k for k, v in original.items()}
print(reversed_dict)  # {1: 'a', 2: 'b', 3: 'c'}
```

## 嵌套字典

字典的value可以是字典。

```python
# 学生数据库
students = {
    "student1": {
        "name": "张三",
        "age": 18,
        "scores": {"语文": 90, "数学": 95}
    },
    "student2": {
        "name": "李四",
        "age": 19,
        "scores": {"语文": 88, "数学": 92}
    }
}

# 访问嵌套数据
print(students["student1"]["name"])  # 张三
print(students["student1"]["scores"]["数学"])  # 95
```

## 默认字典（defaultdict）

自动为不存在的key提供默认值。

```python
from collections import defaultdict

# 普通字典
normal = {}
# normal["count"] += 1  # KeyError!

# defaultdict
counts = defaultdict(int)  # 默认值是0
counts["apple"] += 1
counts["banana"] += 1
counts["apple"] += 1
print(counts)  # defaultdict(<class 'int'>, {'apple': 2, 'banana': 1})

# 列表作为默认值
groups = defaultdict(list)
groups["fruits"].append("apple")
groups["fruits"].append("banana")
groups["vegetables"].append("carrot")
print(groups)  # {'fruits': ['apple', 'banana'], 'vegetables': ['carrot']}
```

## 有序字典（OrderedDict）

Python 3.7+，普通字典已经保证顺序了，OrderedDict不太需要了。

```python
from collections import OrderedDict

# 有序字典
od = OrderedDict()
od["a"] = 1
od["b"] = 2
od["c"] = 3

# 移动到末尾
od.move_to_end("a")
print(od)  # OrderedDict([('b', 2), ('c', 3), ('a', 1)])
```

## 实战例子

### 例子1：词频统计

```python
text = "apple banana apple orange banana apple"
words = text.split()

# 统计词频
word_count = {}
for word in words:
    word_count[word] = word_count.get(word, 0) + 1

print(word_count)
# {'apple': 3, 'banana': 2, 'orange': 1}

# 或者用Counter
from collections import Counter
word_count = Counter(words)
print(word_count)  # Counter({'apple': 3, 'banana': 2, 'orange': 1})
```

### 例子2：通讯录

```python
contacts = {}

def add_contact():
    name = input("姓名：")
    phone = input("电话：")
    contacts[name] = phone
    print("添加成功！")

def search_contact():
    name = input("查找姓名：")
    phone = contacts.get(name)
    if phone:
        print(f"{name}: {phone}")
    else:
        print("未找到")

def show_all():
    if contacts:
        for name, phone in contacts.items():
            print(f"{name}: {phone}")
    else:
        print("通讯录为空")

# 主菜单
while True:
    print("\n1.添加 2.查找 3.显示全部 4.退出")
    choice = input("选择：")
    if choice == "1":
        add_contact()
    elif choice == "2":
        search_contact()
    elif choice == "3":
        show_all()
    elif choice == "4":
        break
```

### 例子3：学生成绩管理

```python
students = {
    "张三": {"语文": 90, "数学": 95, "英语": 88},
    "李四": {"语文": 88, "数学": 92, "英语": 90},
    "王五": {"语文": 95, "数学": 89, "英语": 91}
}

# 计算每个学生的平均分
print("学生\t语文\t数学\t英语\t平均分")
print("-" * 50)
for name, scores in students.items():
    avg = sum(scores.values()) / len(scores)
    print(f"{name}\t{scores['语文']}\t{scores['数学']}\t{scores['英语']}\t{avg:.1f}")

# 计算每科的平均分
subjects = ["语文", "数学", "英语"]
for subject in subjects:
    total = sum(s[subject] for s in students.values())
    avg = total / len(students)
    print(f"{subject}平均分：{avg:.1f}")
```

### 例子4：商品库存管理

```python
inventory = {
    "apple": {"price": 5.0, "quantity": 100},
    "banana": {"price": 3.0, "quantity": 150},
    "orange": {"price": 4.0, "quantity": 80}
}

def show_inventory():
    print("商品\t单价\t库存")
    print("-" * 30)
    for product, info in inventory.items():
        print(f"{product}\t¥{info['price']}\t{info['quantity']}")

def sell(product, quantity):
    if product in inventory:
        if inventory[product]["quantity"] >= quantity:
            inventory[product]["quantity"] -= quantity
            total = inventory[product]["price"] * quantity
            print(f"售出{quantity}个{product}，总价¥{total}")
        else:
            print("库存不足")
    else:
        print("商品不存在")

show_inventory()
sell("apple", 10)
show_inventory()
```

### 例子5：配置文件

```python
# 应用配置
config = {
    "database": {
        "host": "localhost",
        "port": 5432,
        "name": "mydb"
    },
    "server": {
        "host": "0.0.0.0",
        "port": 8000
    },
    "debug": True
}

# 获取配置
db_host = config["database"]["host"]
server_port = config["server"]["port"]

print(f"数据库：{db_host}")
print(f"服务器端口：{server_port}")
```

## 常见陷阱

### 陷阱1：key必须是不可变类型

```python
# 正确的key类型
d = {
    "string": 1,
    123: 2,
    (1, 2): 3
}

# 错误的key类型
# d = {[1, 2]: "value"}  # TypeError: unhashable type: 'list'
# d = {{}: "value"}      # TypeError: unhashable type: 'dict'
```

### 陷阱2：修改字典时遍历

```python
# 错误：遍历时修改
d = {"a": 1, "b": 2, "c": 3}
# for key in d:
#     if d[key] == 2:
#         del d[key]  # RuntimeError!

# 正确：先复制keys
for key in list(d.keys()):
    if d[key] == 2:
        del d[key]
```

### 陷阱3：字典是引用

```python
d1 = {"a": 1}
d2 = d1  # d2和d1指向同一个字典
d2["b"] = 2
print(d1)  # {'a': 1, 'b': 2}，d1也变了！

# 正确：复制
d2 = d1.copy()
```

## 练习题

### 练习1：反转字典

将字典的key和value互换。

### 练习2：合并字典

合并两个字典，如果有重复key，保留第二个字典的value。

### 练习3：字典排序

按value对字典排序。

### 练习4：分组

将列表中的元素按某个属性分组。

```python
students = [
    {"name": "张三", "class": "A"},
    {"name": "李四", "class": "B"},
    {"name": "王五", "class": "A"}
]
# 结果：{'A': [张三, 王五], 'B': [李四]}
```

### 练习5：嵌套字典查找

从嵌套字典中安全地获取值，如果路径不存在返回None。

```python
data = {"a": {"b": {"c": 123}}}
# get_nested(data, ["a", "b", "c"]) → 123
# get_nested(data, ["a", "x", "y"]) → None
```

## 下一步

学完了字典，下一章我们学习集合（Set），一种自动去重的数据结构！

[上一章：第07章 - 元组 ←](../07-元组/07-元组.md)

[下一章：第09章 - 集合 →](../09-集合/09-集合.md)

---

**本章重点**
- ✅ 字典是键值对（key-value）结构
- ✅ 用{}或dict()创建
- ✅ 用get()方法安全访问
- ✅ 遍历用items()最方便
- ✅ key必须是不可变类型
- ✅ Python 3.7+字典保持插入顺序

**记住**
- 字典查找速度非常快（O(1)）
- key必须唯一，重复会覆盖
- get()比[]更安全
- 字典推导式很强大
- 遍历时不要修改字典
