# ç¬¬19ç« ï¼šå¼‚å¸¸å¤„ç†

å­¦ä¹ å¦‚ä½•ä¼˜é›…åœ°å¤„ç†é”™è¯¯ï¼Œè®©ç¨‹åºæ›´å¥å£®ã€ç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚

## ä»€ä¹ˆæ˜¯å¼‚å¸¸ï¼Ÿ

### ä»ç”Ÿæ´»ä¸­ç†è§£å¼‚å¸¸

æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼šä½ å¼€è½¦å»ä¸Šç­ï¼Œæ­£å¸¸æƒ…å†µä¸‹ä¸€åˆ‡é¡ºåˆ©ã€‚ä½†çªç„¶ï¼š
- è½¦æ²¡æ²¹äº† â›½
- å‰æ–¹é“è·¯æ–½å·¥ï¼Œéœ€è¦ç»•è·¯ ğŸš§
- é‡åˆ°äº†äº¤é€šäº‹æ•… ğŸš—

å¦‚æœä½ æ²¡æœ‰ä»»ä½•åº”å¯¹æªæ–½ï¼Œä½ å°±ä¼šè¢«å›°åœ¨è·¯ä¸Šï¼Œæ— æ³•åˆ°è¾¾å…¬å¸ã€‚ä½†å¦‚æœä½ ï¼š
- **æå‰æ£€æŸ¥æ²¹é‡**ï¼Œæ²¹ä¸å¤Ÿå°±å»åŠ æ²¹ï¼ˆé¢„é˜²å¼‚å¸¸ï¼‰
- **é‡åˆ°æ–½å·¥æ—¶çœ‹å¯¼èˆª**ï¼Œæ‰¾åˆ°æ›¿ä»£è·¯çº¿ï¼ˆå¤„ç†å¼‚å¸¸ï¼‰
- **å‘ç”Ÿäº‹æ•…æ—¶æ‰“ç”µè¯**ï¼Œè”ç³»æ‹–è½¦å’Œä¿é™©ï¼ˆå¼‚å¸¸æ¢å¤ï¼‰

è¿™æ ·ä½ å°±èƒ½å¤„ç†è¿™äº›"æ„å¤–æƒ…å†µ"ï¼Œæœ€ç»ˆè¿˜æ˜¯èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚

**ç¨‹åºä¸­çš„å¼‚å¸¸å°±æ˜¯è¿™æ ·çš„"æ„å¤–æƒ…å†µ"**ï¼š
- ç”¨æˆ·è¾“å…¥äº†æ— æ•ˆçš„æ•°æ®ï¼ˆæ¯”å¦‚è¦æ±‚è¾“å…¥æ•°å­—ï¼Œå´è¾“å…¥äº†æ–‡å­—ï¼‰
- è¦è¯»å–çš„æ–‡ä»¶ä¸å­˜åœ¨
- ç½‘ç»œè¿æ¥çªç„¶æ–­å¼€
- é™¤æ•°ä¸ºé›¶
- å†…å­˜ä¸è¶³

å¦‚æœä¸å¤„ç†è¿™äº›å¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šåƒè½¦æ²¡æ²¹ä¸€æ ·"æŠ›é”š"â€”â€”ç›´æ¥å´©æºƒï¼

### å¼‚å¸¸å¤„ç†çš„é‡è¦æ€§

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªçœŸå®çš„ä¾‹å­ã€‚å‡è®¾ä½ å†™äº†ä¸€ä¸ªåœ¨çº¿å•†åŸçš„è®¢å•ç³»ç»Ÿï¼š

```python
# æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ä»£ç  - å±é™©ï¼
def process_order(order_id):
    order = database.get_order(order_id)  # å¦‚æœè®¢å•ä¸å­˜åœ¨ï¼Ÿå´©æºƒï¼
    payment = process_payment(order.amount)  # å¦‚æœæ”¯ä»˜å¤±è´¥ï¼Ÿå´©æºƒï¼
    inventory = update_inventory(order.items)  # å¦‚æœåº“å­˜ä¸è¶³ï¼Ÿå´©æºƒï¼
    send_confirmation_email(order.email)  # å¦‚æœé‚®ä»¶æœåŠ¡å™¨å®•æœºï¼Ÿå´©æºƒï¼
    return "è®¢å•å¤„ç†æˆåŠŸ"

# ç”¨æˆ·çœ‹åˆ°çš„ç»“æœï¼šç™½å±ã€500é”™è¯¯ã€æˆ–è€…ç¨‹åºç›´æ¥é€€å‡º
# æ›´ç³Ÿç³•çš„æ˜¯ï¼šå¯èƒ½é’±æ‰£äº†ï¼Œä½†è®¢å•æ²¡å¤„ç†ï¼Œå•†å“ä¹Ÿæ²¡å‘è´§ï¼
```

ç°åœ¨æˆ‘ä»¬åŠ ä¸Šå¼‚å¸¸å¤„ç†ï¼š

```python
# æœ‰å¼‚å¸¸å¤„ç†çš„ä»£ç  - å®‰å…¨ï¼
def process_order(order_id):
    try:
        # å°è¯•è·å–è®¢å•
        order = database.get_order(order_id)
    except OrderNotFoundError:
        return "è®¢å•ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥è®¢å•å·"

    try:
        # å°è¯•å¤„ç†æ”¯ä»˜
        payment = process_payment(order.amount)
    except PaymentFailedError as e:
        return f"æ”¯ä»˜å¤±è´¥ï¼š{e.reason}ï¼Œè¯·æ£€æŸ¥æ”¯ä»˜æ–¹å¼"

    try:
        # å°è¯•æ›´æ–°åº“å­˜
        inventory = update_inventory(order.items)
    except InsufficientStockError:
        # æ”¯ä»˜æˆåŠŸä½†åº“å­˜ä¸è¶³ï¼Œéœ€è¦é€€æ¬¾
        refund_payment(payment)
        return "å•†å“åº“å­˜ä¸è¶³ï¼Œå·²é€€æ¬¾åˆ°åŸæ”¯ä»˜è´¦æˆ·"

    try:
        # å°è¯•å‘é€ç¡®è®¤é‚®ä»¶
        send_confirmation_email(order.email)
    except EmailError:
        # é‚®ä»¶å‘é€å¤±è´¥ä¸å½±å“è®¢å•ï¼Œè®°å½•åˆ°æ—¥å¿—å³å¯
        log_warning("ç¡®è®¤é‚®ä»¶å‘é€å¤±è´¥")

    return "è®¢å•å¤„ç†æˆåŠŸï¼"

# ç”¨æˆ·çœ‹åˆ°çš„ç»“æœï¼šæ¸…æ™°çš„é”™è¯¯æç¤ºï¼Œæˆ–è€…æˆåŠŸæ¶ˆæ¯
# æœ€é‡è¦çš„æ˜¯ï¼šæ¯ä¸€æ­¥éƒ½åœ¨æ§åˆ¶ä¹‹ä¸­ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼
```

çœ‹åˆ°åŒºåˆ«äº†å—ï¼Ÿ**å¼‚å¸¸å¤„ç†è®©ä½ çš„ç¨‹åºä»"è„†å¼±æ˜“ç¢"å˜æˆ"åšéŸ§å¯é "**ï¼

### å¼‚å¸¸ vs é”™è¯¯ï¼šæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

å¾ˆå¤šåˆå­¦è€…ä¼šæ··æ·†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼š

**è¯­æ³•é”™è¯¯ï¼ˆSyntax Errorï¼‰**ï¼š
- ä»£ç å†™é”™äº†ï¼ŒPythonè§£é‡Šå™¨è¿è¿è¡Œéƒ½ä¸è®©
- å°±åƒå†™ä½œæ–‡æ—¶å†™äº†é”™åˆ«å­—ï¼Œè€å¸ˆè¿çœ‹éƒ½ä¸çœ‹å°±é€€å›æ¥
- å¿…é¡»ä¿®æ”¹ä»£ç æ‰èƒ½è¿è¡Œ

```python
# è¯­æ³•é”™è¯¯ç¤ºä¾‹
if x > 10  # ç¼ºå°‘å†’å·ï¼Œè¿™æ˜¯è¯­æ³•é”™è¯¯
    print("å¤§äº10")

# Pythonç›´æ¥æŠ¥é”™ï¼šSyntaxError: invalid syntax
# ç¨‹åºæ ¹æœ¬ä¸ä¼šè¿è¡Œ
```

**å¼‚å¸¸ï¼ˆExceptionï¼‰**ï¼š
- ä»£ç è¯­æ³•æ­£ç¡®ï¼Œä½†è¿è¡Œæ—¶å‡ºç°äº†é—®é¢˜
- å°±åƒä½œæ–‡æ²¡æœ‰é”™åˆ«å­—ï¼Œä½†å†…å®¹æœ‰é—®é¢˜ï¼ˆæ¯”å¦‚æ•°æ®ä¸å¯¹ï¼‰
- å¯ä»¥é€šè¿‡try-exceptæ¥å¤„ç†ï¼Œè®©ç¨‹åºç»§ç»­è¿è¡Œ

```python
# å¼‚å¸¸ç¤ºä¾‹
x = 10
y = 0
result = x / y  # è¯­æ³•æ­£ç¡®ï¼Œä½†è¿è¡Œæ—¶ä¼šå‡ºé”™

# Pythonè¿è¡Œæ—¶æŠ¥é”™ï¼šZeroDivisionError: division by zero
# ä½†è¿™ä¸ªé”™è¯¯å¯ä»¥é€šè¿‡try-exceptæ¥æ•è·å’Œå¤„ç†
```

**ç®€å•è®°å¿†**ï¼š
- **è¯­æ³•é”™è¯¯** = ä»£ç æœ¬èº«å†™é”™äº†ï¼Œ**å¿…é¡»æ”¹ä»£ç **
- **å¼‚å¸¸** = ä»£ç æ²¡é”™ï¼Œä½†è¿è¡Œæ—¶é‡åˆ°äº†é—®é¢˜ï¼Œ**å¯ä»¥é€šè¿‡ä»£ç å¤„ç†**

### ä¸å¤„ç†å¼‚å¸¸ä¼šæ€æ ·ï¼Ÿ

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç°å®ä¸­çš„ä¾‹å­ï¼š

```python
# ä¸€ä¸ªç®€å•çš„ç”¨æˆ·æ³¨å†Œç¨‹åº
def register_user():
    print("=== ç”¨æˆ·æ³¨å†Œ ===")
    username = input("è¯·è¾“å…¥ç”¨æˆ·å: ")
    age = int(input("è¯·è¾“å…¥å¹´é¾„: "))  # å¦‚æœç”¨æˆ·è¾“å…¥"abc"å‘¢ï¼Ÿ
    email = input("è¯·è¾“å…¥é‚®ç®±: ")

    # ä¿å­˜åˆ°æ–‡ä»¶
    with open("users.txt", "a") as f:
        f.write(f"{username},{age},{email}\n")

    print("æ³¨å†ŒæˆåŠŸï¼")

# æµ‹è¯•è¿è¡Œ
register_user()

# å¦‚æœç”¨æˆ·è¾“å…¥å¹´é¾„æ—¶è¾“å…¥äº†"äºŒåå²"ï¼š
# === ç”¨æˆ·æ³¨å†Œ ===
# è¯·è¾“å…¥ç”¨æˆ·å: å¼ ä¸‰
# è¯·è¾“å…¥å¹´é¾„: äºŒåå²
# Traceback (most recent call last):
#   File "register.py", line 3, in register_user
#     age = int(input("è¯·è¾“å…¥å¹´é¾„: "))
# ValueError: invalid literal for int() with base 10: 'äºŒåå²'
#
# ç¨‹åºç›´æ¥å´©æºƒï¼ç”¨æˆ·çœ‹åˆ°ä¸€å †é”™è¯¯ä¿¡æ¯ï¼Œä½“éªŒå¾ˆå·®
```

åŠ ä¸Šå¼‚å¸¸å¤„ç†åï¼š

```python
# æ”¹è¿›çš„æ³¨å†Œç¨‹åº
def register_user():
    print("=== ç”¨æˆ·æ³¨å†Œ ===")
    username = input("è¯·è¾“å…¥ç”¨æˆ·å: ")

    # å¤„ç†å¹´é¾„è¾“å…¥çš„å¼‚å¸¸
    while True:
        try:
            age = int(input("è¯·è¾“å…¥å¹´é¾„: "))
            if age < 0 or age > 150:
                print("å¹´é¾„ä¸åˆç†ï¼Œè¯·è¾“å…¥0-150ä¹‹é—´çš„æ•°å­—")
                continue
            break  # è¾“å…¥æœ‰æ•ˆï¼Œè·³å‡ºå¾ªç¯
        except ValueError:
            print("å¹´é¾„å¿…é¡»æ˜¯æ•°å­—ï¼Œè¯·é‡æ–°è¾“å…¥")

    email = input("è¯·è¾“å…¥é‚®ç®±: ")

    # å¤„ç†æ–‡ä»¶å†™å…¥çš„å¼‚å¸¸
    try:
        with open("users.txt", "a", encoding="utf-8") as f:
            f.write(f"{username},{age},{email}\n")
        print("âœ… æ³¨å†ŒæˆåŠŸï¼")
    except PermissionError:
        print("âŒ æ— æ³•ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼šæ²¡æœ‰æ–‡ä»¶å†™å…¥æƒé™")
    except IOError as e:
        print(f"âŒ ä¿å­˜å¤±è´¥ï¼š{e}")

# æµ‹è¯•è¿è¡Œ
register_user()

# ç°åœ¨çš„ç”¨æˆ·ä½“éªŒï¼š
# === ç”¨æˆ·æ³¨å†Œ ===
# è¯·è¾“å…¥ç”¨æˆ·å: å¼ ä¸‰
# è¯·è¾“å…¥å¹´é¾„: äºŒåå²
# å¹´é¾„å¿…é¡»æ˜¯æ•°å­—ï¼Œè¯·é‡æ–°è¾“å…¥
# è¯·è¾“å…¥å¹´é¾„: 20
# è¯·è¾“å…¥é‚®ç®±: zhangsan@example.com
# âœ… æ³¨å†ŒæˆåŠŸï¼
#
# ç¨‹åºä¸ä¼šå´©æºƒï¼Œè€Œæ˜¯å‹å¥½åœ°æç¤ºç”¨æˆ·é‡æ–°è¾“å…¥ï¼
```

**æ€»ç»“ä¸€ä¸‹å¼‚å¸¸å¤„ç†çš„å¥½å¤„**ï¼š
1. **ç¨‹åºä¸ä¼šå´©æºƒ** - å³ä½¿å‡ºé”™ä¹Ÿèƒ½ç»§ç»­è¿è¡Œ
2. **ç”¨æˆ·ä½“éªŒå¥½** - æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼Œè€Œä¸æ˜¯å“äººçš„é”™è¯¯å †æ ˆ
3. **æ•°æ®å®‰å…¨** - å¯ä»¥åœ¨å‡ºé”™æ—¶å›æ»šæ“ä½œï¼Œé¿å…æ•°æ®ä¸ä¸€è‡´
4. **æ˜“äºè°ƒè¯•** - å¯ä»¥è®°å½•è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯åˆ°æ—¥å¿—æ–‡ä»¶
5. **ä»£ç å¥å£®** - è€ƒè™‘äº†å„ç§è¾¹ç•Œæƒ…å†µï¼Œæ›´å¯é 

**å¼‚å¸¸ï¼ˆExceptionï¼‰** æ˜¯ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚å¦‚æœä¸å¤„ç†ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚

```python
# ä¸å¤„ç†å¼‚å¸¸ - ç¨‹åºå´©æºƒ
result = 10 / 0  # ZeroDivisionError: division by zero
print("è¿™è¡Œä¸ä¼šæ‰§è¡Œ")

# å¤„ç†å¼‚å¸¸ - ç¨‹åºç»§ç»­è¿è¡Œ
try:
    result = 10 / 0
except ZeroDivisionError:
    print("ä¸èƒ½é™¤ä»¥é›¶")
    result = 0
print("ç¨‹åºç»§ç»­è¿è¡Œ")  # è¿™è¡Œä¼šæ‰§è¡Œ
```

### ä¸ºä»€ä¹ˆéœ€è¦å¼‚å¸¸å¤„ç†ï¼Ÿ

```python
# æ²¡æœ‰å¼‚å¸¸å¤„ç†çš„ç¨‹åº
def divide(a, b):
    return a / b

result = divide(10, 0)  # å´©æºƒï¼
print("åç»­ä»£ç ä¸æ‰§è¡Œ")

# æœ‰å¼‚å¸¸å¤„ç†çš„ç¨‹åº
def safe_divide(a, b):
    try:
        return a / b
    except ZeroDivisionError:
        print("é™¤æ•°ä¸èƒ½ä¸º0")
        return None

result = safe_divide(10, 0)
print("ç¨‹åºæ­£å¸¸ç»§ç»­")  # ç»§ç»­è¿è¡Œ
```

## å¸¸è§çš„å¼‚å¸¸ç±»å‹

Pythonä¸­æœ‰å¾ˆå¤šå†…ç½®çš„å¼‚å¸¸ç±»å‹ï¼Œæ¯ç§å¼‚å¸¸éƒ½å¯¹åº”ä¸€ç§ç‰¹å®šçš„é”™è¯¯æƒ…å†µã€‚å°±åƒåŒ»é™¢é‡Œçš„ç§‘å®¤ä¸€æ ·ï¼Œä¸åŒçš„ç—…è¦å»ä¸åŒçš„ç§‘å®¤çœ‹ï¼š
- è‚šå­ç–¼å»æ¶ˆåŒ–ç§‘
- å¤´ç–¼å»ç¥ç»ç§‘
- ç‰™ç–¼å»å£è…”ç§‘

Pythonçš„å¼‚å¸¸ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¸åŒçš„é”™è¯¯æœ‰ä¸åŒçš„å¼‚å¸¸ç±»å‹ã€‚è®©æˆ‘ä»¬æ¥è®¤è¯†è¿™äº›"å¸¸è§ç—…"ï¼

### 1. ZeroDivisionError - é™¤ä»¥é›¶é”™è¯¯

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šå½“ä½ è¯•å›¾ç”¨0ä½œä¸ºé™¤æ•°æ—¶

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼š10ä¸ªè‹¹æœè¦å¹³å‡åˆ†ç»™0ä¸ªäººï¼Œæ€ä¹ˆåˆ†ï¼Ÿè¿™åœ¨æ•°å­¦ä¸Šæ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

```python
# æœ€åŸºæœ¬çš„é™¤ä»¥é›¶é”™è¯¯
try:
    result = 10 / 0
except ZeroDivisionError:
    print("ä¸èƒ½é™¤ä»¥é›¶ï¼")

# å®é™…åœºæ™¯ï¼šè®¡ç®—å¹³å‡åˆ†
def calculate_average(scores):
    """è®¡ç®—å¹³å‡åˆ†"""
    try:
        total = sum(scores)
        count = len(scores)
        average = total / count  # å¦‚æœscoresæ˜¯ç©ºåˆ—è¡¨ï¼Œcount=0å°±ä¼šå‡ºé”™
        return average
    except ZeroDivisionError:
        print("é”™è¯¯ï¼šæ²¡æœ‰ä»»ä½•åˆ†æ•°ï¼Œæ— æ³•è®¡ç®—å¹³å‡å€¼")
        return None

# æµ‹è¯•
print(calculate_average([80, 90, 100]))  # 90.0
print(calculate_average([]))  # é”™è¯¯ï¼šæ²¡æœ‰ä»»ä½•åˆ†æ•°ï¼Œæ— æ³•è®¡ç®—å¹³å‡å€¼

# å®é™…åœºæ™¯ï¼šè®¡ç®—æ¯”ç‡
def calculate_ratio(part, total):
    """è®¡ç®—ç™¾åˆ†æ¯”"""
    try:
        ratio = (part / total) * 100
        return f"{ratio:.2f}%"
    except ZeroDivisionError:
        return "æ€»æ•°ä¸èƒ½ä¸º0"

print(calculate_ratio(5, 10))  # 50.00%
print(calculate_ratio(5, 0))   # æ€»æ•°ä¸èƒ½ä¸º0
```

### 2. ValueError - å€¼é”™è¯¯

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šå‡½æ•°æ¥æ”¶åˆ°çš„å‚æ•°ç±»å‹æ­£ç¡®ï¼Œä½†å€¼ä¸åˆé€‚

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ å»é“¶è¡Œå­˜é’±ï¼ŒæŸœå‘˜é—®ä½ å­˜å¤šå°‘ï¼Œä½ è¯´"ä¸€äº›"ã€‚ç±»å‹å¯¹äº†ï¼ˆéƒ½æ˜¯åœ¨è¯´æ•°é‡ï¼‰ï¼Œä½†è¿™ä¸ªå€¼ä¸å…·ä½“ï¼Œæ— æ³•å¤„ç†ã€‚

```python
# ç±»å‹è½¬æ¢å¤±è´¥ - æœ€å¸¸è§çš„ValueError
try:
    age = int("äºŒåå²")  # å­—ç¬¦ä¸²æ— æ³•è½¬æ¢ä¸ºæ•´æ•°
except ValueError:
    print("æ— æ³•å°†'äºŒåå²'è½¬æ¢ä¸ºæ•°å­—")

try:
    price = float("Â¥99.99")  # åŒ…å«è´§å¸ç¬¦å·ï¼Œæ— æ³•è½¬æ¢
except ValueError:
    print("ä»·æ ¼æ ¼å¼é”™è¯¯")

# å®é™…åœºæ™¯ï¼šå®‰å…¨çš„ç”¨æˆ·è¾“å…¥
def get_positive_integer(prompt):
    """è·å–æ­£æ•´æ•°è¾“å…¥ï¼Œå¸¦å®Œæ•´çš„é”™è¯¯å¤„ç†"""
    while True:
        user_input = input(prompt)

        # æ£€æŸ¥æ˜¯å¦ä¸ºç©º
        if not user_input.strip():
            print("è¾“å…¥ä¸èƒ½ä¸ºç©ºï¼Œè¯·é‡æ–°è¾“å…¥")
            continue

        try:
            number = int(user_input)

            # å€¼çš„èŒƒå›´æ£€æŸ¥
            if number <= 0:
                print("å¿…é¡»è¾“å…¥æ­£æ•´æ•°ï¼ˆå¤§äº0ï¼‰")
                continue

            return number

        except ValueError:
            print(f"'{user_input}' ä¸æ˜¯æœ‰æ•ˆçš„æ•´æ•°ï¼Œè¯·è¾“å…¥æ•°å­—")

# ä½¿ç”¨
# age = get_positive_integer("è¯·è¾“å…¥å¹´é¾„: ")

# å…¶ä»–ValueErroråœºæ™¯
try:
    # åˆ—è¡¨ä¸­æŸ¥æ‰¾ä¸å­˜åœ¨çš„å€¼
    numbers = [1, 2, 3, 4, 5]
    index = numbers.index(10)  # 10ä¸åœ¨åˆ—è¡¨ä¸­
except ValueError:
    print("å€¼ä¸åœ¨åˆ—è¡¨ä¸­")

try:
    # è§£åŒ…æ—¶æ•°é‡ä¸åŒ¹é…
    a, b = [1, 2, 3]  # å·¦è¾¹2ä¸ªå˜é‡ï¼Œå³è¾¹3ä¸ªå€¼
except ValueError as e:
    print(f"è§£åŒ…é”™è¯¯ï¼š{e}")  # too many values to unpack
```

### 3. TypeError - ç±»å‹é”™è¯¯

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šå¯¹ä¸å…¼å®¹çš„ç±»å‹è¿›è¡Œæ“ä½œ

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ æƒ³ç”¨æ‰³æ‰‹æ‹§èºä¸ï¼ˆå¯ä»¥ï¼‰ï¼Œä½†ç”¨èºä¸åˆ€åˆ‡èœï¼ˆç±»å‹ä¸å¯¹ï¼‰ã€‚

```python
# ä¸åŒç±»å‹ä¹‹é—´çš„è¿ç®—
try:
    result = "hello" + 5  # å­—ç¬¦ä¸²ä¸èƒ½å’Œæ•°å­—ç›¸åŠ 
except TypeError:
    print("ä¸èƒ½æŠŠå­—ç¬¦ä¸²å’Œæ•°å­—ç›¸åŠ ")

# æ­£ç¡®åšæ³•ï¼šå…ˆè½¬æ¢ç±»å‹
result = "hello" + str(5)  # "hello5"
print(result)

# å‡½æ•°å‚æ•°ç±»å‹é”™è¯¯
try:
    number = len(123)  # len()æœŸæœ›çš„æ˜¯åºåˆ—ï¼Œä¸æ˜¯æ•°å­—
except TypeError:
    print("len()ä¸èƒ½ç”¨äºæ•°å­—")

# å®é™…åœºæ™¯ï¼šæ•°æ®å¤„ç†
def calculate_total(prices):
    """è®¡ç®—æ€»ä»·ï¼Œå¸¦ç±»å‹æ£€æŸ¥"""
    try:
        total = sum(prices)
        return total
    except TypeError:
        print("é”™è¯¯ï¼špriceså¿…é¡»æ˜¯æ•°å­—åˆ—è¡¨")
        return None

print(calculate_total([10, 20, 30]))  # 60
print(calculate_total([10, "20", 30]))  # é”™è¯¯ï¼šåŒ…å«éæ•°å­—å…ƒç´ 

# è°ƒç”¨ä¸å¯è°ƒç”¨çš„å¯¹è±¡
try:
    x = 10
    result = x()  # 10ä¸æ˜¯å‡½æ•°ï¼Œä¸èƒ½è°ƒç”¨
except TypeError:
    print("è¿™ä¸ªå¯¹è±¡ä¸æ˜¯å‡½æ•°ï¼Œä¸èƒ½è°ƒç”¨")

# å­—ç¬¦ä¸²æ ¼å¼åŒ–ç±»å‹é”™è¯¯
try:
    result = "%d" % "hello"  # %dæœŸæœ›æ•°å­—ï¼Œä¸æ˜¯å­—ç¬¦ä¸²
except TypeError:
    print("æ ¼å¼åŒ–ç±»å‹ä¸åŒ¹é…")
```

### 4. FileNotFoundError - æ–‡ä»¶ä¸å­˜åœ¨

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šè¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ æƒ³æ‰“å¼€å®¶é—¨ï¼Œä½†æ‰¾ä¸åˆ°é’¥åŒ™ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼‰ã€‚

```python
# åŸºæœ¬çš„æ–‡ä»¶ä¸å­˜åœ¨é”™è¯¯
try:
    with open("nonexistent.txt", "r") as f:
        content = f.read()
except FileNotFoundError:
    print("æ–‡ä»¶ä¸å­˜åœ¨")

# å®é™…åœºæ™¯ï¼šè¯»å–é…ç½®æ–‡ä»¶
def load_config(filename):
    """åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä¸å­˜åœ¨æ—¶ä½¿ç”¨é»˜è®¤é…ç½®"""
    try:
        with open(filename, "r", encoding="utf-8") as f:
            config = f.read()
        print(f"âœ… é…ç½®æ–‡ä»¶ {filename} åŠ è½½æˆåŠŸ")
        return config
    except FileNotFoundError:
        print(f"âš ï¸  é…ç½®æ–‡ä»¶ {filename} ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤é…ç½®")
        default_config = "host=localhost\nport=8080"
        # å¯ä»¥é€‰æ‹©åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
        with open(filename, "w", encoding="utf-8") as f:
            f.write(default_config)
        return default_config

config = load_config("app_config.txt")

# å®é™…åœºæ™¯ï¼šè¯»å–ç”¨æˆ·æ•°æ®
def read_user_data(username):
    """è¯»å–ç”¨æˆ·æ•°æ®æ–‡ä»¶"""
    filename = f"users/{username}.txt"
    try:
        with open(filename, "r", encoding="utf-8") as f:
            data = f.read()
        return data
    except FileNotFoundError:
        return f"ç”¨æˆ· {username} ä¸å­˜åœ¨"

print(read_user_data("zhangsan"))
```

### 5. KeyError - å­—å…¸é”®ä¸å­˜åœ¨

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šè®¿é—®å­—å…¸ä¸­ä¸å­˜åœ¨çš„é”®

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ æƒ³ä»æŠ½å±‰é‡Œæ‹¿"æŠ¤ç…§"ï¼Œä½†æŠ½å±‰é‡Œæ ¹æœ¬æ²¡æœ‰æŠ¤ç…§ã€‚

```python
# åŸºæœ¬çš„KeyError
try:
    data = {"name": "å¼ ä¸‰", "age": 20}
    city = data["city"]  # 'city'è¿™ä¸ªé”®ä¸å­˜åœ¨
except KeyError:
    print("é”® 'city' ä¸å­˜åœ¨")

# æ­£ç¡®åšæ³•ï¼šä½¿ç”¨get()æ–¹æ³•
city = data.get("city", "æœªçŸ¥")  # å¦‚æœé”®ä¸å­˜åœ¨ï¼Œè¿”å›é»˜è®¤å€¼"æœªçŸ¥"
print(f"åŸå¸‚ï¼š{city}")

# å®é™…åœºæ™¯ï¼šå¤„ç†APIå“åº”
def get_user_email(user_data):
    """ä»ç”¨æˆ·æ•°æ®ä¸­æå–é‚®ç®±"""
    try:
        email = user_data["contact"]["email"]
        return email
    except KeyError as e:
        print(f"æ•°æ®ä¸å®Œæ•´ï¼Œç¼ºå°‘é”®ï¼š{e}")
        return None

# æµ‹è¯•æ•°æ®
user1 = {"name": "å¼ ä¸‰", "contact": {"email": "zhangsan@example.com"}}
user2 = {"name": "æå››"}  # ç¼ºå°‘contact

print(get_user_email(user1))  # zhangsan@example.com
print(get_user_email(user2))  # æ•°æ®ä¸å®Œæ•´ï¼Œç¼ºå°‘é”®ï¼š'contact'

# å®é™…åœºæ™¯ï¼šé…ç½®ç®¡ç†
class Config:
    """é…ç½®ç®¡ç†ç±»"""
    def __init__(self):
        self.settings = {
            "app_name": "æˆ‘çš„åº”ç”¨",
            "version": "1.0.0"
        }

    def get(self, key, default=None):
        """å®‰å…¨åœ°è·å–é…ç½®"""
        try:
            return self.settings[key]
        except KeyError:
            if default is not None:
                return default
            else:
                raise KeyError(f"é…ç½®é¡¹ '{key}' ä¸å­˜åœ¨ä¸”æ²¡æœ‰æä¾›é»˜è®¤å€¼")

config = Config()
print(config.get("app_name"))  # æˆ‘çš„åº”ç”¨
print(config.get("database", "sqlite"))  # sqliteï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
```

### 6. IndexError - ç´¢å¼•è¶…å‡ºèŒƒå›´

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šè®¿é—®åˆ—è¡¨æˆ–å…ƒç»„æ—¶ï¼Œç´¢å¼•è¶…å‡ºäº†æœ‰æ•ˆèŒƒå›´

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä¸€æ ‹æ¥¼åªæœ‰10å±‚ï¼Œä½ å´æŒ‰ç”µæ¢¯å»20æ¥¼ã€‚

```python
# åŸºæœ¬çš„IndexError
try:
    numbers = [1, 2, 3, 4, 5]
    value = numbers[10]  # ç´¢å¼•10è¶…å‡ºèŒƒå›´ï¼ˆæœ€å¤§ç´¢å¼•æ˜¯4ï¼‰
except IndexError:
    print("ç´¢å¼•è¶…å‡ºåˆ—è¡¨èŒƒå›´")

# å®é™…åœºæ™¯ï¼šå®‰å…¨åœ°è·å–åˆ—è¡¨å…ƒç´ 
def safe_get(lst, index, default=None):
    """å®‰å…¨åœ°è·å–åˆ—è¡¨å…ƒç´ """
    try:
        return lst[index]
    except IndexError:
        print(f"ç´¢å¼• {index} è¶…å‡ºèŒƒå›´ï¼ˆåˆ—è¡¨é•¿åº¦ï¼š{len(lst)}ï¼‰")
        return default

numbers = [10, 20, 30]
print(safe_get(numbers, 1))   # 20
print(safe_get(numbers, 10))  # ç´¢å¼•10è¶…å‡ºèŒƒå›´ï¼Œè¿”å›None

# å®é™…åœºæ™¯ï¼šå¤„ç†å‘½ä»¤è¡Œå‚æ•°
import sys

def get_command_arg(index, default=None):
    """è·å–å‘½ä»¤è¡Œå‚æ•°"""
    try:
        return sys.argv[index]
    except IndexError:
        return default

# ä½¿ç”¨
# filename = get_command_arg(1, "default.txt")

# å®é™…åœºæ™¯ï¼šåˆ†å‰²å­—ç¬¦ä¸²åè®¿é—®
def parse_user_input(text):
    """è§£æç”¨æˆ·è¾“å…¥ï¼šname,age,city"""
    try:
        parts = text.split(",")
        name = parts[0].strip()
        age = int(parts[1].strip())
        city = parts[2].strip()
        return {"name": name, "age": age, "city": city}
    except IndexError:
        print("è¾“å…¥æ ¼å¼é”™è¯¯ï¼Œåº”è¯¥æ˜¯ï¼šå§“å,å¹´é¾„,åŸå¸‚")
        return None
    except ValueError:
        print("å¹´é¾„å¿…é¡»æ˜¯æ•°å­—")
        return None

print(parse_user_input("å¼ ä¸‰,20,åŒ—äº¬"))  # {'name': 'å¼ ä¸‰', 'age': 20, 'city': 'åŒ—äº¬'}
print(parse_user_input("å¼ ä¸‰,20"))  # è¾“å…¥æ ¼å¼é”™è¯¯
```

### 7. AttributeError - å±æ€§ä¸å­˜åœ¨

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šè®¿é—®å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§æˆ–æ–¹æ³•

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ æƒ³è°ƒèŠ‚ç”µé£æ‰‡çš„"åˆ¶å†·æ¨¡å¼"ï¼Œä½†ç”µé£æ‰‡åªèƒ½å¹é£ï¼Œæ²¡æœ‰åˆ¶å†·åŠŸèƒ½ã€‚

```python
# åŸºæœ¬çš„AttributeError
try:
    result = "hello".nonexistent_method()  # å­—ç¬¦ä¸²æ²¡æœ‰è¿™ä¸ªæ–¹æ³•
except AttributeError:
    print("å­—ç¬¦ä¸²å¯¹è±¡æ²¡æœ‰è¿™ä¸ªæ–¹æ³•")

# è®¿é—®ä¸å­˜åœ¨çš„å±æ€§
try:
    text = "hello"
    length = text.length  # æ­£ç¡®çš„æ˜¯len(text)ï¼Œä¸æ˜¯text.length
except AttributeError:
    print("å­—ç¬¦ä¸²æ²¡æœ‰lengthå±æ€§")

# å®é™…åœºæ™¯ï¼šåŠ¨æ€è®¿é—®å±æ€§
class Person:
    def __init__(self, name, age):
        self.name = name
        self.age = age

person = Person("å¼ ä¸‰", 20)

def get_attribute(obj, attr_name, default=None):
    """å®‰å…¨åœ°è·å–å¯¹è±¡å±æ€§"""
    try:
        return getattr(obj, attr_name)
    except AttributeError:
        print(f"å¯¹è±¡æ²¡æœ‰å±æ€§ '{attr_name}'")
        return default

print(get_attribute(person, "name"))   # å¼ ä¸‰
print(get_attribute(person, "email"))  # å¯¹è±¡æ²¡æœ‰å±æ€§ 'email'ï¼Œè¿”å›None

# å®é™…åœºæ™¯ï¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦æœ‰æŸä¸ªæ–¹æ³•
def call_if_exists(obj, method_name, *args):
    """å¦‚æœæ–¹æ³•å­˜åœ¨å°±è°ƒç”¨å®ƒ"""
    try:
        method = getattr(obj, method_name)
        if callable(method):
            return method(*args)
    except AttributeError:
        print(f"å¯¹è±¡æ²¡æœ‰æ–¹æ³• '{method_name}'")
        return None

# æµ‹è¯•
text = "hello"
print(call_if_exists(text, "upper"))  # HELLO
print(call_if_exists(text, "foo"))    # å¯¹è±¡æ²¡æœ‰æ–¹æ³• 'foo'
```

### 8. ImportError / ModuleNotFoundError - å¯¼å…¥å¤±è´¥

**ä»€ä¹ˆæ—¶å€™å‘ç”Ÿ**ï¼šå¯¼å…¥çš„æ¨¡å—ä¸å­˜åœ¨

**ç”Ÿæ´»ä¸­çš„ä¾‹å­**ï¼šä½ æƒ³å€Ÿç”¨å·¥å…·ç®±é‡Œçš„ç”µé’»ï¼Œä½†å·¥å…·ç®±é‡Œæ ¹æœ¬æ²¡æœ‰ç”µé’»ã€‚

```python
# åŸºæœ¬çš„ImportError
try:
    import nonexistent_module  # è¿™ä¸ªæ¨¡å—ä¸å­˜åœ¨
except ImportError:
    print("æ¨¡å—ä¸å­˜åœ¨")

# ModuleNotFoundError (Python 3.6+ï¼Œæ›´å…·ä½“çš„é”™è¯¯)
try:
    import some_random_package
except ModuleNotFoundError:
    print("æ‰¾ä¸åˆ°è¿™ä¸ªåŒ…ï¼Œå¯èƒ½éœ€è¦å…ˆå®‰è£…ï¼špip install some_random_package")

# å®é™…åœºæ™¯ï¼šå¯é€‰ä¾èµ–
def use_advanced_features():
    """å°è¯•ä½¿ç”¨é«˜çº§åŠŸèƒ½ï¼ˆéœ€è¦é¢å¤–çš„åŒ…ï¼‰"""
    try:
        import numpy as np
        print("âœ… ä½¿ç”¨NumPyè¿›è¡Œé«˜çº§è®¡ç®—")
        return np.array([1, 2, 3])
    except ImportError:
        print("âš ï¸  NumPyæœªå®‰è£…ï¼Œä½¿ç”¨åŸºæœ¬åŠŸèƒ½")
        return [1, 2, 3]

result = use_advanced_features()

# å®é™…åœºæ™¯ï¼šè·¨å¹³å°å…¼å®¹
def get_system_info():
    """è·å–ç³»ç»Ÿä¿¡æ¯ï¼ˆè·¨å¹³å°ï¼‰"""
    try:
        import psutil  # ç¬¬ä¸‰æ–¹åº“
        cpu_percent = psutil.cpu_percent()
        memory_info = psutil.virtual_memory()
        return f"CPU: {cpu_percent}%, å†…å­˜: {memory_info.percent}%"
    except ImportError:
        # å¦‚æœæ²¡æœ‰å®‰è£…psutilï¼Œä½¿ç”¨osæ¨¡å—çš„åŸºæœ¬åŠŸèƒ½
        import os
        return f"æ“ä½œç³»ç»Ÿ: {os.name}"

print(get_system_info())
```

### å¼‚å¸¸ç±»å‹æ€»ç»“

| å¼‚å¸¸ç±»å‹ | è§¦å‘æ¡ä»¶ | å¸¸è§åœºæ™¯ | é¢„é˜²æ–¹æ³• |
|---------|---------|---------|---------|
| `ZeroDivisionError` | é™¤æ•°ä¸º0 | è®¡ç®—å¹³å‡å€¼ã€æ¯”ç‡ | æ£€æŸ¥é™¤æ•°æ˜¯å¦ä¸º0 |
| `ValueError` | å€¼ä¸åˆé€‚ | ç±»å‹è½¬æ¢ã€æ•°æ®éªŒè¯ | éªŒè¯è¾“å…¥çš„æ ¼å¼å’ŒèŒƒå›´ |
| `TypeError` | ç±»å‹ä¸åŒ¹é… | ä¸åŒç±»å‹è¿ç®— | æ£€æŸ¥æ•°æ®ç±»å‹ |
| `FileNotFoundError` | æ–‡ä»¶ä¸å­˜åœ¨ | è¯»å–æ–‡ä»¶ | æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ |
| `KeyError` | å­—å…¸é”®ä¸å­˜åœ¨ | è®¿é—®å­—å…¸ | ä½¿ç”¨get()æˆ–inæ£€æŸ¥ |
| `IndexError` | ç´¢å¼•è¶…å‡ºèŒƒå›´ | è®¿é—®åˆ—è¡¨/å…ƒç»„ | æ£€æŸ¥ç´¢å¼•æ˜¯å¦åœ¨æœ‰æ•ˆèŒƒå›´ |
| `AttributeError` | å±æ€§ä¸å­˜åœ¨ | è®¿é—®å¯¹è±¡å±æ€§ | ä½¿ç”¨hasattr()æ£€æŸ¥ |
| `ImportError` | å¯¼å…¥å¤±è´¥ | å¯¼å…¥æ¨¡å— | ç¡®ä¿æ¨¡å—å·²å®‰è£… |

**é€‰æ‹©æ­£ç¡®çš„å¼‚å¸¸ç±»å‹**å°±åƒçœ‹ç—…è¦å»å¯¹çš„ç§‘å®¤ä¸€æ ·é‡è¦ï¼å¦‚æœä½ æ•è·äº†é”™è¯¯çš„å¼‚å¸¸ç±»å‹ï¼Œå°±åƒå»ç‰™ç§‘çœ‹èƒƒç—…ï¼Œé—®é¢˜è¿˜æ˜¯è§£å†³ä¸äº†ã€‚

## try-exceptåŸºç¡€

### åŸºæœ¬è¯­æ³•

try-exceptæ˜¯Pythonä¸­å¤„ç†å¼‚å¸¸çš„åŸºæœ¬ç»“æ„ï¼Œå°±åƒç»™ä»£ç ç©¿ä¸Š"é˜²æŠ¤æœ"ï¼š

```python
try:
    # è¿™é‡Œæ”¾å¯èƒ½å‡ºé”™çš„ä»£ç ï¼ˆå±é™©åŒºåŸŸï¼‰
    risky_code()
except ExceptionType:
    # å¦‚æœå‡ºé”™äº†ï¼Œæ‰§è¡Œè¿™é‡Œçš„ä»£ç ï¼ˆåº”æ€¥æªæ–½ï¼‰
    handle_error()
```

**å·¥ä½œåŸç†**ï¼ˆå°±åƒä¿é™©ä¸€æ ·ï¼‰ï¼š

1. **æ­£å¸¸æƒ…å†µ**ï¼štryå—ä¸­çš„ä»£ç é¡ºåˆ©æ‰§è¡Œï¼Œexceptå—è¢«å¿½ç•¥
   ```python
   try:
       result = 10 / 2  # æ²¡é—®é¢˜ï¼Œæ­£å¸¸æ‰§è¡Œ
       print(result)    # 5.0
   except ZeroDivisionError:
       print("é™¤ä»¥é›¶")   # è¿™è¡Œä¸ä¼šæ‰§è¡Œ
   ```

2. **å¼‚å¸¸æƒ…å†µ**ï¼štryå—ä¸­å‡ºé”™ï¼Œç«‹å³è·³è½¬åˆ°å¯¹åº”çš„exceptå—
   ```python
   try:
       result = 10 / 0  # å‡ºé”™ï¼
       print("è¿™è¡Œä¸æ‰§è¡Œ")  # è·³è¿‡è¿™é‡Œ
   except ZeroDivisionError:
       print("é™¤ä»¥é›¶")  # æ‰§è¡Œè¿™é‡Œ
   ```

### ä¸ºä»€ä¹ˆéœ€è¦try-exceptï¼Ÿ

è®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ï¼š

```python
# âŒ æ²¡æœ‰å¼‚å¸¸å¤„ç† - ç¨‹åºä¼šå´©æºƒ
def withdraw_money(balance, amount):
    """ä»è´¦æˆ·å–é’±"""
    balance = balance - amount  # å¦‚æœamount > balanceä¼šæ€æ ·ï¼Ÿ
    return balance

balance = 1000
balance = withdraw_money(balance, 1500)  # ä½™é¢å˜æˆ-500ï¼Ÿè¿™ä¸åˆç†ï¼
print(f"å‰©ä½™ï¼š{balance}")  # -500

# âœ… æœ‰å¼‚å¸¸å¤„ç† - ç¨‹åºå®‰å…¨å¯æ§
def safe_withdraw(balance, amount):
    """å®‰å…¨åœ°å–é’±"""
    try:
        if amount > balance:
            raise ValueError("ä½™é¢ä¸è¶³")  # ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸
        balance = balance - amount
        return balance
    except ValueError as e:
        print(f"å–æ¬¾å¤±è´¥ï¼š{e}")
        return balance  # ä½™é¢ä¸å˜

balance = 1000
balance = safe_withdraw(balance, 1500)  # å–æ¬¾å¤±è´¥ï¼šä½™é¢ä¸è¶³
print(f"å‰©ä½™ï¼š{balance}")  # 1000ï¼ˆä½™é¢æ²¡å˜ï¼‰
```

### ä¾‹å­1ï¼šå®‰å…¨çš„é™¤æ³•

è®©æˆ‘ä»¬ä¸€æ­¥æ­¥å®Œå–„ä¸€ä¸ªé™¤æ³•å‡½æ•°ï¼š

```python
# ç‰ˆæœ¬1ï¼šæœ€ç®€å•çš„å¼‚å¸¸å¤„ç†
def divide_v1(a, b):
    """ç®€å•çš„é™¤æ³•"""
    try:
        result = a / b
        return result
    except ZeroDivisionError:
        print("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸º0")
        return None

print(divide_v1(10, 2))  # 5.0
print(divide_v1(10, 0))  # é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸º0ï¼Œè¿”å›None

# ç‰ˆæœ¬2ï¼šæ·»åŠ ç±»å‹æ£€æŸ¥
def divide_v2(a, b):
    """å¸¦ç±»å‹æ£€æŸ¥çš„é™¤æ³•"""
    try:
        # æ£€æŸ¥å‚æ•°ç±»å‹
        if not isinstance(a, (int, float)) or not isinstance(b, (int, float)):
            raise TypeError("å‚æ•°å¿…é¡»æ˜¯æ•°å­—")

        result = a / b
        return result

    except ZeroDivisionError:
        print("é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸º0")
        return None
    except TypeError as e:
        print(f"ç±»å‹é”™è¯¯ï¼š{e}")
        return None

print(divide_v2(10, 2))        # 5.0
print(divide_v2(10, "2"))      # ç±»å‹é”™è¯¯ï¼šå‚æ•°å¿…é¡»æ˜¯æ•°å­—
print(divide_v2(10, 0))        # é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸º0

# ç‰ˆæœ¬3ï¼šå®Œå–„çš„é™¤æ³•å‡½æ•°
def divide_v3(a, b, precision=2):
    """
    å®Œå–„çš„é™¤æ³•å‡½æ•°

    å‚æ•°:
        a: è¢«é™¤æ•°
        b: é™¤æ•°
        precision: ç»“æœä¿ç•™çš„å°æ•°ä½æ•°

    è¿”å›:
        è®¡ç®—ç»“æœï¼Œå‡ºé”™è¿”å›None
    """
    try:
        # ç±»å‹æ£€æŸ¥
        if not isinstance(a, (int, float)):
            raise TypeError(f"è¢«é™¤æ•°å¿…é¡»æ˜¯æ•°å­—ï¼Œè€Œä¸æ˜¯{type(a).__name__}")
        if not isinstance(b, (int, float)):
            raise TypeError(f"é™¤æ•°å¿…é¡»æ˜¯æ•°å­—ï¼Œè€Œä¸æ˜¯{type(b).__name__}")

        # é™¤ä»¥é›¶æ£€æŸ¥
        if b == 0:
            raise ZeroDivisionError("æ•°å­¦é”™è¯¯ï¼šä¸èƒ½é™¤ä»¥é›¶")

        # æ‰§è¡Œè®¡ç®—
        result = a / b

        # æ ¼å¼åŒ–ç»“æœ
        return round(result, precision)

    except TypeError as e:
        print(f"âŒ ç±»å‹é”™è¯¯ï¼š{e}")
        return None
    except ZeroDivisionError as e:
        print(f"âŒ {e}")
        return None
    except Exception as e:
        # æ•è·å…¶ä»–æœªé¢„æœŸçš„é”™è¯¯
        print(f"âŒ æœªçŸ¥é”™è¯¯ï¼š{e}")
        return None

# æµ‹è¯•
print(divide_v3(10, 3))         # 3.33
print(divide_v3(10, 3, 4))      # 3.3333
print(divide_v3(10, 0))         # âŒ æ•°å­¦é”™è¯¯ï¼šä¸èƒ½é™¤ä»¥é›¶
print(divide_v3("10", 2))       # âŒ ç±»å‹é”™è¯¯ï¼šè¢«é™¤æ•°å¿…é¡»æ˜¯æ•°å­—
```

**ä»ç‰ˆæœ¬1åˆ°ç‰ˆæœ¬3ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†ä»€ä¹ˆ**ï¼Ÿ
- ç‰ˆæœ¬1ï¼šåªå¤„ç†æœ€åŸºæœ¬çš„é”™è¯¯
- ç‰ˆæœ¬2ï¼šå¢åŠ äº†æ›´å¤šçš„é”™è¯¯æ£€æŸ¥
- ç‰ˆæœ¬3ï¼š**å®Œæ•´ã€ä¸“ä¸šã€ç”¨æˆ·å‹å¥½** - è¿™å°±æ˜¯ç”Ÿäº§ç¯å¢ƒä»£ç çš„æ ‡å‡†ï¼

### ä¾‹å­2ï¼šå®‰å…¨çš„ç±»å‹è½¬æ¢

ç±»å‹è½¬æ¢æ˜¯æœ€å¸¸è§çš„å‡ºé”™ç‚¹ï¼Œè®©æˆ‘ä»¬å­¦ä¼šå®‰å…¨åœ°å¤„ç†ï¼š

```python
# é—®é¢˜ï¼šç”¨æˆ·è¾“å…¥çš„æ•°æ®åƒå¥‡ç™¾æ€ª
# - "123" âœ… å¯ä»¥è½¬æ¢
# - "abc" âŒ ä¸èƒ½è½¬æ¢
# - "12.5" âŒ int()ä¸èƒ½å¤„ç†å°æ•°å­—ç¬¦ä¸²
# - "  123  " â“ æœ‰ç©ºæ ¼æ€ä¹ˆåŠï¼Ÿ
# - "" âŒ ç©ºå­—ç¬¦ä¸²

# ç‰ˆæœ¬1ï¼šåŸºç¡€è½¬æ¢
def safe_int_v1(value):
    """å®‰å…¨åœ°è½¬æ¢ä¸ºæ•´æ•°"""
    try:
        return int(value)
    except ValueError:
        print(f"æ— æ³•å°† '{value}' è½¬æ¢ä¸ºæ•´æ•°")
        return None

print(safe_int_v1("123"))    # 123
print(safe_int_v1("abc"))    # æ— æ³•å°† 'abc' è½¬æ¢ä¸ºæ•´æ•°
print(safe_int_v1("12.5"))   # æ— æ³•å°† '12.5' è½¬æ¢ä¸ºæ•´æ•°

# ç‰ˆæœ¬2ï¼šæ™ºèƒ½è½¬æ¢ï¼ˆå¤„ç†æµ®ç‚¹æ•°ï¼‰
def safe_int_v2(value):
    """æ™ºèƒ½åœ°è½¬æ¢ä¸ºæ•´æ•°"""
    try:
        # å…ˆè½¬ä¸ºå­—ç¬¦ä¸²å¹¶å»ç©ºæ ¼
        value = str(value).strip()

        # å¦‚æœåŒ…å«å°æ•°ç‚¹ï¼Œå…ˆè½¬ä¸ºfloatå†è½¬ä¸ºint
        if '.' in value:
            return int(float(value))
        else:
            return int(value)

    except ValueError:
        print(f"âŒ æ— æ³•è½¬æ¢ï¼š'{value}' ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—")
        return None
    except Exception as e:
        print(f"âŒ è½¬æ¢é”™è¯¯ï¼š{e}")
        return None

print(safe_int_v2("123"))      # 123
print(safe_int_v2("  123  "))  # 123ï¼ˆå¤„ç†äº†ç©ºæ ¼ï¼‰
print(safe_int_v2("12.5"))     # 12ï¼ˆå¤„ç†äº†å°æ•°ï¼‰
print(safe_int_v2("abc"))      # âŒ æ— æ³•è½¬æ¢

# ç‰ˆæœ¬3ï¼šç”Ÿäº§çº§è½¬æ¢å‡½æ•°
def parse_number(value, default=None, allow_float=False):
    """
    è§£ææ•°å­—ï¼ˆç”Ÿäº§çº§ï¼‰

    å‚æ•°:
        value: è¦è½¬æ¢çš„å€¼
        default: è½¬æ¢å¤±è´¥æ—¶çš„é»˜è®¤å€¼
        allow_float: æ˜¯å¦å…è®¸æµ®ç‚¹æ•°

    è¿”å›:
        è½¬æ¢åçš„æ•°å­—ï¼Œå¤±è´¥è¿”å›default
    """
    try:
        # å¤„ç†None
        if value is None:
            return default

        # è½¬ä¸ºå­—ç¬¦ä¸²å¹¶æ¸…ç†
        value_str = str(value).strip()

        # å¤„ç†ç©ºå­—ç¬¦ä¸²
        if not value_str:
            print("âš ï¸  è¾“å…¥ä¸ºç©º")
            return default

        # è½¬æ¢
        if allow_float:
            result = float(value_str)
        else:
            # å¦‚æœä¸å…è®¸æµ®ç‚¹æ•°ï¼Œä½†è¾“å…¥æ˜¯å°æ•°å­—ç¬¦ä¸²ï¼Œå››èˆäº”å…¥
            if '.' in value_str:
                result = int(round(float(value_str)))
            else:
                result = int(value_str)

        return result

    except ValueError:
        print(f"âŒ '{value}' ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—æ ¼å¼")
        return default
    except Exception as e:
        print(f"âŒ è½¬æ¢å‡ºé”™ï¼š{type(e).__name__}: {e}")
        return default

# æµ‹è¯•
print(parse_number("123"))                    # 123
print(parse_number("12.7"))                   # 13ï¼ˆå››èˆäº”å…¥ï¼‰
print(parse_number("12.7", allow_float=True)) # 12.7
print(parse_number("abc", default=0))         # âŒ ä¸æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œè¿”å›0
print(parse_number("", default=-1))           # âš ï¸  è¾“å…¥ä¸ºç©ºï¼Œè¿”å›-1
print(parse_number(None, default=100))        # 100

# å®é™…åº”ç”¨ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥çš„ä»·æ ¼
def get_price():
    """è·å–ç”¨æˆ·è¾“å…¥çš„ä»·æ ¼"""
    while True:
        user_input = input("è¯·è¾“å…¥å•†å“ä»·æ ¼ï¼ˆå…ƒï¼‰: ")

        price = parse_number(
            user_input,
            default=None,
            allow_float=True
        )

        if price is None:
            print("è¯·é‡æ–°è¾“å…¥")
            continue

        if price < 0:
            print("ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°")
            continue

        return price

# ä½¿ç”¨
# price = get_price()
# print(f"å•†å“ä»·æ ¼ï¼šÂ¥{price:.2f}")
```

### ä¸ºä»€ä¹ˆè¦åˆ†ç‰ˆæœ¬æ”¹è¿›ï¼Ÿ

è¿™å±•ç¤ºäº†ä¸€ä¸ªé‡è¦çš„ç¼–ç¨‹åŸåˆ™ï¼š**è¿­ä»£æ”¹è¿›**

1. **ç‰ˆæœ¬1**ï¼šå®ç°åŸºæœ¬åŠŸèƒ½ - èƒ½ç”¨
2. **ç‰ˆæœ¬2**ï¼šå¤„ç†æ›´å¤šæƒ…å†µ - å¥½ç”¨
3. **ç‰ˆæœ¬3**ï¼šè€ƒè™‘æ‰€æœ‰è¾¹ç•Œæƒ…å†µ - ä¸“ä¸š

å°±åƒé€ æˆ¿å­ï¼š
- ç‰ˆæœ¬1æ˜¯æ­ä¸ªæ£šå­ - èƒ½é®é£æŒ¡é›¨
- ç‰ˆæœ¬2æ˜¯ç›–ç –æˆ¿ - ç»“å®äº†
- ç‰ˆæœ¬3æ˜¯å»ºå¤§å¦ - å®‰å…¨ã€ç¾è§‚ã€åŠŸèƒ½é½å…¨

**å†™ä»£ç ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»ç®€å•åˆ°å®Œå–„ï¼Œä¸€æ­¥æ­¥æé«˜ï¼**

## æ•è·å¤šä¸ªå¼‚å¸¸

### æ–¹æ³•1ï¼šå¤šä¸ªexceptå—

```python
try:
    value = input("è¾“å…¥æ•°å­—: ")
    number = int(value)
    result = 10 / number
    print(f"ç»“æœï¼š{result}")
except ValueError:
    print("è¾“å…¥çš„ä¸æ˜¯æ•°å­—")
except ZeroDivisionError:
    print("é™¤æ•°ä¸èƒ½ä¸º0")
```

### æ–¹æ³•2ï¼šåŒæ—¶æ•è·å¤šä¸ªå¼‚å¸¸

```python
try:
    # å¯èƒ½å¼•å‘å¤šç§å¼‚å¸¸
    operation()
except (ValueError, TypeError, KeyError):
    print("å‘ç”Ÿäº†å€¼é”™è¯¯ã€ç±»å‹é”™è¯¯æˆ–é”®é”™è¯¯")

# è·å–å¼‚å¸¸ä¿¡æ¯
try:
    operation()
except (ValueError, TypeError) as e:
    print(f"é”™è¯¯ç±»å‹ï¼š{type(e).__name__}")
    print(f"é”™è¯¯ä¿¡æ¯ï¼š{e}")
```

### ä¾‹å­ï¼šç”¨æˆ·è¾“å…¥éªŒè¯

```python
def get_positive_integer():
    """è·å–æ­£æ•´æ•°"""
    while True:
        try:
            value = input("è¯·è¾“å…¥æ­£æ•´æ•°: ")
            number = int(value)

            if number <= 0:
                print("å¿…é¡»æ˜¯æ­£æ•°ï¼Œè¯·é‡è¯•")
                continue

            return number
        except ValueError:
            print("è¾“å…¥æ— æ•ˆï¼Œè¯·è¾“å…¥æ•´æ•°")
        except KeyboardInterrupt:
            print("\nç”¨æˆ·å–æ¶ˆè¾“å…¥")
            return None

# ä½¿ç”¨
number = get_positive_integer()
if number:
    print(f"ä½ è¾“å…¥çš„æ˜¯ï¼š{number}")
```

## try-except-else-finally

å®Œæ•´çš„å¼‚å¸¸å¤„ç†ç»“æ„ï¼š

```python
try:
    # å¯èƒ½å‡ºé”™çš„ä»£ç 
    risky_operation()
except ExceptionType:
    # å¤„ç†å¼‚å¸¸
    handle_error()
else:
    # æ²¡æœ‰å¼‚å¸¸æ—¶æ‰§è¡Œ
    success_handling()
finally:
    # æ— è®ºå¦‚ä½•éƒ½æ‰§è¡Œï¼ˆæ¸…ç†èµ„æºï¼‰
    cleanup()
```

### elseå­å¥

```python
try:
    number = int(input("è¾“å…¥æ•°å­—: "))
except ValueError:
    print("è¾“å…¥æ— æ•ˆ")
else:
    # åªæœ‰å½“æ²¡æœ‰å¼‚å¸¸æ—¶æ‰æ‰§è¡Œ
    print(f"ä½ è¾“å…¥çš„æ•°å­—æ˜¯ï¼š{number}")
    print(f"å®ƒçš„å¹³æ–¹æ˜¯ï¼š{number ** 2}")
```

### finallyå­å¥

```python
# finallyæ€»æ˜¯æ‰§è¡Œï¼Œå¸¸ç”¨äºæ¸…ç†èµ„æº
def read_file(filename):
    """è¯»å–æ–‡ä»¶ï¼Œç¡®ä¿æ–‡ä»¶è¢«å…³é—­"""
    file = None
    try:
        file = open(filename, "r")
        content = file.read()
        return content
    except FileNotFoundError:
        print(f"æ–‡ä»¶ {filename} ä¸å­˜åœ¨")
        return None
    finally:
        # æ— è®ºæ˜¯å¦å‡ºé”™ï¼Œéƒ½å…³é—­æ–‡ä»¶
        if file:
            file.close()
            print("æ–‡ä»¶å·²å…³é—­")
```

### å®Œæ•´ä¾‹å­ï¼šæ•°æ®åº“æ“ä½œ

```python
class Database:
    """æ¨¡æ‹Ÿæ•°æ®åº“è¿æ¥"""

    def __init__(self, name):
        self.name = name
        self.connected = False

    def connect(self):
        print(f"è¿æ¥åˆ°æ•°æ®åº“ï¼š{self.name}")
        self.connected = True

    def query(self, sql):
        if not self.connected:
            raise Exception("æ•°æ®åº“æœªè¿æ¥")
        print(f"æ‰§è¡ŒæŸ¥è¯¢ï¼š{sql}")
        return ["ç»“æœ1", "ç»“æœ2"]

    def close(self):
        print(f"å…³é—­æ•°æ®åº“è¿æ¥ï¼š{self.name}")
        self.connected = False

def query_database(sql):
    """æŸ¥è¯¢æ•°æ®åº“"""
    db = Database("mydb")
    try:
        db.connect()
        results = db.query(sql)
        return results
    except Exception as e:
        print(f"æŸ¥è¯¢å¤±è´¥ï¼š{e}")
        return None
    else:
        print("æŸ¥è¯¢æˆåŠŸ")
    finally:
        # æ— è®ºæˆåŠŸå¤±è´¥ï¼Œéƒ½å…³é—­è¿æ¥
        db.close()

# ä½¿ç”¨
results = query_database("SELECT * FROM users")
```

## æ•è·æ‰€æœ‰å¼‚å¸¸

### ä½¿ç”¨Exception

```python
try:
    # å±é™©æ“ä½œ
    risky_operation()
except Exception as e:
    # æ•è·æ‰€æœ‰å¼‚å¸¸ï¼ˆé™¤äº†SystemExitã€KeyboardInterruptç­‰ï¼‰
    print(f"å‘ç”Ÿé”™è¯¯ï¼š{type(e).__name__}: {e}")
```

### ä½¿ç”¨è£¸exceptï¼ˆä¸æ¨èï¼‰

```python
# âš ï¸ ä¸æ¨è - ä¼šæ•è·æ‰€æœ‰å¼‚å¸¸ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå¼‚å¸¸
try:
    something()
except:
    print("å‘ç”Ÿé”™è¯¯")  # æ— æ³•çŸ¥é“å…·ä½“é”™è¯¯

# âœ… æ¨è - æ•è·Exception
try:
    something()
except Exception as e:
    print(f"å‘ç”Ÿé”™è¯¯ï¼š{e}")
```

## æŠ›å‡ºå¼‚å¸¸

### ä½¿ç”¨raise

```python
def divide(a, b):
    """é™¤æ³•ï¼Œé™¤æ•°ä¸º0æ—¶æŠ›å‡ºå¼‚å¸¸"""
    if b == 0:
        raise ValueError("é™¤æ•°ä¸èƒ½ä¸º0")
    return a / b

try:
    result = divide(10, 0)
except ValueError as e:
    print(f"é”™è¯¯ï¼š{e}")  # é”™è¯¯ï¼šé™¤æ•°ä¸èƒ½ä¸º0
```

### é‡æ–°æŠ›å‡ºå¼‚å¸¸

```python
def process_data(data):
    """å¤„ç†æ•°æ®"""
    try:
        # å¤„ç†é€»è¾‘
        result = risky_operation(data)
        return result
    except ValueError as e:
        # è®°å½•æ—¥å¿—
        print(f"è®°å½•é”™è¯¯ï¼š{e}")
        # é‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œè®©è°ƒç”¨è€…å¤„ç†
        raise

try:
    process_data(invalid_data)
except ValueError:
    print("è°ƒç”¨è€…æ•è·äº†é‡æ–°æŠ›å‡ºçš„å¼‚å¸¸")
```

### æŠ›å‡ºä¸åŒçš„å¼‚å¸¸

```python
def get_user_age(user_id):
    """è·å–ç”¨æˆ·å¹´é¾„"""
    try:
        # ä»æ•°æ®åº“è·å–
        user = database.get(user_id)
        return user["age"]
    except KeyError:
        # å°†KeyErrorè½¬æ¢ä¸ºæ›´æœ‰æ„ä¹‰çš„å¼‚å¸¸
        raise ValueError(f"ç”¨æˆ· {user_id} çš„å¹´é¾„æ•°æ®ç¼ºå¤±")

try:
    age = get_user_age(123)
except ValueError as e:
    print(e)
```

## è‡ªå®šä¹‰å¼‚å¸¸

### åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»

```python
class InsufficientFundsError(Exception):
    """ä½™é¢ä¸è¶³å¼‚å¸¸"""
    pass

class NegativeAmountError(Exception):
    """è´Ÿæ•°é‡‘é¢å¼‚å¸¸"""
    pass

class BankAccount:
    """é“¶è¡Œè´¦æˆ·"""

    def __init__(self, owner, balance=0):
        self.owner = owner
        self.balance = balance

    def deposit(self, amount):
        """å­˜æ¬¾"""
        if amount < 0:
            raise NegativeAmountError("å­˜æ¬¾é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°")
        self.balance += amount

    def withdraw(self, amount):
        """å–æ¬¾"""
        if amount < 0:
            raise NegativeAmountError("å–æ¬¾é‡‘é¢ä¸èƒ½ä¸ºè´Ÿæ•°")
        if amount > self.balance:
            raise InsufficientFundsError(
                f"ä½™é¢ä¸è¶³ï¼Œå½“å‰ä½™é¢ï¼šÂ¥{self.balance}ï¼Œéœ€è¦ï¼šÂ¥{amount}"
            )
        self.balance -= amount

# ä½¿ç”¨
account = BankAccount("å¼ ä¸‰", 1000)

try:
    account.withdraw(1500)
except InsufficientFundsError as e:
    print(f"å–æ¬¾å¤±è´¥ï¼š{e}")

try:
    account.deposit(-100)
except NegativeAmountError as e:
    print(f"å­˜æ¬¾å¤±è´¥ï¼š{e}")
```

### å¸¦æ›´å¤šä¿¡æ¯çš„è‡ªå®šä¹‰å¼‚å¸¸

```python
class ValidationError(Exception):
    """æ•°æ®éªŒè¯å¼‚å¸¸"""

    def __init__(self, field, message):
        self.field = field
        self.message = message
        super().__init__(f"å­—æ®µ '{field}' éªŒè¯å¤±è´¥ï¼š{message}")

class User:
    """ç”¨æˆ·ç±»"""

    def __init__(self, username, age, email):
        self.username = username
        self.age = age
        self.email = email
        self.validate()

    def validate(self):
        """éªŒè¯ç”¨æˆ·æ•°æ®"""
        if len(self.username) < 3:
            raise ValidationError("username", "ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦")

        if self.age < 0 or self.age > 150:
            raise ValidationError("age", "å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´")

        if "@" not in self.email:
            raise ValidationError("email", "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")

# ä½¿ç”¨
try:
    user = User("ab", 25, "test@example.com")
except ValidationError as e:
    print(f"éªŒè¯å¤±è´¥ï¼š{e}")
    print(f"é”™è¯¯å­—æ®µï¼š{e.field}")
    print(f"é”™è¯¯ä¿¡æ¯ï¼š{e.message}")
```

## å®æˆ˜ä¾‹å­

### ä¾‹å­1ï¼šå®‰å…¨çš„æ–‡ä»¶æ“ä½œ

```python
def safe_read_file(filename, default=""):
    """å®‰å…¨åœ°è¯»å–æ–‡ä»¶"""
    try:
        with open(filename, "r", encoding="utf-8") as f:
            return f.read()
    except FileNotFoundError:
        print(f"æ–‡ä»¶ä¸å­˜åœ¨ï¼š{filename}")
        return default
    except PermissionError:
        print(f"æ²¡æœ‰æƒé™è¯»å–ï¼š{filename}")
        return default
    except UnicodeDecodeError:
        print(f"æ–‡ä»¶ç¼–ç é”™è¯¯ï¼š{filename}")
        # å°è¯•å…¶ä»–ç¼–ç 
        try:
            with open(filename, "r", encoding="gbk") as f:
                return f.read()
        except:
            return default
    except Exception as e:
        print(f"æœªçŸ¥é”™è¯¯ï¼š{e}")
        return default

# ä½¿ç”¨
content = safe_read_file("config.txt", default="# é»˜è®¤é…ç½®")
print(content)
```

### ä¾‹å­2ï¼šç½‘ç»œè¯·æ±‚é‡è¯•

```python
import time

def fetch_data(url, max_retries=3, timeout=5):
    """
    è·å–æ•°æ®ï¼Œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•
    """
    import random  # æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚

    for attempt in range(max_retries):
        try:
            print(f"å°è¯•ç¬¬ {attempt + 1} æ¬¡...")

            # æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
            if random.random() < 0.7:  # 70%å¤±è´¥ç‡
                raise ConnectionError("ç½‘ç»œè¿æ¥å¤±è´¥")

            # æˆåŠŸè·å–æ•°æ®
            data = {"status": "success", "data": [1, 2, 3]}
            print("è·å–æˆåŠŸ")
            return data

        except ConnectionError as e:
            print(f"è¿æ¥å¤±è´¥ï¼š{e}")

            if attempt < max_retries - 1:
                wait_time = 2 ** attempt  # æŒ‡æ•°é€€é¿
                print(f"ç­‰å¾… {wait_time} ç§’åé‡è¯•...")
                time.sleep(wait_time)
            else:
                print("è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°")
                return None

        except Exception as e:
            print(f"æœªçŸ¥é”™è¯¯ï¼š{e}")
            return None

# ä½¿ç”¨
data = fetch_data("https://api.example.com/data")
if data:
    print(f"è·å–çš„æ•°æ®ï¼š{data}")
else:
    print("è·å–æ•°æ®å¤±è´¥")
```

### ä¾‹å­3ï¼šç”¨æˆ·è¾“å…¥éªŒè¯

```python
class InputValidator:
    """è¾“å…¥éªŒè¯å™¨"""

    @staticmethod
    def get_integer(prompt, min_value=None, max_value=None):
        """è·å–æ•´æ•°è¾“å…¥"""
        while True:
            try:
                value = int(input(prompt))

                if min_value is not None and value < min_value:
                    print(f"å€¼å¿…é¡» >= {min_value}")
                    continue

                if max_value is not None and value > max_value:
                    print(f"å€¼å¿…é¡» <= {max_value}")
                    continue

                return value

            except ValueError:
                print("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•´æ•°")
            except KeyboardInterrupt:
                print("\næ“ä½œå·²å–æ¶ˆ")
                return None

    @staticmethod
    def get_float(prompt, positive=False):
        """è·å–æµ®ç‚¹æ•°è¾“å…¥"""
        while True:
            try:
                value = float(input(prompt))

                if positive and value <= 0:
                    print("å€¼å¿…é¡»ä¸ºæ­£æ•°")
                    continue

                return value

            except ValueError:
                print("è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—")
            except KeyboardInterrupt:
                print("\næ“ä½œå·²å–æ¶ˆ")
                return None

    @staticmethod
    def get_choice(prompt, choices):
        """è·å–é€‰æ‹©ï¼ˆä»åˆ—è¡¨ä¸­ï¼‰"""
        while True:
            print(prompt)
            for i, choice in enumerate(choices, 1):
                print(f"{i}. {choice}")

            try:
                index = int(input("è¯·é€‰æ‹©(è¾“å…¥æ•°å­—): ")) - 1

                if 0 <= index < len(choices):
                    return choices[index]
                else:
                    print("æ— æ•ˆçš„é€‰æ‹©")

            except ValueError:
                print("è¯·è¾“å…¥æ•°å­—")
            except KeyboardInterrupt:
                print("\næ“ä½œå·²å–æ¶ˆ")
                return None

# ä½¿ç”¨
age = InputValidator.get_integer("è¯·è¾“å…¥å¹´é¾„: ", min_value=0, max_value=150)
price = InputValidator.get_float("è¯·è¾“å…¥ä»·æ ¼: ", positive=True)
fruit = InputValidator.get_choice("é€‰æ‹©æ°´æœ:", ["è‹¹æœ", "é¦™è•‰", "æ©™å­"])

print(f"å¹´é¾„ï¼š{age}ï¼Œä»·æ ¼ï¼š{price}ï¼Œæ°´æœï¼š{fruit}")
```

### ä¾‹å­4ï¼šé…ç½®æ–‡ä»¶åŠ è½½

```python
import json

class ConfigLoader:
    """é…ç½®æ–‡ä»¶åŠ è½½å™¨"""

    def __init__(self, filename):
        self.filename = filename
        self.config = {}

    def load(self):
        """åŠ è½½é…ç½®"""
        try:
            with open(self.filename, "r", encoding="utf-8") as f:
                self.config = json.load(f)
            print(f"é…ç½®åŠ è½½æˆåŠŸï¼š{self.filename}")
            return True

        except FileNotFoundError:
            print(f"é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼š{self.filename}")
            self._create_default_config()
            return False

        except json.JSONDecodeError as e:
            print(f"é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼š{e}")
            return False

        except Exception as e:
            print(f"åŠ è½½é…ç½®å¤±è´¥ï¼š{e}")
            return False

    def _create_default_config(self):
        """åˆ›å»ºé»˜è®¤é…ç½®"""
        default_config = {
            "host": "localhost",
            "port": 8080,
            "debug": True
        }

        try:
            with open(self.filename, "w", encoding="utf-8") as f:
                json.dump(default_config, f, indent=2)
            print(f"å·²åˆ›å»ºé»˜è®¤é…ç½®ï¼š{self.filename}")
            self.config = default_config
        except Exception as e:
            print(f"åˆ›å»ºé»˜è®¤é…ç½®å¤±è´¥ï¼š{e}")

    def get(self, key, default=None):
        """è·å–é…ç½®é¡¹"""
        return self.config.get(key, default)

# ä½¿ç”¨
config = ConfigLoader("app_config.json")
if config.load():
    host = config.get("host")
    port = config.get("port")
    print(f"æœåŠ¡å™¨ï¼š{host}:{port}")
```

### ä¾‹å­5ï¼šæ‰¹é‡å¤„ç†ä»»åŠ¡

```python
def process_batch(items):
    """
    æ‰¹é‡å¤„ç†ä»»åŠ¡ï¼Œè®°å½•æˆåŠŸå’Œå¤±è´¥
    """
    results = {
        "success": [],
        "failed": []
    }

    for i, item in enumerate(items):
        try:
            # å¤„ç†å•ä¸ªé¡¹ç›®
            result = process_item(item)
            results["success"].append({
                "index": i,
                "item": item,
                "result": result
            })

        except ValueError as e:
            # è®°å½•å¤±è´¥çš„é¡¹ç›®
            results["failed"].append({
                "index": i,
                "item": item,
                "error": str(e),
                "type": "ValueError"
            })

        except Exception as e:
            results["failed"].append({
                "index": i,
                "item": item,
                "error": str(e),
                "type": type(e).__name__
            })

    return results

def process_item(item):
    """å¤„ç†å•ä¸ªé¡¹ç›®ï¼ˆæ¨¡æ‹Ÿï¼‰"""
    if not isinstance(item, (int, float)):
        raise ValueError(f"æ— æ•ˆçš„æ•°æ®ç±»å‹ï¼š{type(item)}")
    if item < 0:
        raise ValueError("å€¼ä¸èƒ½ä¸ºè´Ÿæ•°")
    return item * 2

# ä½¿ç”¨
items = [10, 20, -5, "abc", 30, None, 40]
results = process_batch(items)

print(f"æˆåŠŸï¼š{len(results['success'])} ä¸ª")
print(f"å¤±è´¥ï¼š{len(results['failed'])} ä¸ª")

print("\nå¤±è´¥çš„é¡¹ç›®ï¼š")
for failed in results["failed"]:
    print(f"  ç´¢å¼• {failed['index']}: {failed['item']} - {failed['error']}")
```

## å¸¸è§é™·é˜±

### é™·é˜±1ï¼šæ•è·å¼‚å¸¸ååæ‰é”™è¯¯

```python
# âŒ é”™è¯¯ - æ•è·åä»€ä¹ˆéƒ½ä¸åš
try:
    important_operation()
except:
    pass  # é”™è¯¯è¢«åæ‰ï¼Œæ— æ³•è°ƒè¯•

# âœ… æ­£ç¡® - è‡³å°‘è®°å½•é”™è¯¯
try:
    important_operation()
except Exception as e:
    print(f"æ“ä½œå¤±è´¥ï¼š{e}")
    # æˆ–è€…è®°å½•åˆ°æ—¥å¿—
    logging.error(f"æ“ä½œå¤±è´¥ï¼š{e}")
```

### é™·é˜±2ï¼šæ•è·èŒƒå›´è¿‡å¤§

```python
# âŒ é”™è¯¯ - æ•è·æ‰€æœ‰å¼‚å¸¸
try:
    value = int(input())
    result = 10 / value
except:  # è¿KeyboardInterruptéƒ½æ•è·äº†
    print("å‡ºé”™äº†")

# âœ… æ­£ç¡® - åªæ•è·ç‰¹å®šå¼‚å¸¸
try:
    value = int(input())
    result = 10 / value
except ValueError:
    print("è¾“å…¥æ— æ•ˆ")
except ZeroDivisionError:
    print("ä¸èƒ½é™¤ä»¥0")
```

### é™·é˜±3ï¼šå¼‚å¸¸å¤„ç†ä»£ç ä¸­åˆå‡ºé”™

```python
# âŒ å±é™© - exceptå—ä¸­å¯èƒ½å‡ºé”™
try:
    value = data["key"]
except KeyError:
    # è¿™é‡Œå¯èƒ½å¼•å‘å¦ä¸€ä¸ªå¼‚å¸¸
    log_error(undefined_variable)  # NameError!

# âœ… æ­£ç¡® - ç¡®ä¿exceptå—å®‰å…¨
try:
    value = data["key"]
except KeyError as e:
    # å®‰å…¨çš„é”™è¯¯å¤„ç†
    error_message = str(e)
    print(f"é”®ä¸å­˜åœ¨ï¼š{error_message}")
```

### é™·é˜±4ï¼šfinallyä¸­return

```python
# âŒ é”™è¯¯ - finallyä¸­returnä¼šè¦†ç›–å¼‚å¸¸
def bad_function():
    try:
        return 1 / 0
    finally:
        return "finally"  # å¼‚å¸¸è¢«åæ‰ï¼

result = bad_function()  # è¿”å› "finally"ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸

# âœ… æ­£ç¡® - finallyåªåšæ¸…ç†
def good_function():
    try:
        return 1 / 0
    finally:
        print("æ¸…ç†èµ„æº")  # åªåšæ¸…ç†ï¼Œä¸return
```

## æœ€ä½³å®è·µ

### 1. æ•è·å…·ä½“çš„å¼‚å¸¸

```python
# âœ… å¥½
try:
    value = int(user_input)
except ValueError:
    handle_invalid_input()

# âŒ ä¸å¥½
try:
    value = int(user_input)
except:
    handle_error()  # å¤ªå®½æ³›
```

### 2. ä¸è¦å¿½ç•¥å¼‚å¸¸

```python
# âŒ ä¸å¥½
try:
    operation()
except Exception:
    pass  # å¿½ç•¥æ‰€æœ‰é”™è¯¯

# âœ… å¥½
try:
    operation()
except Exception as e:
    logger.error(f"æ“ä½œå¤±è´¥ï¼š{e}")
```

### 3. åœ¨åˆé€‚çš„å±‚çº§å¤„ç†å¼‚å¸¸

```python
# âœ… å¥½ - åœ¨åˆé€‚çš„å±‚çº§å¤„ç†
def low_level_function():
    # ä¸å¤„ç†ï¼Œè®©ä¸Šå±‚å†³å®š
    return int(value)

def high_level_function():
    try:
        result = low_level_function()
        return result
    except ValueError:
        # åœ¨è¿™é‡Œå¤„ç†æ›´åˆé€‚
        show_error_to_user("è¾“å…¥æ— æ•ˆ")
        return None
```

### 4. ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
# âœ… å¥½ - è‡ªåŠ¨æ¸…ç†
with open("file.txt", "r") as f:
    content = f.read()
# æ–‡ä»¶è‡ªåŠ¨å…³é—­

# è€Œä¸æ˜¯
f = open("file.txt", "r")
try:
    content = f.read()
finally:
    f.close()
```

### 5. æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯

```python
# âŒ ä¸å¥½
raise ValueError("Error")

# âœ… å¥½
raise ValueError(f"æ— æ•ˆçš„å¹´é¾„å€¼ï¼š{age}ï¼Œå¿…é¡»åœ¨0-150ä¹‹é—´")
```

## è°ƒè¯•æŠ€å·§

### æ‰“å°å¼‚å¸¸çš„è¯¦ç»†ä¿¡æ¯

```python
import traceback

try:
    problematic_code()
except Exception as e:
    # æ‰“å°å¼‚å¸¸ç±»å‹å’Œæ¶ˆæ¯
    print(f"å¼‚å¸¸ç±»å‹ï¼š{type(e).__name__}")
    print(f"å¼‚å¸¸æ¶ˆæ¯ï¼š{e}")

    # æ‰“å°å®Œæ•´çš„å †æ ˆè·Ÿè¸ª
    traceback.print_exc()

    # æˆ–è·å–å †æ ˆè·Ÿè¸ªçš„å­—ç¬¦ä¸²
    trace = traceback.format_exc()
    print(trace)
```

## ç»ƒä¹ é¢˜

### ç»ƒä¹ 1ï¼šå®‰å…¨è®¡ç®—å™¨

å®ç°ä¸€ä¸ªå®‰å…¨çš„è®¡ç®—å™¨ï¼Œå¤„ç†ï¼š
- é™¤ä»¥é›¶
- æ— æ•ˆè¾“å…¥
- æœªçŸ¥è¿ç®—ç¬¦

### ç»ƒä¹ 2ï¼šæ–‡ä»¶å¤„ç†å·¥å…·

åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤„ç†å·¥å…·ï¼Œå¤„ç†ï¼š
- æ–‡ä»¶ä¸å­˜åœ¨
- æƒé™é”™è¯¯
- ç¼–ç é”™è¯¯
- ç£ç›˜æ»¡

### ç»ƒä¹ 3ï¼šè‡ªå®šä¹‰å¼‚å¸¸ç³»ç»Ÿ

ä¸ºä¸€ä¸ªåœ¨çº¿å•†åº—åˆ›å»ºå¼‚å¸¸ç³»ç»Ÿï¼š
- `ProductNotFoundError`
- `OutOfStockError`
- `InvalidQuantityError`
- `PaymentFailedError`

### ç»ƒä¹ 4ï¼šå¸¦é‡è¯•çš„APIè°ƒç”¨

å®ç°ä¸€ä¸ªAPIè°ƒç”¨å‡½æ•°ï¼š
- è‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚
- æŒ‡æ•°é€€é¿
- è®°å½•æ¯æ¬¡é‡è¯•
- æœ€ç»ˆå¤±è´¥æ—¶è¿”å›æœ‰æ„ä¹‰çš„é”™è¯¯

### ç»ƒä¹ 5ï¼šæ•°æ®éªŒè¯å™¨

åˆ›å»ºä¸€ä¸ªæ•°æ®éªŒè¯ç±»ï¼š
- éªŒè¯é‚®ç®±ã€ç”µè¯ã€èº«ä»½è¯
- æŠ›å‡ºè‡ªå®šä¹‰çš„éªŒè¯å¼‚å¸¸
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## ä¸‹ä¸€æ­¥

å­¦ä¼šäº†å¼‚å¸¸å¤„ç†ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å­¦ä¹ é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œç”¨ç±»å’Œå¯¹è±¡ç»„ç»‡ä»£ç ï¼

[ä¸Šä¸€ç« ï¼šç¬¬18ç«  - æ–‡ä»¶è¯»å†™ â†](../18-æ–‡ä»¶è¯»å†™/18-æ–‡ä»¶è¯»å†™.md)

[ä¸‹ä¸€ç« ï¼šç¬¬20ç«  - é¢å‘å¯¹è±¡åŸºç¡€ â†’](../20-é¢å‘å¯¹è±¡åŸºç¡€/20-é¢å‘å¯¹è±¡åŸºç¡€.md)

---

**æœ¬ç« é‡ç‚¹**
- âœ… ç†è§£å¼‚å¸¸çš„æ¦‚å¿µ
- âœ… æŒæ¡try-except-else-finally
- âœ… æ•è·å’Œå¤„ç†å¸¸è§å¼‚å¸¸
- âœ… æŠ›å‡ºå’Œè‡ªå®šä¹‰å¼‚å¸¸
- âœ… å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ
- âœ… é¿å…å¸¸è§é™·é˜±

**è®°ä½**
- åªæ•è·ä½ èƒ½å¤„ç†çš„å¼‚å¸¸
- æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯
- ä¸è¦å¿½ç•¥å¼‚å¸¸
- åœ¨åˆé€‚çš„å±‚çº§å¤„ç†å¼‚å¸¸
- ä½¿ç”¨å…·ä½“çš„å¼‚å¸¸ç±»å‹
- finallyç”¨äºæ¸…ç†èµ„æº
