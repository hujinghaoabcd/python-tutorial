# 第07章：元组(Tuple)

元组是Python中另一种重要的数据结构，它和列表非常相似，但有一个关键的区别：**元组是不可变的(immutable)**。这个特性让元组在某些场景下比列表更适合、更安全、也更高效。

在日常生活中，有些东西一旦确定就不应该改变，比如身份证号、出生日期、地理坐标等。Python的元组就是为了存储这类"确定后不应改变"的数据而设计的。

---

## 什么是元组？

元组就像一个被密封的包裹，里面装的东西一旦确定就不能再改变。你可以查看里面的内容，但不能修改、添加或删除。

**生活中的比喻**：
- **列表**就像一个活页文件夹，可以随时添加、删除、修改页面
- **元组**就像一本装订好的书，内容已经固定，只能阅读不能修改

```python
# 用圆括号创建
point = (10, 20)
colors = ("red", "green", "blue")

# 也可以不用括号（但不推荐）
numbers = 1, 2, 3, 4, 5
```

**为什么需要不可变的数据结构？**

1. **数据安全**：防止数据被意外修改
2. **性能更好**：占用内存更少，访问速度更快
3. **可以做字典的键**：不可变对象可以作为字典的键
4. **语义清晰**：表明这些数据是固定的

---

## 创建元组

### 基本创建

```python
# 空元组
empty = ()
empty = tuple()

# 一个元素的元组（注意逗号！）
single = (1,)  # 正确
# single = (1)  # 这是整数，不是元组！

# 多个元素
fruits = ("苹果", "香蕉", "橙子")
numbers = (1, 2, 3, 4, 5)

# 混合类型
mixed = (1, "hello", 3.14, True)

# 不用括号
point = 1, 2, 3  # 也是元组
```

**重点提醒**：创建单元素元组时，必须在元素后加逗号！这是初学者最容易犯的错误。

```python
# 检查类型
print(type((1,)))   # <class 'tuple'> ✓
print(type((1)))    # <class 'int'>  ✗
```

### 从其他类型转换

```python
# 列表转元组
lst = [1, 2, 3]
tup = tuple(lst)
print(tup)  # (1, 2, 3)

# 字符串转元组
chars = tuple("Python")
print(chars)  # ('P', 'y', 't', 'h', 'o', 'n')

# range转元组
nums = tuple(range(5))
print(nums)  # (0, 1, 2, 3, 4)
```

---

## 访问元组元素

和列表一样的索引和切片操作。

```python
fruits = ("苹果", "香蕉", "橙子", "葡萄")

# 索引
print(fruits[0])   # 苹果
print(fruits[-1])  # 葡萄

# 切片
print(fruits[1:3])  # ('香蕉', '橙子')
print(fruits[:2])   # ('苹果', '香蕉')
print(fruits[::2])  # ('苹果', '橙子')
```

---

## 元组不可变

这是元组最重要的特性！

```python
point = (10, 20)

# 不能修改
# point[0] = 15  # TypeError: 'tuple' object does not support item assignment

# 不能添加
# point.append(30)  # AttributeError

# 不能删除单个元素
# del point[0]  # TypeError
```

**但要注意**：元组本身不可变，但如果元组包含可变对象（如列表），可变对象的内容是可以改变的。

```python
t = ([1, 2], [3, 4])
t[0].append(3)
print(t)  # ([1, 2, 3], [3, 4]) - 列表内容变了！
```

---

## 元组操作

### 拼接和重复

```python
# 拼接
t1 = (1, 2, 3)
t2 = (4, 5, 6)
t3 = t1 + t2
print(t3)  # (1, 2, 3, 4, 5, 6)

# 重复
t = (1, 2) * 3
print(t)  # (1, 2, 1, 2, 1, 2)
```

### 查找

```python
fruits = ("苹果", "香蕉", "橙子", "香蕉")

# 查找索引
print(fruits.index("香蕉"))  # 1

# 计数
print(fruits.count("香蕉"))  # 2

# 判断是否存在
print("苹果" in fruits)  # True
```

### 长度、最大、最小、求和

```python
numbers = (1, 5, 3, 9, 2)
print(len(numbers))  # 5
print(max(numbers))  # 9
print(min(numbers))  # 1
print(sum(numbers))  # 20
```

---

## 元组解包（超级实用！）

元组最强大的特性之一！

### 基本解包

```python
# 赋值给多个变量
point = (10, 20)
x, y = point
print(x, y)  # 10 20

# 交换变量（超级方便！）
a, b = 1, 2
a, b = b, a  # 交换
print(a, b)  # 2 1
```

### 扩展解包

```python
# 用*收集剩余元素
numbers = (1, 2, 3, 4, 5)
first, *middle, last = numbers
print(first)   # 1
print(middle)  # [2, 3, 4]（注意是列表）
print(last)    # 5

# 忽略某些值
person = ("张三", 25, "北京", "程序员")
name, age, *_ = person  # _表示忽略
print(name, age)  # 张三 25
```

### 函数返回多个值

```python
def get_student():
    return "小明", 18, 95  # 实际返回的是元组

# 解包接收
name, age, score = get_student()
print(f"{name}, {age}岁, {score}分")
```

---

## 元组遍历

```python
fruits = ("苹果", "香蕉", "橙子")

# 遍历元素
for fruit in fruits:
    print(fruit)

# 遍历索引和元素
for i, fruit in enumerate(fruits):
    print(f"{i}: {fruit}")
```

---

## 命名元组

更高级的元组，可以通过名字访问，代码更清晰！

```python
from collections import namedtuple

# 定义一个学生类型
Student = namedtuple('Student', ['name', 'age', 'score'])

# 创建实例
s = Student('小明', 18, 95)

# 通过名字访问
print(s.name)   # 小明
print(s.age)    # 18
print(s.score)  # 95

# 也可以通过索引访问
print(s[0])  # 小明

# 转换成字典
print(s._asdict())  # {'name': '小明', 'age': 18, 'score': 95}
```

---

## 元组 vs 列表

### 什么时候用元组？

**1. 数据不会改变**
```python
# 坐标点（固定的）
point = (10, 20)

# RGB颜色值（固定的）
color = (255, 0, 0)

# 日期（固定的）
date = (2024, 1, 15)
```

**2. 作为字典的key**
```python
# 元组可以做key，列表不行
locations = {
    (0, 0): "原点",
    (10, 20): "点A",
    (30, 40): "点B"
}
```

**3. 函数返回多个值**
```python
def get_info():
    return "张三", 25, "北京"  # 用元组返回
```

**4. 性能要求高**
```python
# 元组比列表快，占用内存少
import sys
lst = [1, 2, 3]
tup = (1, 2, 3)
print(sys.getsizeof(lst))  # 更大
print(sys.getsizeof(tup))  # 更小
```

### 对比表

| 特性 | 列表 | 元组 |
|------|------|------|
| 可变性 | 可变 | 不可变 |
| 符号 | `[]` | `()` |
| 速度 | 较慢 | 较快 |
| 内存 | 较多 | 较少 |
| 用途 | 数据会改变 | 数据固定 |
| 作为字典key | 不可以 | 可以 |

---

## 实战例子

### 例子1：坐标系统

```python
# 定义几个点
points = [
    (0, 0),
    (10, 20),
    (30, 40),
    (50, 60)
]

# 计算距离
import math

def distance(p1, p2):
    x1, y1 = p1
    x2, y2 = p2
    return math.sqrt((x2-x1)**2 + (y2-y1)**2)

# 计算相邻点之间的距离
for i in range(len(points) - 1):
    d = distance(points[i], points[i+1])
    print(f"{points[i]} 到 {points[i+1]} 距离：{d:.2f}")
```

### 例子2：RGB颜色

```python
# 预定义颜色
RED = (255, 0, 0)
GREEN = (0, 255, 0)
BLUE = (0, 0, 255)
WHITE = (255, 255, 255)
BLACK = (0, 0, 0)

def blend_colors(color1, color2):
    """混合两种颜色"""
    r1, g1, b1 = color1
    r2, g2, b2 = color2
    return (
        (r1 + r2) // 2,
        (g1 + g2) // 2,
        (b1 + b2) // 2
    )

purple = blend_colors(RED, BLUE)
print(f"紫色: RGB{purple}")
```

### 例子3：数据库查询结果

```python
# 模拟数据库查询结果（通常是元组）
students = [
    ("张三", 18, "male", 95),
    ("李四", 19, "female", 92),
    ("王五", 18, "male", 88)
]

# 处理结果
print("姓名\t年龄\t性别\t成绩")
print("-" * 30)
for name, age, gender, score in students:
    gender_cn = "男" if gender == "male" else "女"
    print(f"{name}\t{age}\t{gender_cn}\t{score}")
```

### 例子4：配置信息

```python
# 数据库配置（不应该改变）
DB_CONFIG = (
    "localhost",  # host
    5432,         # port
    "mydb",       # database
    "user",       # username
    "password"    # password
)

def connect_db(config):
    host, port, db, user, pwd = config
    print(f"连接到 {host}:{port}/{db}")
    # 实际的连接逻辑...

connect_db(DB_CONFIG)
```

### 例子5：交换元素

```python
# 不用临时变量交换数组中的两个元素
def swap(lst, i, j):
    lst[i], lst[j] = lst[j], lst[i]

numbers = [1, 2, 3, 4, 5]
swap(numbers, 0, 4)
print(numbers)  # [5, 2, 3, 4, 1]
```

---

## 元组的陷阱

### 陷阱1：单元素元组

```python
# 错误
t = (1)  # 这是整数1，不是元组
print(type(t))  # <class 'int'>

# 正确
t = (1,)  # 注意逗号！
print(type(t))  # <class 'tuple'>
```

### 陷阱2：元组包含可变对象

```python
# 元组本身不可变，但元素可能可变
t = ([1, 2], [3, 4])
# t[0] = [5, 6]  # 错误：不能替换元素

# 但可以修改元素内部
t[0].append(3)
print(t)  # ([1, 2, 3], [3, 4])，元素内部变了！
```

### 陷阱3：空元组和单元素元组

```python
# 空元组
empty = ()
empty = tuple()

# 单元素元组
single = (1,)  # 逗号必须有
single = 1,    # 也可以
```

---

## 练习题

### 练习1：元组排序

元组不可变，不能用sort()。写一个函数对元组排序并返回新元组。

### 练习2：找出重复元素

找出元组中所有重复的元素。

### 练习3：元组转字符串

将元组`("apple", "banana", "orange")`转换成字符串`"apple, banana, orange"`。

### 练习4：二维坐标

计算多个点的中心点坐标。

```python
points = [(0, 0), (4, 0), (4, 3), (0, 3)]
# 中心点：(2.0, 1.5)
```

### 练习5：命名元组

用命名元组创建一个书籍类型，包含标题、作者、价格，并创建几本书。

---

## 下一步

学完了元组，下一章我们学习字典（Dictionary），一种键值对的数据结构！

[上一章：第06章 - 列表 ←](../06-列表/06-列表.md)

[下一章：第08章 - 字典 →](../08-字典/08-字典.md)

---

**本章重点**
- ✅ 元组是不可变的
- ✅ 用圆括号()创建
- ✅ 单元素元组要加逗号：(1,)
- ✅ 元组解包很方便
- ✅ 元组比列表更快、更省内存
- ✅ 元组可以作为字典的key

**记住**
- 元组不可变，但元素可能可变
- 单元素元组必须加逗号
- 元组解包用于交换变量超级方便
- 不会改变的数据用元组，会改变的用列表
