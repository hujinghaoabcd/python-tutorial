# 第04章：数字类型和运算

上一章我们学习了Python的基础语法，这一章我们深入学习数字类型和各种运算。数字是编程的基础，就像数学是科学的基础一样。

Python有三种主要的数字类型：整数、浮点数和复数。我们主要学习前两种，复数用得比较少。

---

## 整数（int）

整数就是没有小数点的数字，就像数学里的整数一样。

### 基本用法

```python
# 正整数
age = 18
year = 2024
count = 100

# 负整数
temperature = -10
debt = -1000
balance = -50

# 零
count = 0
```

**整数可以做什么？**
- 表示年龄、数量、年份等
- 做计数、索引
- 做精确的数学运算

---

### 大整数（Python的特色！）

**Python的整数没有大小限制！** 这是Python的一个特色，其他很多语言都有整数上限，但Python没有。

```python
# 普通语言可能溢出，Python不会
big_number = 123456789012345678901234567890
print(big_number)  # 正常输出，不会溢出

# 更大的数
huge = 10 ** 100  # 1后面100个0
print(huge)  # 正常输出

# 可以计算任意大的数
factorial_100 = 1
for i in range(1, 101):
    factorial_100 *= i
print(factorial_100)  # 100的阶乘，一个超大的数
```

**为什么Python可以这样？**
Python会自动处理大整数，不需要担心溢出问题。这在做科学计算、密码学等需要大数的场景很有用。

---

### 不同进制

有时候我们需要用不同的进制表示数字，比如二进制、八进制、十六进制。

```python
# 十进制（默认，我们平时用的）
num = 100

# 二进制（0b开头）- 计算机内部用的
binary = 0b1010  # 等于十进制的10
print(binary)  # 输出：10

# 八进制（0o开头）- 有时候会用
octal = 0o12  # 等于十进制的10
print(octal)  # 输出：10

# 十六进制（0x开头）- 常用，比如颜色代码
hexadecimal = 0xFF  # 等于十进制的255
print(hexadecimal)  # 输出：255
```

**什么时候用不同进制？**
- **二进制**：做位运算、处理二进制数据
- **八进制**：很少用，但要知道
- **十六进制**：颜色代码（如`#FF0000`表示红色）、内存地址等

---

### 进制转换

Python提供了函数来转换进制。

```python
num = 255

# 转成二进制字符串
print(bin(num))  # '0b11111111'

# 转成八进制字符串
print(oct(num))  # '0o377'

# 转成十六进制字符串
print(hex(num))  # '0xff'

# 字符串转回整数（需要指定进制）
print(int('0b11111111', 2))  # 255（从二进制转）
print(int('0o377', 8))  # 255（从八进制转）
print(int('0xff', 16))  # 255（从十六进制转）
print(int('FF', 16))  # 255（可以省略0x）
```

**实际应用**：
```python
# 颜色代码转换
color_hex = "FF0000"  # 红色
red = int(color_hex[0:2], 16)  # 255
green = int(color_hex[2:4], 16)  # 0
blue = int(color_hex[4:6], 16)  # 0
print(f"RGB: ({red}, {green}, {blue})")
```

---

## 浮点数（float）

浮点数就是带小数点的数字，用来表示小数。

### 基本用法

```python
price = 99.9
pi = 3.14159
temperature = -5.5
weight = 65.5
```

**浮点数可以做什么？**
- 表示价格、重量、温度等需要小数的值
- 做科学计算
- 做精确测量

---

### 科学计数法

对于很大或很小的数，可以用科学计数法。

```python
# e表示10的幂
big = 1.5e3  # 1.5 × 10³ = 1500.0
small = 1.5e-3  # 1.5 × 10⁻³ = 0.0015

print(big)    # 1500.0
print(small)  # 0.0015

# 更大的数
huge = 1.23e10  # 12300000000.0
tiny = 1.23e-10  # 0.000000000123
```

**什么时候用科学计数法？**
- 表示很大的数（如距离、质量）
- 表示很小的数（如原子大小、概率）
- 科学计算中常用

---

### 浮点数精度问题（重要！）

**这是新手最容易踩的坑！** 浮点数在计算机中存储时，会有精度问题。

```python
# 小心！浮点数有精度问题
print(0.1 + 0.2)  # 0.30000000000000004，不是0.3！

# 比较浮点数不要用==
a = 0.1 + 0.2
b = 0.3
print(a == b)  # False！明明应该相等
```

**为什么会这样？**

计算机用二进制存储数字，但很多十进制小数无法精确表示成二进制。就像1/3无法精确表示成小数一样。

**怎么办？**

**方法1：用误差范围比较**
```python
# 正确的比较方式
a = 0.1 + 0.2
b = 0.3
print(abs(a - b) < 0.0001)  # True（误差小于0.0001就认为相等）
```

**方法2：用round()四舍五入**
```python
# 或者用round()
print(round(0.1 + 0.2, 1) == 0.3)  # True（保留1位小数后比较）
```

**方法3：用Decimal做精确计算**
```python
from decimal import Decimal

# 用Decimal代替float做精确计算
a = Decimal('0.1')
b = Decimal('0.2')
print(a + b)  # 0.3，精确！
```

---

### 处理精度问题

对于需要精确计算的场景（比如金钱），一定要用`Decimal`。

```python
from decimal import Decimal

# 金钱计算一定要用Decimal
price1 = Decimal('19.9')
price2 = Decimal('29.9')
total = price1 + price2
print(total)  # 49.8，精确！

# 如果用float
price1_float = 19.9
price2_float = 29.9
total_float = price1_float + price2_float
print(total_float)  # 可能不是49.8，有误差
```

**什么时候用Decimal？**
- 金钱计算（必须精确）
- 需要精确小数的场景
- 金融、会计等应用

**什么时候用float？**
- 科学计算（可以容忍小误差）
- 一般的小数运算
- 性能要求高的场景（Decimal比float慢）

---

## 复数（complex）

复数有实部和虚部，一般用得比较少，主要在科学计算、信号处理等领域。

```python
# j或J表示虚数单位（数学里用i，Python用j）
c = 3 + 4j
print(c)  # (3+4j)

# 获取实部和虚部
print(c.real)  # 3.0
print(c.imag)  # 4.0

# 复数运算
c1 = 1 + 2j
c2 = 3 + 4j
print(c1 + c2)  # (4+6j)
print(c1 * c2)  # (-5+10j)
```

**什么时候用复数？**
- 科学计算（如量子物理、信号处理）
- 数学建模
- 一般编程很少用到

---

## 算术运算符

运算符就是用来做运算的符号，比如`+`、`-`、`*`、`/`等。

### 基本运算

```python
# 加法
print(10 + 3)   # 13

# 减法
print(10 - 3)   # 7

# 乘法
print(10 * 3)   # 30

# 除法（结果总是浮点数！）
print(10 / 3)   # 3.3333333333333335
print(10 / 2)   # 5.0，注意是5.0不是5
```

**注意**：Python 3中，除法`/`总是返回浮点数，即使能整除。这是Python 3和Python 2的区别之一。

---

### 特殊除法

有时候我们需要整数除法或取余数。

```python
# 整除（只取整数部分，向下取整）
print(10 // 3)   # 3
print(-10 // 3)  # -4（向下取整，不是-3）

# 取余（求余数）
print(10 % 3)    # 1（10除以3余1）
print(10 % 2)    # 0（10除以2余0）

# 同时获取商和余数（方便！）
quotient, remainder = divmod(10, 3)
print(quotient, remainder)  # 3 1
```

**实际应用**：
```python
# 判断奇偶数
num = 10
if num % 2 == 0:
    print("偶数")
else:
    print("奇数")

# 判断能否整除
if num % 5 == 0:
    print("能被5整除")

# 时间转换
total_seconds = 3665
hours = total_seconds // 3600
minutes = (total_seconds % 3600) // 60
seconds = total_seconds % 60
print(f"{hours}小时{minutes}分钟{seconds}秒")
```

---

### 幂运算

幂运算就是次方，比如2的3次方。

```python
# 幂运算
print(2 ** 3)    # 8 (2的3次方)
print(10 ** 2)   # 100 (10的2次方)
print(2 ** 10)   # 1024 (2的10次方)

# 平方根（0.5次方）
print(9 ** 0.5)  # 3.0 (9的平方根)

# 立方根（1/3次方）
print(8 ** (1/3))  # 2.0 (8的立方根)

# 也可以用pow()函数
print(pow(2, 3))  # 8
```

**实际应用**：
```python
# 计算面积（圆的面积 = π × r²）
import math
radius = 5
area = math.pi * radius ** 2

# 计算复利（本金 × (1 + 利率)^年数）
principal = 10000
rate = 0.05
years = 10
future_value = principal * (1 + rate) ** years
```

---

### 运算符优先级

就像数学里的运算顺序一样，Python的运算符也有优先级。

```python
# 先乘除后加减
print(2 + 3 * 4)  # 14，不是20（先算3*4=12，再算2+12=14）

# 用括号改变优先级
print((2 + 3) * 4)  # 20（先算2+3=5，再算5*4=20）

# 复杂表达式
result = 2 + 3 * 4 ** 2 / 8 - 1
# 计算顺序：
# 1. 4**2 = 16（幂运算优先级最高）
# 2. 3*16 = 48
# 3. 48/8 = 6
# 4. 2+6 = 8
# 5. 8-1 = 7
print(result)  # 7.0
```

**优先级（从高到低）**：
1. `()`括号（最高）
2. `**`幂运算
3. `*`、`/`、`//`、`%` 乘除
4. `+`、`-` 加减（最低）

**记住**：不确定优先级时，用括号！括号最清晰，也最安全。

---

## 数学函数

Python提供了很多数学函数，有些是内置的，有些在`math`模块里。

### 内置函数

这些函数不需要导入，直接用。

```python
# 绝对值
print(abs(-5))     # 5
print(abs(-3.14))  # 3.14

# 四舍五入
print(round(3.14159))  # 3（默认保留整数）
print(round(3.14159, 2))  # 3.14（保留2位小数）
print(round(3.14159, 3))  # 3.142（保留3位小数）

# 最大值、最小值
print(max(1, 5, 3, 9, 2))  # 9
print(min(1, 5, 3, 9, 2))  # 1

# 求和
print(sum([1, 2, 3, 4, 5]))  # 15

# 幂运算
print(pow(2, 3))  # 8，等同于2**3
print(pow(2, 3, 5))  # 3，等同于(2**3) % 5（模幂运算）
```

**实际应用**：
```python
# 找最高分和最低分
scores = [85, 92, 78, 96, 88]
highest = max(scores)
lowest = min(scores)
average = sum(scores) / len(scores)
print(f"最高分：{highest}，最低分：{lowest}，平均分：{average:.2f}")
```

---

### math模块

更高级的数学函数在`math`模块里，需要先导入。

```python
import math

# 常数
print(math.pi)  # 3.141592653589793（圆周率）
print(math.e)   # 2.718281828459045（自然常数）

# 向上取整、向下取整
print(math.ceil(3.14))   # 4（向上取整）
print(math.floor(3.99))  # 3（向下取整）

# 平方根
print(math.sqrt(16))  # 4.0

# 幂和对数
print(math.pow(2, 3))   # 8.0（等同于2**3）
print(math.log(10))     # 2.302...（自然对数，以e为底）
print(math.log10(100))  # 2.0（以10为底的对数）

# 三角函数（参数是弧度）
print(math.sin(math.pi / 2))  # 1.0（sin(90°)）
print(math.cos(0))  # 1.0（cos(0°)）
print(math.tan(math.pi / 4))  # 1.0（tan(45°)）

# 角度和弧度转换
degrees = 90
radians = math.radians(degrees)  # 角度转弧度
print(radians)  # 1.5707...（π/2）

# 阶乘
print(math.factorial(5))  # 120 (5! = 5×4×3×2×1)
```

**实际应用**：
```python
import math

# 计算圆的面积和周长
radius = 5
area = math.pi * radius ** 2
circumference = 2 * math.pi * radius

# 计算两点间距离
x1, y1 = 0, 0
x2, y2 = 3, 4
distance = math.sqrt((x2 - x1)**2 + (y2 - y1)**2)
print(distance)  # 5.0
```

---

## 随机数

随机数在很多场景都有用：游戏、抽奖、测试数据、加密等。

```python
import random

# 生成随机浮点数[0.0, 1.0)（包含0，不包含1）
print(random.random())  # 0.123456...（每次运行结果不同）

# 生成随机整数[a, b]（包含a和b）
print(random.randint(1, 10))  # 1到10之间的随机整数

# 生成随机浮点数[a, b]
print(random.uniform(1.0, 10.0))  # 1.0到10.0之间的随机浮点数

# 从序列中随机选择
colors = ['red', 'green', 'blue']
print(random.choice(colors))  # 随机选一个颜色

# 打乱列表（原地修改）
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)
print(numbers)  # [3, 1, 5, 2, 4]（顺序随机）

# 随机抽样（不重复）
print(random.sample([1, 2, 3, 4, 5], 3))  # 随机抽3个，如[2, 5, 1]
```

**实际应用**：
```python
import random

# 掷骰子
die = random.randint(1, 6)
print(f"你掷出了：{die}")

# 抽奖
participants = ["张三", "李四", "王五", "赵六"]
winner = random.choice(participants)
print(f"中奖者是：{winner}")

# 生成随机密码
import string
password = ''.join(random.choices(string.ascii_letters + string.digits, k=8))
print(f"随机密码：{password}")
```

---

## 类型转换

有时候我们需要在不同数字类型之间转换。

```python
# int()转整数（截断，不是四舍五入！）
print(int(3.9))     # 3（截断，不是4）
print(int(3.1))     # 也是3
print(int("123"))   # 123（字符串转整数）
print(int("0xFF", 16))  # 255（从十六进制转换）

# float()转浮点数
print(float(10))    # 10.0
print(float("3.14"))  # 3.14

# 整数和浮点数运算（自动转成浮点数）
print(10 + 3.5)     # 13.5（自动转成浮点数）
print(10 / 3)       # 3.333...（除法总是返回浮点数）
```

**注意**：
- `int()`是截断，不是四舍五入！要四舍五入用`round()`
- 除法`/`总是返回浮点数，即使能整除
- 整数和浮点数运算，结果总是浮点数

---

## 实战例子

光说不练假把式，让我们看看这些知识在实际中的应用。

---

### 例子1：计算圆的面积和周长

```python
import math

radius = float(input("请输入圆的半径："))

# 计算
area = math.pi * radius ** 2
circumference = 2 * math.pi * radius

print(f"半径为{radius}的圆：")
print(f"面积 = {area:.2f}")
print(f"周长 = {circumference:.2f}")
```

**运行效果**：
```
请输入圆的半径：5
半径为5.0的圆：
面积 = 78.54
周长 = 31.42
```

---

### 例子2：贷款计算器

计算等额本息还款的月供。

```python
# 计算等额本息还款
loan = float(input("贷款金额（元）："))
years = int(input("贷款年限："))
rate = float(input("年利率（%）：")) / 100  # 转成小数

monthly_rate = rate / 12  # 月利率
months = years * 12  # 总月数

# 月供计算公式
monthly_payment = loan * monthly_rate * (1 + monthly_rate) ** months / \
                  ((1 + monthly_rate) ** months - 1)

total = monthly_payment * months
interest = total - loan

print(f"\n月供：{monthly_payment:.2f}元")
print(f"总还款：{total:.2f}元")
print(f"总利息：{interest:.2f}元")
```

**运行效果**：
```
贷款金额（元）：1000000
贷款年限：30
年利率（%）：5.5

月供：5677.89元
总还款：2044040.40元
总利息：1044040.40元
```

---

### 例子3：掷骰子游戏

```python
import random

print("=== 掷骰子游戏 ===")
input("按回车掷骰子...")

die1 = random.randint(1, 6)
die2 = random.randint(1, 6)
total = die1 + die2

print(f"第一个骰子：{die1}")
print(f"第二个骰子：{die2}")
print(f"总点数：{total}")

if total == 7 or total == 11:
    print("你赢了！")
elif total == 2 or total == 3 or total == 12:
    print("你输了！")
else:
    print("再来一次！")
```

---

### 例子4：单位转换工具

```python
print("=== 单位转换工具 ===")
print("1. 千克转磅")
print("2. 千米转英里")
print("3. 摄氏度转华氏度")

choice = int(input("选择（1-3）："))

if choice == 1:
    kg = float(input("输入千克："))
    lb = kg * 2.20462
    print(f"{kg}千克 = {lb:.2f}磅")
elif choice == 2:
    km = float(input("输入千米："))
    miles = km * 0.621371
    print(f"{km}千米 = {miles:.2f}英里")
elif choice == 3:
    celsius = float(input("输入摄氏度："))
    fahrenheit = celsius * 9/5 + 32
    print(f"{celsius}°C = {fahrenheit:.1f}°F")
```

---

## 常见陷阱

新手写代码经常会遇到这些陷阱，提前知道可以少走弯路。

---

### 陷阱1：整除的符号

整除是向下取整，不是向零取整。

```python
print(7 // 2)    # 3
print(-7 // 2)   # -4（不是-3！）

# 整除是向下取整（向负无穷取整）
# -7 ÷ 2 = -3.5，向下取整是-4
```

**为什么会这样？**
这是数学上的定义，向下取整（floor division）。如果觉得困惑，记住：正数向下取整就是去掉小数部分，负数向下取整是向更小的整数取整。

---

### 陷阱2：浮点数比较

不要用`==`直接比较浮点数！

```python
# 错误
print(0.1 + 0.2 == 0.3)  # False

# 正确
print(abs((0.1 + 0.2) - 0.3) < 1e-9)  # True（用误差范围）
print(round(0.1 + 0.2, 1) == 0.3)  # True（用round）
```

**记住**：浮点数比较用误差范围，不要用`==`！

---

### 陷阱3：除零错误

除以0会报错，要检查除数。

```python
# 整数除零
# print(10 / 0)  # ZeroDivisionError: division by zero

# 检查除数
divisor = int(input("除数："))
if divisor != 0:
    result = 10 / divisor
    print(result)
else:
    print("除数不能为0！")
```

**实际应用**：
```python
# 安全的除法函数
def safe_divide(a, b):
    if b == 0:
        return None  # 或者抛出异常
    return a / b

result = safe_divide(10, 0)
if result is None:
    print("除数不能为0")
else:
    print(f"结果：{result}")
```

---

### 陷阱4：int()是截断不是四舍五入

```python
# int()是截断
print(int(3.9))  # 3，不是4
print(int(3.1))  # 3

# 要四舍五入用round()
print(round(3.9))  # 4
print(round(3.1))  # 3
```

---

## 练习题

光看不练假把式，动手写代码才能真正学会！

---

### 练习1：计算三角形面积

已知三角形三边长a、b、c，用海伦公式计算面积。

**海伦公式**：
- s = (a + b + c) / 2（半周长）
- area = √[s(s-a)(s-b)(s-c)]

**要求**：
- 输入三边长
- 计算面积
- 输出结果（保留2位小数）

---

### 练习2：生成随机密码

生成一个8位随机密码，包含数字和字母。

**提示**：
- 用`random.choice()`或`random.choices()`
- 可以用`string.ascii_letters`和`string.digits`

---

### 练习3：二次方程求解

解方程 ax² + bx + c = 0，使用求根公式。

**求根公式**：
- Δ = b² - 4ac（判别式）
- 如果Δ >= 0：x = (-b ± √Δ) / (2a)
- 如果Δ < 0：无实数解

**要求**：
- 输入a、b、c
- 判断是否有解
- 输出解（如果有）

---

### 练习4：复利计算

计算投资本金经过n年后的价值。

**公式**：FV = PV × (1 + r)ⁿ

其中：
- FV：未来价值
- PV：现值（本金）
- r：年利率
- n：年数

**要求**：
- 输入本金、利率、年数
- 计算未来价值
- 输出结果（保留2位小数）

---

## 下一步

学会了数字运算，你已经掌握了Python的数学计算能力！下一章我们将学习字符串的各种操作，包括：
- 字符串的创建和基本操作
- 字符串格式化
- 字符串方法
- 字符串切片和索引

准备好了吗？让我们继续Python之旅！

[上一章：第03章 - 基础语法 ←](../03-基础语法/03-基础语法.md)

[下一章：第05章 - 字符串详解 →](../05-字符串详解/05-字符串详解.md)

---

## 本章重点总结

学完这一章，你应该掌握：

- **三种数字类型**：int（整数）、float（浮点数）、complex（复数）
- **算术运算符**：`+`、`-`、`*`、`/`、`//`、`%`、`**`
- **运算符优先级**：括号 > 幂运算 > 乘除 > 加减
- **math模块**：常用数学函数（sqrt、sin、cos等）
- **random模块**：生成随机数
- **浮点数精度问题**：如何避免和解决
- **类型转换**：int()、float()的使用和注意事项

**记住**：
- Python整数没有大小限制，可以表示任意大的数
- 除法`/`总是返回浮点数，整除`//`返回整数
- 浮点数有精度问题，金钱计算用Decimal
- `int()`是截断不是四舍五入，要四舍五入用`round()`
- 浮点数比较用误差范围，不要用`==`
- 除以0会报错，要检查除数

**你已经掌握了Python的数字运算能力！** 这是编程的基础，后续很多内容都会用到这些知识。继续加油！
